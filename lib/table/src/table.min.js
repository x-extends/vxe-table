"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_cell=_interopRequireDefault(require("../../cell")),_vXETable=_interopRequireWildcard(require("../../v-x-e-table")),_tools=require("../../tools");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){var n=o?Object.getOwnPropertyDescriptor(e,l):null;n&&(n.get||n.set)?Object.defineProperty(i,l,n):i[l]=e[l]}return i.default=e,t&&t.set(e,i),i}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var printFrame,rowUniqueId=0,browse=_tools.DomTools.browse,debounceScrollYDuration=browse.msie?40:20,fileForm=document.createElement("form"),fileInput=document.createElement("input");function createFrame(){var e=document.createElement("iframe");return e.className="vxe-table--print-frame",e}function getRowUniqueId(){return"row_".concat(++rowUniqueId)}function isTargetRadioOrCheckbox(e,t,i,o){var l=e.target;return l&&t.type===i&&"input"===l.tagName.toLowerCase()&&l.type===(o||i)}fileForm.className="vxe-table--import-form",fileInput.name="file",fileInput.type="file",fileForm.appendChild(fileInput);var Rule=function(){function t(e){_classCallCheck(this,t),Object.assign(this,{$options:e,required:e.required,min:e.min,max:e.min,type:e.type,pattern:e.pattern,validator:e.validator,trigger:e.trigger,maxWidth:e.maxWidth})}return _createClass(t,[{key:"message",get:function(){return _tools.UtilTools.getFuncText(this.$options.message)}}]),t}();function renderFixed(e,t,i){var o=t.tableData,l=t.tableColumn,n=t.visibleColumn,r=t.collectColumn,s=t.isGroup,a=t.height,c=t.parentHeight,u=t.vSize,h=t.headerHeight,d=t.footerHeight,f=t.showHeader,p=t.showFooter,v=t.tableHeight,g=t.scrollbarWidth,m=t.scrollbarHeight,x=t.scrollRightToLeft,w=t.scrollLeftToRight,b=t.columnStore,T=t.footerData,C="right"===i,_=b["".concat(i,"List")],R=0;a&&(R="auto"===a?c:_tools.DomTools.isScale(a)?Math.floor(parseInt(a)/100*c):_xeUtils.default.toNumber(a),p&&(R+=m+1));var S={height:"".concat((0<R?R-h-d:v)+h+d-m*(p?2:1),"px"),width:"".concat(_.reduce(function(e,t){return e+t.renderWidth},C?g:0),"px")};return e("div",{class:["vxe-table--fixed-".concat(i,"-wrapper"),{"scrolling--middle":C?x:w}],style:S,ref:"".concat(i,"Container")},[f?e("vxe-table-header",{props:{fixedType:i,tableData:o,tableColumn:l,visibleColumn:n,collectColumn:r,size:u,fixedColumn:_,isGroup:s},ref:"".concat(i,"Header")}):null,e("vxe-table-body",{style:{top:"".concat(h,"px")},props:{fixedType:i,tableData:o,tableColumn:l,visibleColumn:n,collectColumn:r,fixedColumn:_,size:u,isGroup:s},ref:"".concat(i,"Body")}),p?e("vxe-table-footer",{style:{top:"".concat(0<R?R-d:v+h,"px")},props:{fixedType:i,footerData:T,tableColumn:l,visibleColumn:n,size:u,fixedColumn:_},ref:"".concat(i,"Footer")}):null])}var headerProps={children:"children"},_default2={name:"VxeTable",props:{data:Array,customs:Array,height:[Number,String],maxHeight:[Number,String],resizable:{type:Boolean,default:function(){return _conf.default.resizable}},stripe:{type:Boolean,default:function(){return _conf.default.stripe}},border:{type:[Boolean,String],default:function(){return _conf.default.border}},size:{type:String,default:function(){return _conf.default.size}},fit:{type:Boolean,default:function(){return _conf.default.fit}},loading:Boolean,align:{type:String,default:function(){return _conf.default.align}},headerAlign:{type:String,default:function(){return _conf.default.headerAlign}},footerAlign:{type:String,default:function(){return _conf.default.footerAlign}},showHeader:{type:Boolean,default:function(){return _conf.default.showHeader}},startIndex:{type:Number,default:0},highlightCurrentRow:{type:Boolean,default:function(){return _conf.default.highlightCurrentRow}},highlightHoverRow:{type:Boolean,default:function(){return _conf.default.highlightHoverRow}},highlightCurrentColumn:{type:Boolean,default:function(){return _conf.default.highlightCurrentColumn}},highlightHoverColumn:{type:Boolean,default:function(){return _conf.default.highlightHoverColumn}},showFooter:Boolean,footerMethod:Function,rowClassName:[String,Function],cellClassName:[String,Function],headerRowClassName:[String,Function],headerCellClassName:[String,Function],footerRowClassName:[String,Function],footerCellClassName:[String,Function],cellStyle:[Object,Function],headerCellStyle:[Object,Function],footerCellStyle:[Object,Function],rowStyle:[Object,Function],headerRowStyle:[Object,Function],footerRowStyle:[Object,Function],spanMethod:Function,footerSpanMethod:Function,showAllOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderAllOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},showOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},remoteFilter:Boolean,remoteSort:Boolean,sortMethod:Function,columnWidth:[Number,String],columnMinWidth:[Number,String],columnKey:Boolean,rowKey:[Boolean,String],rowId:String,zIndex:Number,autoResize:Boolean,syncResize:Boolean,seqConfig:Object,sortConfig:Object,filterConfig:Object,radioConfig:Object,selectConfig:Object,checkboxConfig:Object,tooltipConfig:Object,expandConfig:Object,treeConfig:[Boolean,Object],contextMenu:Object,mouseConfig:Object,keyboardConfig:Object,editConfig:Object,validConfig:Object,editRules:Object,optimization:Object,params:Object},provide:function(){return{$table:this}},inject:{$grid:{default:null}},data:function(){return{id:_xeUtils.default.uniqueId(),tZindex:0,collectColumn:[],tableFullColumn:[],tableColumn:[],tableData:[],parentHeight:0,tableWidth:0,tableHeight:0,headerHeight:0,footerHeight:0,scrollXLoad:!1,scrollYLoad:!1,overflowY:!0,overflowX:!1,scrollbarWidth:0,scrollbarHeight:0,scrollLeftToRight:!1,scrollRightToLeft:!1,rowHeight:0,isAllSelected:!1,isIndeterminate:!1,selection:[],currentRow:null,selectRow:null,currentColumn:null,footerData:[],rowExpandeds:[],expandLazyLoadeds:[],treeExpandeds:[],treeLazyLoadeds:[],treeIndeterminates:[],hoverRow:null,_isLoading:!1,filterStore:{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1},columnStore:{leftList:[],centerList:[],rightList:[],resizeList:[],pxList:[],pxMinList:[],scaleList:[],scaleMinList:[],autoList:[]},ctxMenuStore:{selected:null,visible:!1,showChild:!1,selectChild:null,list:[],style:null},scrollXStore:{renderSize:0,visibleSize:0,offsetSize:0,rowHeight:0,startIndex:0,visibleIndex:0,leftSpaceWidth:0,rightSpaceWidth:0},scrollYStore:{renderSize:0,visibleSize:0,offsetSize:0,rowHeight:0,startIndex:0,visibleIndex:0,topSpaceHeight:0,bottomSpaceHeight:0,ySpaceHeight:0},tooltipStore:{visible:!1,row:null,column:null,content:""},editStore:{checked:{rows:[],columns:[],tRows:[],tColumns:[]},selected:{row:null,column:null},copyed:{cut:!1,rows:[],columns:[]},actived:{row:null,column:null},insertList:[],removeList:[]},validStore:{visible:!1,row:null,column:null,content:"",rule:null,isArrow:!1}}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},validOpts:function(){return Object.assign({message:"default"},_conf.default.validConfig,this.validConfig)},optimizeOpts:function(){return Object.assign({},_conf.default.optimization,this.optimization)},rowHeightMaps:function(){return Object.assign({default:48,medium:44,small:40,mini:36},this.optimizeOpts.rHeights)},seqOpts:function(){return Object.assign({startIndex:0},_conf.default.seqConfig,this.seqConfig)},radioOpts:function(){return Object.assign({},_conf.default.radioConfig,this.radioConfig)},checkboxOpts:function(){return Object.assign({},_conf.default.checkboxConfig,this.checkboxConfig||this.selectConfig)},tooltipOpts:function(){return Object.assign({leaveDelay:300},_conf.default.tooltipConfig,this.tooltipConfig)},vaildTipOpts:function(){return Object.assign({isArrow:!1},this.tooltipOpts)},sortOpts:function(){return Object.assign({},_conf.default.sortConfig,this.sortConfig)},filterOpts:function(){return Object.assign({},_conf.default.filterConfig,this.filterConfig)},isGroup:function(){return this.collectColumn.some(function(e){return _tools.UtilTools.hasChildrenList(e)})},hasTip:function(){return _vXETable.default._tooltip},visibleColumn:function(){return this.tableFullColumn?this.tableFullColumn.filter(function(e){return e.visible}):[]},isResizable:function(){return this.resizable||this.tableFullColumn.some(function(e){return e.resizable})},hasFilter:function(){return this.tableColumn.some(function(e){return e.filters&&e.filters.length})},headerCtxMenu:function(){return this.ctxMenuOpts.header&&this.ctxMenuOpts.header.options?this.ctxMenuOpts.header.options:[]},bodyCtxMenu:function(){return this.ctxMenuOpts.body&&this.ctxMenuOpts.body.options?this.ctxMenuOpts.body.options:[]},isCtxMenu:function(){return this.headerCtxMenu.length||this.bodyCtxMenu.length},ctxMenuOpts:function(){return Object.assign({},_conf.default.menu,this.contextMenu)},ctxMenuList:function(){var t=[];return this.ctxMenuStore.list.forEach(function(e){e.forEach(function(e){t.push(e)})}),t},expandOpts:function(){return Object.assign({},_conf.default.expandConfig,this.expandConfig)},treeOpts:function(){return Object.assign({children:"children",hasChild:"hasChild",indent:20},_conf.default.treeConfig,this.treeConfig)},isAllCheckboxDisabled:function(){var e=this.tableFullData,t=(this.treeConfig,this.checkboxOpts),i=t.strict,o=t.checkMethod;return!!i&&(!e.length||!!o&&e.every(function(e,t){return!o({row:e,rowIndex:t,$rowIndex:t})}))}},watch:{data:function(e){this.loadTableData(e,!0).then(this.handleDefault)},customs:function(e){this.isUpdateCustoms||this.mergeCustomColumn(e),this.isUpdateCustoms=!1},collectColumn:function(e){var t=this,i=_tools.UtilTools.getColumnList(e);if(this.tableFullColumn=i,this.cacheColumnMap(),this.customs&&this.mergeCustomColumn(this.customs),this.refreshColumn().then(function(){t.scrollXLoad&&t.updateVirtualScrollX(!0)}),this.handleTableData(!0),this.$toolbar&&this.$toolbar.updateColumn(i),i.length&&i.some(function(e){return e.columnKey})&&_tools.UtilTools.warn("vxe.error.delProp",["column.column-key","table.column-key"]),i.length){var o=Math.floor((i.length-1)/2);i[o].prop&&_tools.UtilTools.warn("vxe.error.delProp",["prop","field"]),i[o].label&&_tools.UtilTools.warn("vxe.error.delProp",["label","title"])}this.treeConfig&&i.some(function(e){return e.fixed})&&i.some(function(e){return"expand"===e.type})&&_tools.UtilTools.warn("vxe.error.treeFixedExpand")},tableColumn:function(){this.analyColumnWidth()},height:function(){var e=this;this.$nextTick(function(){return e.recalculate(!0)})},loading:function(){this._isLoading||(this._isLoading=!0)},syncResize:function(e){var t=this;e&&this.$nextTick(function(){return t.recalculate(!0)})}},created:function(){var e=this,t=this.scrollXStore,i=this.scrollYStore,o=this.optimizeOpts,l=this.ctxMenuOpts,n=this.showOverflow,r=this.radioOpts,s=this.checkboxOpts,a=this.treeConfig,c=this.treeOpts,u=this.editConfig,h=this.loading,d=this.showAllOverflow,f=this.showHeaderAllOverflow,p=o.scrollX,v=o.scrollY;h&&(this._isLoading=!0),v&&Object.assign(i,{startIndex:0,visibleIndex:0,renderSize:_xeUtils.default.toNumber(v.rSize),offsetSize:_xeUtils.default.toNumber(v.oSize)}),p&&Object.assign(t,{startIndex:0,visibleIndex:0,renderSize:_xeUtils.default.toNumber(p.rSize),offsetSize:_xeUtils.default.toNumber(p.oSize)}),_tools.UtilTools.getRowkey(this)||_tools.UtilTools.error("vxe.error.emptyProp",["row-id"]),this.startIndex,_xeUtils.default.isBoolean(d)&&_tools.UtilTools.warn("vxe.error.delProp",["show-all-overflow","show-overflow"]),_xeUtils.default.isBoolean(f)&&_tools.UtilTools.warn("vxe.error.delProp",["show-header-all-overflow","show-header-overflow"]),r.labelProp&&_tools.UtilTools.warn("vxe.error.delProp",["radio-config.labelProp","radio-config.labelField"]),this.selectConfig&&_tools.UtilTools.warn("vxe.error.delProp",["select-config","checkbox-config"]),a&&c.line&&!n&&_tools.UtilTools.warn("vxe.error.treeLineReqProp",["show-overflow"]),s.checkProp&&_tools.UtilTools.warn("vxe.error.delProp",["select-config.checkProp","select-config.checkField"]),s.labelProp&&_tools.UtilTools.warn("vxe.error.delProp",["select-config.labelProp","select-config.labelField"]),this.sortMethod&&_tools.UtilTools.warn("vxe.error.delProp",["sort-method","sort-config.sortMethod"]),this.remoteSort&&_tools.UtilTools.warn("vxe.error.delProp",["remote-sort","sort-config.remote"]),this.remoteFilter&&_tools.UtilTools.warn("vxe.error.delProp",["remote-filter","filter-config.remote"]),["header","body","footer"].forEach(function(e){l[e]&&l[e].visibleMethod&&_tools.UtilTools.warn("vxe.error.delProp",["context-menu.".concat(e,".visibleMethod"),"context-menu.visibleMethod"])}),this.lastScrollLeft=0,this.lastScrollTop=0,this.afterFullData=[],this.selectReserveRowMap={},this.fullAllDataRowMap=new Map,this.fullAllDataRowIdData={},this.fullDataRowMap=new Map,this.fullDataRowIdData={},this.fullColumnMap=new Map,this.fullColumnIdData={},this.loadTableData(this.data,!0).then(function(){s.key?_tools.UtilTools.warn("vxe.error.delProp",["select-config.key","row-id"]):a&&c.key?_tools.UtilTools.warn("vxe.error.delProp",["tree-config.key","row-id"]):u&&u.key&&_tools.UtilTools.warn("vxe.error.delProp",["edit-config.key","row-id"]),e.handleDefault()}),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent),_tools.GlobalEvent.on(this,"contextmenu",this.handleGlobalContextmenuEvent),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),_tools.GlobalEvent.on(this,"resize",this.handleGlobalResizeEvent),this.preventEvent(null,"created",{$table:this})},mounted:function(){var e=this;this.autoResize&&_tools.ResizeEvent.on(this,this.getParentElem(),function(){return e.recalculate(!0)}),document.body.appendChild(this.$refs.tableWrapper),this.preventEvent(null,"mounted",{$table:this})},activated:function(){this.refreshScroll(),this.preventEvent(null,"activated",{$table:this})},deactivated:function(){this.preventEvent(null,"deactivated",{$table:this})},beforeDestroy:function(){var e=this.$refs.tableWrapper;e&&e.parentNode&&e.parentNode.removeChild(e),_tools.ResizeEvent.off&&_tools.ResizeEvent.off(this,this.getParentElem()),this.closeFilter(),this.closeMenu(),this.clearAll(),this.preventEvent(null,"beforeDestroy",{$table:this})},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur"),_tools.GlobalEvent.off(this,"contextmenu"),_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"keydown"),_tools.GlobalEvent.off(this,"resize"),this.preventEvent(null,"destroyed",{$table:this})},render:function(e){var t=this._e,i=this.id,o=this.tableData,l=this.tableColumn,n=this.visibleColumn,r=this.collectColumn,s=this.isGroup,a=this.hasFilter,c=this.isResizable,u=this.isCtxMenu,h=this.loading,d=this.stripe,f=this._isLoading,p=this.showHeader,v=this.headerHeight,g=this.height,m=this.border,x=this.treeOpts,w=this.treeConfig,b=this.mouseConfig,T=this.vSize,C=this.validOpts,_=this.editRules,R=this.showFooter,S=this.footerMethod,y=this.overflowX,E=this.overflowY,D=this.scrollXLoad,U=this.scrollYLoad,O=this.scrollbarHeight,k=this.highlightHoverRow,I=this.highlightHoverColumn,$=this.editConfig,F=this.optimizeOpts,M=this.vaildTipOpts,L=this.tooltipOpts,A=this.columnStore,z=this.filterStore,P=this.ctxMenuStore,j=this.footerData,H=this.hasTip,W=A.leftList,B=A.rightList;return e("div",{class:["vxe-table",T?"size--".concat(T):"",m&&_xeUtils.default.isString(m)?"b--style-".concat(m):"",{"vxe-editable":$,"show--head":p,"show--foot":R,"has--height":g,"has--tree-line":w&&x.line,"fixed--left":W.length,"fixed--right":B.length,"t--animat":F.animat,"t--stripe":d,"t--border":m,"t--selected":b&&b.selected,"t--checked":b&&b.checked,"row--highlight":k,"column--highlight":I,"scroll--y":E,"scroll--x":y,"virtual--x":D,"virtual--y":U}]},[e("div",{class:"vxe-table-hidden-column",ref:"hideColumn"},this.$slots.default),e("div",{class:"vxe-table--main-wrapper"},[p?e("vxe-table-header",{ref:"tableHeader",props:{tableData:o,tableColumn:l,visibleColumn:n,collectColumn:r,size:T,isGroup:s}}):t(),e("vxe-table-body",{ref:"tableBody",props:{tableData:o,tableColumn:l,visibleColumn:n,collectColumn:r,size:T,isGroup:s}}),R?e("vxe-table-footer",{props:{footerData:j,footerMethod:S,tableColumn:l,visibleColumn:n,size:T},ref:"tableFooter"}):null]),W&&W.length&&y?renderFixed(e,this,"left"):t(),B&&B.length&&y?renderFixed(e,this,"right"):t(),h||o.length?t():e("div",{ref:"emptyPlaceholder",class:"vxe-table--empty-placeholder",style:g?null:{top:"".concat(v,"px")}},[e("div",{class:"vxe-table--empty-content"},this.$scopedSlots.empty?this.$scopedSlots.empty.call(this,{$table:this},e):_conf.default.i18n("vxe.table.emptyText"))]),c?e("div",{class:"vxe-table--resizable-bar",style:y?{"padding-bottom":"".concat(O,"px")}:null,ref:"resizeBar"}):t(),e("div",{class:"vxe-table--border-line"}),f?e("vxe-table-loading",{props:{visible:h}}):t(),a?e("vxe-table-filter",{props:{optimizeOpts:F,filterStore:z},ref:"filterWrapper"}):t(),e("div",{class:"vxe-table".concat(i,"-wrapper ").concat(this.$vnode.data.staticClass||""),ref:"tableWrapper"},[u?e("vxe-table-context-menu",{props:{ctxMenuStore:P},ref:"ctxWrapper"}):t(),H?e("vxe-tooltip",{ref:"tooltip",props:L,on:L.enterable?{leave:this.handleTooltipLeaveEvent}:null}):t(),H&&_&&("default"===C.message?!g:"tooltip"===C.message)?e("vxe-tooltip",{class:"vxe-table--valid-error",props:"tooltip"===C.message||1===o.length?M:null,ref:"validTip"}):t()])])},methods:{getParentElem:function(){return this.$grid?this.$grid.$el.parentNode:this.$el.parentNode},getParentHeight:function(){return this.$grid?this.$grid.getParentHeight():this.getParentElem().clientHeight},getExcludeHeight:function(){return this.$grid?this.$grid.getExcludeHeight():0},clearAll:function(){return this.clearSort(),this.clearFilter(),this.clearCurrentRow(),this.clearCurrentColumn(),this.clearSelection(),this.clearSelectReserve(),this.clearRowExpand(),this.clearTreeExpand(),this.clearChecked(),this.clearSelected(),this.clearActived(),this.clearScroll()},refreshData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadTableData(e.tableFullData)})})},updateData:function(){return this.handleTableData(!0).then(this.updateFooter).then(this.recalculate)},handleTableData:function(e){var t=this.scrollYLoad,i=this.scrollYStore,o=e?this.updateAfterFullData():this.afterFullData;return this.tableData=t?o.slice(i.startIndex,i.startIndex+i.renderSize):o.slice(0),this.$nextTick()},loadTableData:function(e,t){var i=this,o=this.height,l=this.maxHeight,n=this.showOverflow,r=this.treeConfig,s=this.editStore,a=this.optimizeOpts,c=this.scrollYStore,u=a.scrollY,h=e?e.slice(0):[],d=!r&&u&&u.gt&&u.gt<h.length;c.startIndex=0,c.visibleIndex=0,s.insertList=[],s.removeList=[],this.tableFullData=h,this.updateCache(!0),this.tableSynchData=e,this.tableSourceData=_xeUtils.default.clone(h,!0),!(this.scrollYLoad=d)||o||l||_tools.UtilTools.error("vxe.error.scrollYReqProp",["height | max-height"]),d&&!n&&_tools.UtilTools.warn("vxe.error.scrollYReqProp",["show-overflow"]);var f=Promise.resolve();return d&&(f=this.computeScrollLoad()),f.then(function(){return i.isLoadData=!0,i.computeRowHeight(),i.handleTableData(!0),i.handleReserveStatus(),i.checkSelectionStatus(),f=i.$nextTick(),t||(f=f.then(i.recalculate)),f.then(i.refreshScroll)})},loadData:function(e){return this.loadTableData(e)},reloadData:function(e){var t=this;return this.clearAll().then(function(){return t.loadTableData(e)}).then(this.handleDefault)},reloadRow:function(e,t,i){var o=this.tableSourceData,l=this.tableData,n=this.getRowIndex(e),r=o[n];return r&&e&&(i?_xeUtils.default.set(r,i,_xeUtils.default.get(t||e,i)):t?(o[n]=t,_xeUtils.default.clear(e,void 0),Object.assign(e,this.defineField(Object.assign({},t))),this.updateCache(!0)):_xeUtils.default.destructuring(r,_xeUtils.default.clone(e,!0))),this.tableData=l.slice(0),this.$nextTick()},loadColumn:function(e){var t=this;return this.collectColumn=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)},headerProps),this.$nextTick()},reloadColumn:function(e){return this.clearAll(),this.loadColumn(e)},updateCache:function(l){var n=this,e=this.treeConfig,r=this.treeOpts,t=this.tableFullData,s=this.fullDataRowIdData,a=this.fullDataRowMap,c=this.fullAllDataRowMap,u=this.fullAllDataRowIdData,h=_tools.UtilTools.getRowkey(this),d=e&&r.lazy,i=function(e,t){var i=_tools.UtilTools.getRowid(n,e);i||(i=getRowUniqueId(),_xeUtils.default.set(e,h,i)),d&&e[r.hasChild]&&_xeUtils.default.isUndefined(e[r.children])&&(e[r.children]=null);var o={row:e,rowid:i,index:t};l&&(s[i]=o,a.set(e,o)),u[i]=o,c.set(e,o)};l&&(s=this.fullDataRowIdData={},a.clear()),u=this.fullAllDataRowIdData={},c.clear(),e?_xeUtils.default.eachTree(t,i,r):t.forEach(i)},appendTreeCache:function(e,t){var l=this,i=this.tableSourceData,o=this.treeOpts,n=this.fullDataRowIdData,r=this.fullDataRowMap,s=this.fullAllDataRowMap,a=this.fullAllDataRowIdData,c=o.children,u=o.hasChild,h=_tools.UtilTools.getRowkey(this),d=_tools.UtilTools.getRowid(this,e),f=_xeUtils.default.findTree(i,function(e){return d===_tools.UtilTools.getRowid(l,e)},o);f&&(f.item[c]=_xeUtils.default.clone(t,!0)),_xeUtils.default.eachTree(t,function(e,t){var i=_tools.UtilTools.getRowid(l,e);i||(i=getRowUniqueId(),_xeUtils.default.set(e,h,i)),e[u]&&_xeUtils.default.isUndefined(e[c])&&(e[c]=null);var o={row:e,rowid:i,index:t};n[i]=o,r.set(e,o),a[i]=o,s.set(e,o)},o)},cacheColumnMap:function(){var e=this.isGroup,t=this.tableFullColumn,i=this.collectColumn,o=this.fullColumnMap,l=this.fullColumnIdData={};o.clear(),e&&_xeUtils.default.eachTree(i,function(e,t){if(e.children&&e.children.length){var i={column:e,colid:e.id,index:t};l[e.id]=i,o.set(e,i)}},headerProps),t.forEach(function(e,t){var i={column:e,colid:e.id,index:t};l[e.id]=i,o.set(e,i)},headerProps)},getRowNode:function(e){var t=this;if(e){var i=this.treeConfig,o=this.treeOpts,l=this.tableFullData,n=this.fullAllDataRowIdData,r=e.getAttribute("data-rowid");if(i){var s=_xeUtils.default.findTree(l,function(e){return _tools.UtilTools.getRowid(t,e)===r},o);if(s)return s}else if(n[r]){var a=n[r];return{item:a.row,index:a.index,items:l}}}return null},getColumnNode:function(e){if(e){var t=this.fullColumnIdData,i=this.tableFullColumn,o=t[e.getAttribute("data-colid")];return{item:o.column,index:o.index,items:i}}return null},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},$getRowIndex:function(e){return this.afterFullData.indexOf(e)},getColumnMapIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},getColumnIndex:function(e){return this.getColumnMapIndex(e)},$getColumnIndex:function(e){return this.visibleColumn.indexOf(e)},isSeqColumn:function(e){return e&&("seq"===e.type||"index"===e.type)},insert:function(e){return this.insertAt(e)},insertAt:function(e,t){var i=this,o=this.afterFullData,l=this.editStore,n=this.scrollYLoad,r=this.tableFullData;if(this.treeConfig)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["insert"]));_xeUtils.default.isArray(e)||(e=[e]);var s=o,a=e.map(function(e){return i.defineField(Object.assign({},e))});if(t)if(-1===t)s.push.apply(s,a),r.push.apply(r,a);else{var c=s.indexOf(t);if(-1===c)throw new Error(_tools.UtilTools.error("vxe.error.unableInsert"));s.splice.apply(s,[c,0].concat(a)),r.splice.apply(r,[r.indexOf(t),0].concat(a))}else s.unshift.apply(s,a),r.unshift.apply(r,a);return[].unshift.apply(l.insertList,a),this.handleTableData(),this.updateCache(),this.checkSelectionStatus(),n&&this.updateScrollYSpace(),this.$nextTick().then(function(){return i.recalculate(),{row:a.length?a[a.length-1]:null,rows:a}})},defineField:function(o){var e=this.treeConfig,t=this.treeOpts,i=_tools.UtilTools.getRowkey(this);return this.visibleColumn.forEach(function(e){var t=e.property,i=e.editRender;t&&!_xeUtils.default.has(o,t)&&_xeUtils.default.set(o,t,i&&!_xeUtils.default.isUndefined(i.defaultValue)?i.defaultValue:null)}),e&&t.lazy&&_xeUtils.default.isUndefined(o[t.children])&&(o[t.children]=null),_xeUtils.default.get(o,i)||_xeUtils.default.set(o,i,getRowUniqueId()),o},createData:function(e){var t=this;return this.$nextTick().then(function(){return e.map(t.defineField)})},createRow:function(t){var i=this,o=_xeUtils.default.isArray(t);return o||(t=[t]),this.$nextTick().then(function(){var e=t.map(function(e){return i.defineField(Object.assign({},e))});return o?e:e[0]})},remove:function(t){var e=this,i=this.afterFullData,o=this.tableFullData,l=this.editStore,n=this.treeConfig,r=this.checkboxOpts,s=this.selection,a=this.hasInsertByRow,c=this.scrollYLoad,u=l.removeList,h=l.insertList,d=r.checkField||r.checkProp,f=[],p=i;if(n)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["remove"]));return t?_xeUtils.default.isArray(t)||(t=[t]):t=o,t.forEach(function(e){a(e)||u.push(e)}),d||_xeUtils.default.remove(s,function(e){return-1<t.indexOf(e)}),o===t?(t=f=o.slice(0),o.length=0,p.length=0):(f=_xeUtils.default.remove(o,function(e){return-1<t.indexOf(e)}),_xeUtils.default.remove(p,function(e){return-1<t.indexOf(e)})),_xeUtils.default.remove(h,function(e){return-1<t.indexOf(e)}),this.handleTableData(),this.updateCache(),this.checkSelectionStatus(),c&&this.updateScrollYSpace(),this.$nextTick().then(function(){return e.recalculate(),{row:f&&f.length?f[f.length-1]:null,rows:f}})},removeSelecteds:function(){var t=this;return this.remove(this.getSelectRecords()).then(function(e){return t.clearSelection(),e})},revert:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["revert","revertData"]),this.revertData.apply(this,arguments)},revertData:function(e,o){var l=this.tableSourceData,n=this.tableFullData;return arguments.length?(e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){var t=n.indexOf(e),i=l[t];i&&e&&(o?_xeUtils.default.set(e,o,_xeUtils.default.get(i,o)):_xeUtils.default.destructuring(e,i))}),this.$nextTick()):this.reloadData(l)},clearData:function(e,t){var i=this.tableSourceData,o=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=i,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){o.forEach(function(e){e.property&&_tools.UtilTools.setCellValue(t,e,null)})}),this.$nextTick()},hasInsertByRow:function(t){var e=this.treeConfig,i=this.treeOpts,o=this.tableSourceData;return e?_xeUtils.default.findTree(o,function(e){return e===t},i):-1===this.getRowIndex(t)},hasRowChange:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowChange","isUpdateByRow"]),this.isUpdateByRow(e,t)},isUpdateByRow:function(e,t){var i,o,l=this,n=this.visibleColumn,r=this.treeConfig,s=this.treeOpts,a=this.tableSourceData,c=this.fullDataRowIdData,u=_tools.UtilTools.getRowid(this,e);if(!c[u])return!1;if(r){var h=s.children,d=_xeUtils.default.findTree(a,function(e){return u===_tools.UtilTools.getRowid(l,e)},s);e=Object.assign({},e,_defineProperty({},h,null)),d&&(i=Object.assign({},d.item,_defineProperty({},h,null)))}else{i=a[c[u].index]}if(i){if(1<arguments.length)return!_xeUtils.default.isEqual(_xeUtils.default.get(i,t),_xeUtils.default.get(e,t));for(var f=0,p=n.length;f<p;f++)if((o=n[f].property)&&!_xeUtils.default.isEqual(_xeUtils.default.get(i,o),_xeUtils.default.get(e,o)))return!0}return!1},getColumns:function(e){var t=this.visibleColumn;return arguments.length?t[e]:t.slice(0)},getColid:function(e){var t=this.fullColumnMap;return t.has(e)?t.get(e).colid:null},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(t){return _xeUtils.default.find(this.tableFullColumn,function(e){return e.property===t})},getTableColumn:function(){return{fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getRecords","getData"]),this.getData.apply(this,arguments)},getData:function(e){var t=this.data||this.tableSynchData;return arguments.length?t[e]:t.slice(0)},getAllRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getAllRecords","getRecordset"]),this.getRecordset()},getRecordset:function(){return{insertRecords:this.getInsertRecords(),removeRecords:this.getRemoveRecords(),updateRecords:this.getUpdateRecords()}},getInsertRecords:function(){return this.editStore.insertList},getRemoveRecords:function(){return this.editStore.removeList},getSelectRecords:function(){var e=this.tableFullData,t=this.treeConfig,i=this.treeOpts,o=this.checkboxOpts.checkField,l=[];if(o)l=t?_xeUtils.default.filterTree(e,function(e){return _xeUtils.default.get(e,o)},i):e.filter(function(e){return _xeUtils.default.get(e,o)});else{var n=this.selection;l=t?_xeUtils.default.filterTree(e,function(e){return-1<n.indexOf(e)},i):e.filter(function(e){return-1<n.indexOf(e)})}return l},getUpdateRecords:function(){var e=this.tableFullData,t=this.isUpdateByRow,i=this.treeConfig,o=this.treeOpts;return i?_xeUtils.default.filterTree(e,function(e){return t(e)},o):e.filter(function(e){return t(e)})},updateAfterFullData:function(){var e=this.visibleColumn,t=this.tableFullData,i=this.remoteSort,c=this.remoteFilter,u=this.filterOpts,o=this.sortOpts,l=t,n=_xeUtils.default.find(e,function(e){return e.order}),r=[];if(e.forEach(function(e){if(e.filters&&e.filters.length){var t=[],i=[];e.filters.forEach(function(e){e.checked&&(i.push(e),t.push(e.value))}),r.push({column:e,valueList:t,itemList:i})}}),r.length&&(l=l.filter(function(a){return r.every(function(e){var t=e.column,i=e.valueList,o=e.itemList;if(!i.length||u.remote||c)return!0;var l=t.filterRender,n=t.property,r=t.filterMethod,s=l?_vXETable.Renderer.get(l.name):null;return!r&&s&&s.renderFilter&&(r=s.filterMethod),r?o.some(function(e){return r({value:e.value,option:e,row:a,column:t})}):-1<i.indexOf(_xeUtils.default.get(a,n))})})),n&&n.order){var s=o.sortMethod||this.sortMethod;if(!(_xeUtils.default.isBoolean(n.remoteSort)?n.remoteSort:o.remote||i))if(s)l=s({data:l,column:n,property:n.property,order:n.order,$table:this})||l;else{var a=n.sortMethod?l.sort(n.sortMethod):_xeUtils.default.sortBy(l,n.property);l="desc"===n.order?a.reverse():a}}return this.afterFullData=l},getRowById:function(e){var t=this.fullDataRowIdData;return t[e]?t[e].row:null},getRowid:function(e){var t=this.fullAllDataRowMap;return t.has(e)?t.get(e).rowid:null},getTableData:function(){var e=this.tableFullData,t=this.afterFullData,i=this.tableData,o=this.footerData;return{fullData:e.slice(0),visibleData:t.slice(0),tableData:i.slice(0),footerData:o.slice(0)}},handleDefault:function(){(this.checkboxConfig||this.selectConfig)&&this.handleSelectionDefChecked(),this.radioConfig&&this.handleRadioDefChecked(),this.sortConfig&&this.handleDefaultSort(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.updateFooter(),this.$nextTick(this.recalculate)},mergeCustomColumn:function(i){this.isUpdateCustoms=!0,this.tableFullColumn.forEach(function(t){var e=_xeUtils.default.find(i,function(e){return t.property&&(e.field||e.prop)===t.property});e&&(_xeUtils.default.isNumber(e.resizeWidth)&&(t.resizeWidth=e.resizeWidth),_xeUtils.default.isBoolean(e.visible)&&(t.visible=e.visible))}),this.$emit("update:customs",this.tableFullColumn)},resetAll:function(){this.resetCustoms(),this.resetResizable()},hideColumn:function(e){return this.handleVisibleColumn(e,!1)},showColumn:function(e){return this.handleVisibleColumn(e,!0)},resetCustoms:function(){return this.handleVisibleColumn()},handleVisibleColumn:function(e,t){return arguments.length?e.visible=t:this.tableFullColumn.forEach(function(e){e.visible=!0}),this.$toolbar&&this.$toolbar.handleCustoms(),this.$nextTick()},reloadCustoms:function(e){var t=this;return this.$nextTick().then(function(){return t.mergeCustomColumn(e),t.refreshColumn().then(function(){return t.tableFullColumn})})},refreshColumn:function(){var i,e=this,o=0,l=[],n=null,r=null,s=[],a=[],t=this.collectColumn,c=this.tableFullColumn,u=this.isGroup,h=this.columnStore,d=this.scrollXStore,f=this.optimizeOpts.scrollX;u&&_xeUtils.default.eachTree(t,function(e){e.children&&e.children.length&&(e.visible=!!_xeUtils.default.findTree(e.children,function(e){return e.children&&e.children.length?0:e.visible},headerProps))},headerProps),c.filter(function(e){return e.visible}).forEach(function(e,t){"left"===e.fixed?(null===n&&(n=o),i||(t-o!=0?i=!0:o++),l.push(e)):"right"===e.fixed?(i||(null===r&&(r=t),t-r!=0?i=!0:r++),a.push(e)):s.push(e)});var p=l.concat(s).concat(a),v=f&&f.gt&&f.gt<c.length;return Object.assign(h,{leftList:l,centerList:s,rightList:a}),u&&(i||n||null!==r&&r!==p.length)&&_tools.UtilTools.error("vxe.error.groupFixed"),v&&(this.isGroup&&_tools.UtilTools.warn("vxe.error.scrollXNotGroup"),d.startIndex=0,d.visibleIndex=0,p=p.slice(d.startIndex,d.startIndex+d.renderSize)),this.scrollXLoad=v,this.tableColumn=p,this.$nextTick().then(function(){e.updateFooter(),e.recalculate(!0)})},analyColumnWidth:function(){var t=this.columnWidth,i=this.columnMinWidth,o=[],l=[],n=[],r=[],s=[],a=[];this.tableFullColumn.forEach(function(e){t&&!e.width&&(e.width=t),i&&!e.minWidth&&(e.minWidth=i),e.visible&&(e.resizeWidth?o.push(e):_tools.DomTools.isPx(e.width||t)?l.push(e):_tools.DomTools.isScale(e.width||t)?r.push(e):_tools.DomTools.isPx(e.minWidth||i)?n.push(e):_tools.DomTools.isScale(e.minWidth||i)?s.push(e):a.push(e))}),Object.assign(this.columnStore,{resizeList:o,pxList:l,pxMinList:n,scaleList:r,scaleMinList:s,autoList:a})},refreshScroll:function(){var e=this,t=this.lastScrollLeft,i=this.lastScrollTop;return this.clearScroll(),this.$nextTick().then(function(){if(t||i)return e.lastScrollLeft=0,e.lastScrollTop=0,e.scrollTo(t,i)})},recalculate:function(e){var t=this,i=this.$refs,o=i.tableBody,l=i.tableHeader,n=i.tableFooter,r=o?o.$el:null,s=l?l.$el:null,a=n?n.$el:null;if(r){var c=r.clientWidth;if(this.autoCellWidth(s,r,a,c),!0===e)return this.computeScrollLoad().then(function(){c=r.clientWidth,t.autoCellWidth(s,r,a,c),t.computeScrollLoad()})}return this.computeScrollLoad()},autoCellWidth:function(e,t,i,o){var l,n=0,r=o,s=this.fit,a=this.columnStore,c=a.resizeList,u=a.pxMinList,h=a.pxList,d=a.scaleList,f=a.scaleMinList,p=a.autoList;if(u.forEach(function(e){var t=parseInt(e.minWidth);n+=t,e.renderWidth=t}),l=r/100,f.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*l);n+=t,e.renderWidth=t}),d.forEach(function(e){var t=Math.floor(parseInt(e.width)*l);n+=t,e.renderWidth=t}),h.forEach(function(e){var t=parseInt(e.width);n+=t,e.renderWidth=t}),c.forEach(function(e){var t=parseInt(e.resizeWidth);n+=t,e.renderWidth=t}),l=0<(r-=n)?Math.floor(r/(f.length+u.length+p.length)):0,s?0<r&&f.concat(u).forEach(function(e){n+=l,e.renderWidth+=l}):l=40,p.forEach(function(e,t){var i=Math.max(l,40);e.renderWidth=i,n+=i}),s){var v=d.concat(f).concat(u).concat(p),g=v.length-1;if(0<g){var m=o-n;if(0<m){for(;0<m&&0<=g;)m--,v[g--].renderWidth++;n=o}}}var x=t.offsetHeight,w=t.scrollHeight>t.clientHeight;if(this.scrollbarWidth=w?t.offsetWidth-o:0,this.overflowY=w,this.tableWidth=n,this.tableHeight=x,this.parentHeight=this.getParentHeight(),e&&(this.headerHeight=e.offsetHeight),i){var b=i.offsetHeight;this.scrollbarHeight=Math.max(b-i.clientHeight,0),this.overflowX=n>i.clientWidth,this.footerHeight=b}else this.scrollbarHeight=Math.max(x-t.clientHeight,0),this.overflowX=o<n;return this.overflowX&&this.checkScrolling(),n},resetResizable:function(){return this.visibleColumn.forEach(function(e){e.resizeWidth=0}),this.$toolbar&&this.$toolbar.resetResizable(),this.analyColumnWidth(),this.recalculate(!0)},checkScrolling:function(){var e=this.$refs,t=e.tableBody,i=e.leftBody,o=e.rightBody,l=t?t.$el:null;l&&(i&&(this.scrollLeftToRight=0<l.scrollLeft),o&&(this.scrollRightToLeft=l.clientWidth<l.scrollWidth-l.scrollLeft))},preventEvent:function(t,e,i,o,l){var n,r=this;return _vXETable.Interceptor.get(e).some(function(e){return!1===e(i,t,r)})||o&&(n=o()),l&&l(),n},handleGlobalMousedownEvent:function(i){var o=this,l=this.$el,e=this.$refs,t=this.editStore,n=this.ctxMenuStore,r=this.editConfig,s=void 0===r?{}:r,a=this.filterStore,c=this.getRowNode,u=t.actived,h=e.filterWrapper,d=e.validTip;h&&(_tools.DomTools.getEventTargetNode(i,this.$el,"vxe-filter-wrapper").flag||_tools.DomTools.getEventTargetNode(i,h.$el).flag||this.preventEvent(i,"event.clearFilter",a.args,this.closeFilter)),u.row&&!1!==s.autoClear&&(d&&_tools.DomTools.getEventTargetNode(i,d.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&this.preventEvent(i,"event.clearActived",u.args,function(){var e;if("row"===s.mode){var t=_tools.DomTools.getEventTargetNode(i,l,"vxe-body--row");e=t.flag?c(t.targetElem).item!==c(u.args.cell.parentNode).item:0}else e=!_tools.DomTools.getEventTargetNode(i,l,"col--edit").flag;!e&&_tools.DomTools.getEventTargetNode(i,o.$el).flag||setTimeout(function(){return o.clearActived(i)})})),n.visible&&this.$refs.ctxWrapper&&!_tools.DomTools.getEventTargetNode(i,this.$refs.ctxWrapper.$el).flag&&this.closeMenu(),this.isActivated=_tools.DomTools.getEventTargetNode(i,(this.$grid||this).$el).flag},handleGlobalBlurEvent:function(e){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(e){this.clostTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(L){var A=this;this.isActivated&&this.preventEvent(L,"event.keydown",{$table:this},function(){var e,t=A.isCtxMenu,i=A.ctxMenuStore,o=A.editStore,l=A.mouseConfig,n=void 0===l?{}:l,r=A.keyboardConfig,s=void 0===r?{}:r,a=A.treeConfig,c=A.treeOpts,u=A.highlightCurrentRow,h=A.currentRow,d=o.selected,f=o.actived,p=L.keyCode,v=8===p,g=9===p,m=13===p,x=27===p,w=32===p,b=37===p,T=38===p,C=39===p,_=40===p,R=46===p,S=67===p,y=86===p,E=88===p,D=113===p,U=L.ctrlKey,O=L.shiftKey,k=b||T||C||_,I=t&&i.visible&&(m||w||k);if(x)A.closeMenu(),A.closeFilter(),f.row&&(e=f.args,A.clearActived(L),n.selected&&A.handleSelected(e,L));else if(w&&(s.isArrow||s.isTab)&&d.row&&d.column&&("checkbox"===d.column.type||"selection"===d.column.type||"radio"===d.column.type))L.preventDefault(),"checkbox"===d.column.type||"selection"===d.column.type?A.handleToggleCheckRowEvent(d.args,L):A.triggerRadioRowEvent(L,d.args);else if(m&&(s.isArrow||s.isTab)&&(d.row||f.row||a&&u&&h)){if(d.row||f.row)A.moveSelected(d.row?d.args:f.args,b,T,C,!0,L);else if(a&&u&&h){var $=h[c.children];if($&&$.length){L.preventDefault();var F=$[0];e={$table:A,row:F},A.setTreeExpansion(h,!0).then(function(){return A.scrollToRow(F)}).then(function(){return A.triggerCurrentRowEvent(L,e)})}}}else if(I)L.preventDefault(),i.showChild&&_tools.UtilTools.hasChildrenList(i.selected)?A.moveCtxMenu(L,p,i,"selectChild",37,!1,i.selected.children):A.moveCtxMenu(L,p,i,"selected",39,!0,A.ctxMenuList);else if(D)d.row&&d.column&&(L.preventDefault(),A.handleActived(d.args,L));else if(k&&s.isArrow)d.row&&d.column?A.moveSelected(d.args,b,T,C,_,L):(T||_)&&u&&h&&A.moveCurrentRow(T,_,L);else if(g&&s.isTab)d.row||d.column?A.moveTabSelected(d.args,O,L):(f.row||f.column)&&A.moveTabSelected(f.args,O,L);else if(R||(a&&u&&h?v&&s.isArrow:v)){if(s.isDel&&(d.row||d.column))_tools.UtilTools.setCellValue(d.row,d.column,null),v&&A.handleActived(d.args,L);else if(v&&s.isArrow&&a&&u&&h){var M=_xeUtils.default.findTree(A.afterFullData,function(e){return e===h},c).parent;M&&(L.preventDefault(),e={$table:A,row:M},A.setTreeExpansion(M,!1).then(function(){return A.scrollToRow(M)}).then(function(){return A.triggerCurrentRowEvent(L,e)}))}}else s.isCut&&U&&(E||S||y)?E||S?A.handleCopyed(E,L):A.handlePaste(L):s.isEdit&&!U&&(48<=p&&p<=57||65<=p&&p<=90||96<=p&&p<=111||186<=p&&p<=192||219<=p&&p<=222||32===p)&&(d.row||d.column)&&(s.editMethod&&!1===s.editMethod(d.args,L)||(_tools.UtilTools.setCellValue(d.row,d.column,null),A.handleActived(d.args,L)))})},moveTabSelected:function(e,t,i){var o,l,n,r,s=this.afterFullData,a=this.visibleColumn,c=this.editConfig,u=this.isSeqColumn,h=Object.assign({},e),d=s.indexOf(h.row),f=a.indexOf(h.column);if(i.preventDefault(),t){for(var p=f-1;0<=p;p--)if(!u(a[p])){n=a[r=p];break}if(!n&&0<d){o=s[l=d-1];for(var v=a.length-1;0<=v;v--)if(!u(a[v])){n=a[r=v];break}}}else{for(var g=f+1;g<a.length;g++)if(!u(a[g])){n=a[r=g];break}if(!n&&d<s.length-1){o=s[l=d+1];for(var m=0;m<a.length;m++)if(!u(a[m])){n=a[r=m];break}}}n&&(o?(h.rowIndex=l,h.row=o):h.rowIndex=d,h.columnIndex=r,h.column=n,h.cell=_tools.DomTools.getCell(this,h),c&&("click"!==c.trigger&&"dblclick"!==c.trigger||("row"===c.mode?this.handleActived(h,i):(this.handleSelected(h,i),this.scrollToRow(h.row,h.column)))))},moveCurrentRow:function(e,t,i){var o,l=this,n=this.currentRow,r=this.treeConfig,s=this.treeOpts,a=this.afterFullData;if(i.preventDefault(),r){var c=_xeUtils.default.findTree(a,function(e){return e===n},s),u=c.index,h=c.items;e&&0<u?o=h[u-1]:t&&u<h.length-1&&(o=h[u+1])}else{var d=a.indexOf(n);e&&0<d?o=a[d-1]:t&&d<a.length-1&&(o=a[d+1])}if(o){var f={$table:this,row:o};this.scrollToRow(o).then(function(){return l.triggerCurrentRowEvent(i,f)})}},moveSelected:function(e,t,i,o,l,n){var r=this.afterFullData,s=this.visibleColumn,a=Object.assign({},e);if(n.preventDefault(),i&&a.rowIndex)a.rowIndex-=1,a.row=r[a.rowIndex];else if(l&&a.rowIndex<r.length-1)a.rowIndex+=1,a.row=r[a.rowIndex];else if(t&&a.columnIndex){for(var c=a.columnIndex-1;0<=c;c--)if(s[c].editRender){a.columnIndex=c,a.column=s[c];break}}else if(o&&a.columnIndex)for(var u=a.columnIndex+1;u<s.length;u++)if(s[u].editRender){a.columnIndex=u,a.column=s[u];break}a.cell=_tools.DomTools.getCell(this,a),this.handleSelected(a,n),this.scrollToRow(a.row,a.column)},moveCtxMenu:function(e,t,i,o,l,n,r){var s,a=_xeUtils.default.findIndexOf(r,function(e){return i[o]===e});if(t===l)n&&_tools.UtilTools.hasChildrenList(i.selected)?i.showChild=!0:(i.showChild=!1,i.selectChild=null);else if(38===t){for(var c=a-1;0<=c;c--)if(!1!==r[c].visible){s=r[c];break}i[o]=s||r[r.length-1]}else if(40===t){for(var u=a+1;u<r.length;u++)if(!1!==r[u].visible){s=r[u];break}i[o]=s||r[0]}else!i[o]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,i[o])},handleGlobalResizeEvent:function(){this.recalculate()},handleGlobalContextmenuEvent:function(e){var t=this.isCtxMenu,i=this.ctxMenuStore,o=this.ctxMenuOpts,l=["header","body","footer"];if(t){if(i.visible&&i.visible&&this.$refs.ctxWrapper&&_tools.DomTools.getEventTargetNode(e,this.$refs.ctxWrapper.$el).flag)return void e.preventDefault();for(var n=0;n<l.length;n++){var r=l[n],s=_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-".concat(r,"--column")),a={type:r,$table:this,columns:this.visibleColumn.slice(0)};if(s.flag){var c=s.targetElem,u=this.getColumnNode(c).item,h="".concat(r,"-");if(Object.assign(a,{column:u,columnIndex:this.getColumnIndex(u),cell:c}),"body"===r){var d=this.getRowNode(c.parentNode).item;h="",a.row=d,a.rowIndex=this.getRowIndex(d)}return this.openContextMenu(e,r,a),void _tools.UtilTools.emitEvent(this,"".concat(h,"cell-context-menu"),[a,e])}if(_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-table--".concat(r,"-wrapper")).flag)return void("cell"===o.trigger?e.preventDefault():this.openContextMenu(e,r,a))}}this.closeMenu(),this.closeFilter()},openContextMenu:function(c,e,o){var u=this,h=this.ctxMenuStore,t=this.ctxMenuOpts,i=t[e];if(i){var l=i.options,n=i.disabled,d=i.visibleMethod||t.visibleMethod;n?c.preventDefault():l&&l.length&&(o.options=l,this.preventEvent(c,"event.showMenu",o,null,function(){if(!d||d(o,c)){c.preventDefault(),u.updateZindex();var e=_tools.DomTools.getDomNode(),t=e.scrollTop,i=e.scrollLeft,n=e.visibleHeight,r=e.visibleWidth,s=c.clientY+t,a=c.clientX+i;Object.assign(h,{args:o,visible:!0,list:l,selected:null,selectChild:null,showChild:!1,style:{zIndex:u.tZindex,top:"".concat(s,"px"),left:"".concat(a,"px")}}),u.$nextTick(function(){var e=u.$refs.ctxWrapper.$el,t=e.clientHeight,i=e.clientWidth,o=c.clientY+t-n,l=c.clientX+i-r;-10<o&&(h.style.top="".concat(s-t,"px")),-10<l&&(h.style.left="".concat(a-i,"px"))})}else u.closeMenu()}))}this.closeFilter()},closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,selectChild:null,showChild:!1}),this.$nextTick()},ctxMenuMouseoverEvent:function(e,t,i){var o=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),o.selected=t,(o.selectChild=i)||(o.showChild=_tools.UtilTools.hasChildrenList(t))},ctxMenuMouseoutEvent:function(e,t,i){var o=this.ctxMenuStore;t.children||(o.selected=null),o.selectChild=null},ctxMenuLinkEvent:function(e,t){if(!(t.disabled||t.children&&t.children.length)){var i=_vXETable.Menus.get(t.code),o=Object.assign({menu:t,$table:this},this.ctxMenuStore.args);i&&i.call(this,o,e),_tools.UtilTools.emitEvent(this,"context-menu-click",[Object.assign({menu:t,$table:this},this.ctxMenuStore.args),e]),this.closeMenu()}},handleTooltipLeaveEvent:function(e){var t=this,i=this.tooltipOpts;setTimeout(function(){t.tooltipActive||t.clostTooltip()},i.leaveDelay)},handleTargetEnterEvent:function(e){clearTimeout(this.tooltipTimeout),this.tooltipActive=!0,this.clostTooltip()},handleTargetLeaveEvent:function(e){var t=this,i=this.tooltipOpts;this.tooltipActive=!1,i.enterable?this.tooltipTimeout=setTimeout(function(){t.$refs.tooltip.isHover||t.clostTooltip()},i.leaveDelay):this.clostTooltip()},triggerHeaderTooltipEvent:function(e,t){var i=this.tooltipStore,o=t.column;this.handleTargetEnterEvent(),i.column===o&&i.visible||this.handleTooltip(e,o)},triggerFooterTooltipEvent:function(e,t){var i=t.column,o=this.tooltipStore;this.handleTargetEnterEvent(),o.column===i&&o.visible||this.handleTooltip(e,i)},triggerTooltipEvent:function(e,t){var i=this.editConfig,o=this.editStore,l=this.tooltipStore,n=o.actived,r=t.row,s=t.column;this.handleTargetEnterEvent(),i&&("row"===i.mode&&n.row===r||n.row===r&&n.column===s)||l.column===s&&l.row===r&&l.visible||this.handleTooltip(e,s,r)},handleTooltip:function(e,t,i){var o=e.currentTarget,l=this.$refs.tooltip,n=o.children[0],r=o.innerText;return r&&n.scrollWidth>n.clientWidth&&(Object.assign(this.tooltipStore,{row:i,column:t,visible:!0}),l&&l.toVisible(o,r)),this.$nextTick()},clostTooltip:function(){var e=this.$refs.tooltip;return Object.assign(this.tooltipStore,{row:null,column:null,content:null,visible:!1}),e&&e.close(),this.$nextTick()},handleSelectionDefChecked:function(){var t=this.fullDataRowIdData,e=this.checkboxOpts,i=e.checkAll,o=e.checkRowKeys;if(i)this.setAllSelection(!0);else if(o){var l=[];o.forEach(function(e){t[e]&&l.push(t[e].row)}),this.setSelection(l,!0)}},setSelection:function(e,t){var i=this;return e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){return i.handleSelectRow(null,{row:e},!!t)}),this.$nextTick()},isCheckedByRow:function(e){var t=this.checkboxOpts.checkField;return t?_xeUtils.default.get(e,t):-1<this.selection.indexOf(e)},handleSelectRow:function(e,t,i){var o=this,l=t.row,n=this.selection,r=this.tableFullData,s=this.treeConfig,a=this.treeOpts,c=this.treeIndeterminates,u=this.checkboxOpts,h=u.checkStrictly,d=u.checkMethod,f=u.checkField||u.checkProp;if(f)if(s&&!h){-1===i?(c.push(l),_xeUtils.default.set(l,f,!1)):(_xeUtils.default.eachTree([l],function(e,t){l!==e&&d&&!d({row:e,$rowIndex:t})||(_xeUtils.default.set(e,f,i),o.handleSelectReserveRow(l,i))},a),_xeUtils.default.remove(c,function(e){return e===l}));var p=_xeUtils.default.findTree(r,function(e){return e===l},a);if(p&&p.parent){var v,g=d?p.items.filter(function(e,t){return d({row:e,$rowIndex:t})}):p.items;if(_xeUtils.default.find(p.items,function(e){return-1<c.indexOf(e)}))v=-1;else{var m=p.items.filter(function(e){return _xeUtils.default.get(e,f)});v=m.filter(function(e){return-1<g.indexOf(e)}).length===g.length||!(!m.length&&-1!==i)&&-1}return this.handleSelectRow(e,{row:p.parent},v)}}else _xeUtils.default.set(l,f,i),this.handleSelectReserveRow(l,i);else if(s&&!h){-1===i?(c.push(l),_xeUtils.default.remove(n,function(e){return e===l})):(_xeUtils.default.eachTree([l],function(t,e){l!==t&&d&&!d({row:t,$rowIndex:e})||(i?n.push(t):_xeUtils.default.remove(n,function(e){return e===t}),o.handleSelectReserveRow(l,i))},a),_xeUtils.default.remove(c,function(e){return e===l}));var x=_xeUtils.default.findTree(r,function(e){return e===l},a);if(x&&x.parent){var w,b=d?x.items.filter(function(e,t){return d({row:e,$rowIndex:t})}):x.items;if(_xeUtils.default.find(x.items,function(e){return-1<c.indexOf(e)}))w=-1;else{var T=x.items.filter(function(e){return-1<n.indexOf(e)});w=T.filter(function(e){return-1<b.indexOf(e)}).length===b.length||!(!T.length&&-1!==i)&&-1}return this.handleSelectRow(e,{row:x.parent},w)}}else i?-1===n.indexOf(l)&&n.push(l):_xeUtils.default.remove(n,function(e){return e===l}),this.handleSelectReserveRow(l,i);this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var i=this.selection,o=this.checkboxOpts.checkField,l=e.row,n=o?!_xeUtils.default.get(l,o):-1===i.indexOf(l);t?this.triggerCheckRowEvent(t,e,n):this.handleSelectRow(null,e,n)},triggerCheckRowEvent:function(e,t,i){var o=this.checkboxOpts.checkMethod;o&&!o({row:t.row,rowIndex:t.rowIndex,$rowIndex:t.$rowIndex})||(this.handleSelectRow(e,t,i),_tools.UtilTools.emitEvent(this,"select-change",[Object.assign({selection:this.getSelectRecords(),reserves:this.getSelectReserveRecords(),checked:i,$table:this},t),e]))},toggleRowSelection:function(e){return this.handleToggleCheckRowEvent({row:e}),this.$nextTick()},setAllSelection:function(o){var i=this,e=this.tableFullData,t=this.editStore,l=this.treeConfig,n=this.treeOpts,r=this.selection,s=this.selectReserveRowMap,a=this.checkboxOpts,c=a.reserve,u=a.checkStrictly,h=a.checkMethod,d=t.insertList,f=a.checkField||a.checkProp,p=[];if(d.length&&(e=e.concat(d)),!u){if(f){var v="".concat(l?"$":"","rowIndex"),g=function(e,t){var i;h&&!h((_defineProperty(i={row:e},v,t),_defineProperty(i,"$rowIndex",t),i))||_xeUtils.default.set(e,f,o)},m=function(e,t){var i;(!h||!h((_defineProperty(i={row:e},v,t),_defineProperty(i,"$rowIndex",t),i))&&-1<r.indexOf(e))&&_xeUtils.default.set(e,f,o)};l?_xeUtils.default.eachTree(e,o?g:m,n):e.forEach(o?g:m)}else l?o?_xeUtils.default.eachTree(e,function(e,t){h&&!h({row:e,$rowIndex:t})||p.push(e)},n):h&&_xeUtils.default.eachTree(e,function(e,t){!h({row:e,$rowIndex:t})&&-1<r.indexOf(e)&&p.push(e)},n):o?p=h?e.filter(function(e,t){return-1<r.indexOf(e)||h({row:e,rowIndex:t,$rowIndex:t})}):e.slice(0):h&&(p=e.filter(function(e,t){return h({row:e,rowIndex:t,$rowIndex:t})?0:-1<r.indexOf(e)}));c&&(o?p.forEach(function(e){s[_tools.UtilTools.getRowid(i,e)]=e}):e.forEach(function(e){var t=_tools.UtilTools.getRowid(i,e);s[t]&&delete s[t]})),this.selection=p}this.treeIndeterminates=[],this.checkSelectionStatus()},checkSelectionStatus:function(){var e=this.tableFullData,t=this.editStore,i=this.selection,o=this.treeIndeterminates,l=this.checkboxOpts,n=l.checkStrictly,r=l.checkMethod,s=l.checkField||l.checkProp,a=t.insertList;a.length&&(e=e.concat(a)),n||(s?(this.isAllSelected=e.length&&e.every(r?function(e,t){return!r({row:e,rowIndex:t,$rowIndex:t})||_xeUtils.default.get(e,s)}:function(e){return _xeUtils.default.get(e,s)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return _xeUtils.default.get(e,s)||-1<o.indexOf(e)})):(this.isAllSelected=e.length&&e.every(r?function(e,t){return!r({row:e,rowIndex:t,$rowIndex:t})||-1<i.indexOf(e)}:function(e){return-1<i.indexOf(e)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return-1<o.indexOf(e)||-1<i.indexOf(e)})))},handleReserveStatus:function(){var e=this.rowId,t=this.treeConfig,i=this.fullDataRowIdData,o=this.selectReserveRowMap,l=this.checkboxOpts,n=[],r=[],s=[],a=[];e&&this.handleReserveByRowid(this.selection,n),l.reserve&&Object.keys(o).forEach(function(e){i[e]&&-1===n.indexOf(i[e].row)&&n.push(i[e].row)}),this.selection=n,e&&this.handleReserveByRowid(this.rowExpandeds,r),this.rowExpandeds=r,e&&t&&(this.handleReserveByRowid(this.treeIndeterminates,a),this.handleReserveByRowid(this.treeExpandeds,s)),this.treeExpandeds=s,this.treeIndeterminates=a},handleReserveByRowid:function(e,i){var o=this,l=this.fullDataRowIdData;e.forEach(function(e){var t=_tools.UtilTools.getRowid(o,e);l[t]&&i.push(l[t].row)})},getSelectReserveRecords:function(){var t=this.fullDataRowIdData,i=this.selectReserveRowMap,e=this.checkboxOpts,o=[];return e.reserve&&Object.keys(i).forEach(function(e){t[e]||o.push(i[e])}),o},clearSelectReserve:function(){this.selectReserveRowMap={}},handleSelectReserveRow:function(e,t){var i=this.selectReserveRowMap;if(this.checkboxOpts.reserve){var o=_tools.UtilTools.getRowid(this,e);t?i[o]=e:i[o]&&delete i[o]}},triggerCheckAllEvent:function(e,t){this.setAllSelection(t),_tools.UtilTools.emitEvent(this,"select-all",[{selection:this.getSelectRecords(),reserves:this.getSelectReserveRecords(),checked:t,$table:this},e])},toggleAllSelection:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearSelection:function(){var e=this.tableFullData,t=this.treeConfig,i=this.treeOpts,o=this.checkboxOpts,l=o.checkField||o.checkProp;return l&&(t?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,l,!1)},i):e.forEach(function(e){return _xeUtils.default.set(e,l,!1)})),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleRadioDefChecked:function(){var e=this.radioOpts,t=this.fullDataRowIdData,i=e.checkRowKey;i&&this.setRadioRow(t[i].row)},triggerRadioRowEvent:function(e,t){var i=this.radioOpts.checkMethod;if(!i||i({row:t.row,rowIndex:t.rowIndex,$rowIndex:t.$rowIndex})){var o=this.selectRow!==t.row;this.setRadioRow(t.row),o&&_tools.UtilTools.emitEvent(this,"radio-change",[t,e])}},triggerCurrentRowEvent:function(e,t){var i=this.currentRow!==t.row;this.setCurrentRow(t.row),i&&_tools.UtilTools.emitEvent(this,"current-change",[t,e])},setCurrentRow:function(e){return this.highlightCurrentRow&&(this.clearCurrentColumn(),this.currentRow=e),this.$nextTick()},setRadioRow:function(e){return this.selectRow=e,this.$nextTick()},clearCurrentRow:function(){return this.currentRow=null,this.hoverRow=null,this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRow:function(){return this.currentRow},getRadioRow:function(){return this.selectRow},triggerHoverEvent:function(e,t){var i=t.row;this.hoverRow=i},clearHoverRow:function(){this.hoverRow=null},triggerCellMousedownEvent:function(e,t){var l=this.$el,i=this.tableData,o=this.visibleColumn,n=this.editStore,r=this.editConfig,s=this.handleSelected,a=this.handleChecked,c=n.checked,u=n.actived,h=t.row,d=t.column,f=t.cell,p=e.button,v=0===p;if((v||2===p)&&r&&"dblclick"===r.trigger)if("row"===r.mode&&u.row===h||u.row===h&&u.column===d);else if(v){e.preventDefault(),e.stopPropagation(),this.handleSelected(t,e);var g=document.onmousemove,m=document.onmouseup,x=_tools.DomTools.getCellIndexs(f),w=_xeUtils.default.throttle(function(e){e.preventDefault();var t=_tools.DomTools.getEventTargetNode(e,l,"vxe-body--column"),i=t.flag,o=t.targetElem;i&&a(x,_tools.DomTools.getCellIndexs(o),e)},browse.msie?80:40,{leading:!0,trailing:!0});document.onmousemove=w,document.onmouseup=function(e){document.onmousemove=g,document.onmouseup=m},this.closeFilter(),this.closeMenu()}else{var b=_tools.DomTools.getCellIndexs(f);-1!==c.rows.indexOf(i[b.rowIndex])&&-1!==c.columns.indexOf(o[b.columnIndex])||s(t,e)}this.isActivated=!0},triggerCornerMousedownEvent:function(e,t){t.preventDefault(),t.stopPropagation();var l=this.$el,i=this.tableData,o=this.visibleColumn,n=this.editStore,r=this.editConfig,s=this.handleTempChecked,a=n.checked,c=t.button;if((0===c||2===c)&&r&&a.rows.length&&"dblclick"===r.trigger){var u=document.onmousemove,h=document.onmouseup,d={rowIndex:i.indexOf(a.rows[0]),columnIndex:o.indexOf(a.columns[0])},f=_xeUtils.default.throttle(function(e){e.preventDefault();var t=_tools.DomTools.getEventTargetNode(e,l,"vxe-body--column"),i=t.flag,o=t.targetElem;i&&s(d,_tools.DomTools.getCellIndexs(o),e)},browse.msie?80:40,{leading:!0,trailing:!0});document.onmousemove=f,document.onmouseup=function(e){document.onmousemove=u,document.onmouseup=h,a.rows=a.tRows,a.columns=a.tColumns}}this.isActivated=!0},triggerHeaderCellClickEvent:function(e,t){var i=this._lastResizeTime,o=this.sortOpts,l=t.column,n=t.cell,r=i&&i>Date.now()-300,s=_tools.DomTools.getEventTargetNode(e,n,"vxe-sort-wrapper").flag,a=_tools.DomTools.getEventTargetNode(e,n,"vxe-filter-wrapper").flag;return"cell"!==o.trigger||r||s||a||this.triggerSortEvent(e,l,"desc"===l.order?"asc":"desc"),_tools.UtilTools.emitEvent(this,"header-cell-click",[Object.assign({triggerResizable:r,triggerSort:s,triggerFilter:a},t),e]),this.setCurrentColumn(l,!0)},setCurrentColumn:function(e){return this.highlightCurrentColumn&&(this.clearCurrentRow(),this.currentColumn=e),this.$nextTick()},clearCurrentColumn:function(){this.currentColumn=null},triggerCellClickEvent:function(e,t){var i=this,o=this.$el,l=this.highlightCurrentRow,n=this.editStore,r=this.radioOpts,s=this.expandOpts,a=this.treeOpts,c=this.editConfig,u=this.checkboxOpts,h=n.actived,d=t.column,f=t.row;isTargetRadioOrCheckbox(e,d,"radio")||isTargetRadioOrCheckbox(e,d,"checkbox","checkbox")||isTargetRadioOrCheckbox(e,d,"selection","checkbox")||("row"!==s.trigger&&("expand"!==d.type||"cell"!==s.trigger)||_tools.DomTools.getEventTargetNode(e,o,"vxe-table--expanded").flag||this.triggerRowExpandEvent(e,t),("row"===a.trigger||d.treeNode&&"cell"===a.trigger)&&this.triggerTreeExpandEvent(e,t),d.treeNode&&_tools.DomTools.getEventTargetNode(e,o,"vxe-tree-wrapper").flag||"expand"===d.type&&_tools.DomTools.getEventTargetNode(e,o,"vxe-table--expanded").flag||(l&&("row"!==r.trigger&&(_tools.DomTools.getEventTargetNode(e,o,"vxe-checkbox").flag||_tools.DomTools.getEventTargetNode(e,o,"vxe-radio").flag)||this.triggerCurrentRowEvent(e,t)),"row"!==r.trigger&&("radio"!==d.type||"cell"!==r.trigger)||_tools.DomTools.getEventTargetNode(e,o,"vxe-radio").flag||this.triggerRadioRowEvent(e,t),"row"!==u.trigger&&("checkbox"!==d.type&&"selection"!==d.type||"cell"!==u.trigger)||_tools.DomTools.getEventTargetNode(e,t.cell,"vxe-checkbox").flag||this.handleToggleCheckRowEvent(t,e),c&&("click"===c.trigger?h.args&&f===h.row&&d===h.column||("row"===c.mode?this.triggerValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})}):"cell"===c.mode&&this.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})):"dblclick"===c.trigger&&("row"===c.mode&&h.row===f?this.triggerValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})}):this.handleSelected(t,e)))),_tools.UtilTools.emitEvent(this,"cell-click",[t,e]))},triggerCellDBLClickEvent:function(e,t){var i=this,o=this.editStore,l=this.editConfig,n=o.actived;l&&"dblclick"===l.trigger&&(n.args&&e.currentTarget===n.args.cell||("row"===l.mode?this.triggerValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})}):"cell"===l.mode&&this.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e}))),_tools.UtilTools.emitEvent(this,"cell-dblclick",[t,e])},handleActived:function(e,t){var i=this,o=this.editStore,l=this.editConfig,n=l.activeMethod,r=o.actived,s=e.row,a=e.column,c=e.cell;if(a.editRender&&c)if("row"===l.mode?r.row!==s:r.row!==s||r.column!==a){var u="edit-disabled";n&&!n(e)||(this.clostTooltip(),this.clearCopyed(t),this.clearChecked(t),this.clearSelected(t),this.clearActived(t),u="edit-actived",a.renderHeight=c.offsetHeight,r.args=e,r.row=s,r.column=a,this.$nextTick(function(){i.handleFocus(e,t)})),_tools.UtilTools.emitEvent(this,u,[e,t])}else a.renderHeight=c.offsetHeight,r.args=e,r.column!==a&&this.clearValidate(),setTimeout(function(){i.handleFocus(e,t)});return this.$nextTick()},clearActived:function(e){var t=this.editStore.actived,i=t.args,o=t.row,l=t.column;return(o||l)&&(this.updateFooter(),_tools.UtilTools.emitEvent(this,"edit-closed",[i,e])),t.args=null,t.row=null,t.column=null,this.clearValidate()},getActiveRow:function(){var e=this.$el,t=this.editStore,i=this.afterFullData,o=t.actived,l=o.args,n=o.row;return l&&-1<i.indexOf(n)&&e.querySelectorAll(".vxe-body--column.col--actived").length?Object.assign({},l):null},hasActiveRow:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasActiveRow","isActiveByRow"]),this.isActiveByRow(e)},isActiveByRow:function(e){return this.editStore.actived.row===e},clearSelected:function(e){var t=this.editStore.selected;return t.row=null,t.column=null,this.$nextTick()},handleSelected:function(t,i){var o=this,e=this.mouseConfig,l=void 0===e?{}:e,n=this.editConfig,r=this.editStore,s=r.actived,a=r.selected,c=t.row,u=t.column;return function(){if((l.selected||l.checked)&&(a.row!==c||a.column!==u)&&(s.row!==c||"cell"===n.mode&&s.column!==u)&&(o.clearChecked(i),o.clearActived(i),a.args=t,a.row=c,a.column=u,l.checked)){var e=_tools.DomTools.getCellIndexs(t.cell);o.handleChecked(e,e,i)}return o.$nextTick()}()},clearChecked:function(e){var t=this.editStore.checked;return t.rows=[],t.columns=[],t.tRows=[],t.tColumns=[],this.$nextTick()},getMouseSelecteds:function(){var e=this.editStore.selected,t=e.args,i=e.column;return t&&i?Object.assign({},t):null},getMouseCheckeds:function(){var e=this.editStore.checked,t=e.rows;return{columns:e.columns,rows:t}},handleChecked:function(e,t,i){var o=this.tableData,l=this.visibleColumn,n=this.editStore.checked,r=e.rowIndex,s=e.columnIndex,a=t.rowIndex,c=t.columnIndex;n.tRows=[],n.tColumns=[],n.rows=r<a?o.slice(r,a+1):o.slice(a,r+1),n.columns=s<c?l.slice(Math.max(s,1),c+1):l.slice(Math.max(c,1),s+1)},handleTempChecked:function(e,t,i){var o=this.tableData,l=this.visibleColumn,n=this.editStore.checked,r=n.rows,s=n.tRows,a=n.columns,c=n.tColumns,u=e.rowIndex,h=e.columnIndex,d=t.rowIndex,f=t.columnIndex;s.length>r.length?f=l.indexOf(a[a.length-1]):c.length>a.length&&(d=o.indexOf(r[r.length-1])),u<d?n.tRows=o.slice(u,d+1):(u+=r.length,n.tRows=o.slice(d,u)),h<f?n.tColumns=l.slice(Math.max(h,1),f+1):(h+=a.length,n.tColumns=l.slice(Math.max(f,1),h))},clearCopyed:function(){var e=this.editStore.copyed;return e.cut=!1,e.rows=[],e.columns=[],this.$nextTick()},handleCopyed:function(e,t){var i=this.editStore,o=i.copyed,l=i.checked;o.cut=e,o.rows=l.rows,o.columns=l.columns},handlePaste:function(e){var t=this.tableData,n=this.visibleColumn,i=this.editStore,o=i.copyed,l=i.selected,r=o.cut,s=o.rows,a=o.columns;if(s.length&&a.length&&l.row&&l.column){var c=l.args,u=c.rowIndex,h=c.columnIndex,d={rowIndex:u,columnIndex:h},f={rowIndex:u+s.length-1,columnIndex:h+a.length-1};s.forEach(function(o,e){var l=t[u+e];l&&a.forEach(function(e,t){var i=n[h+t];i&&_tools.UtilTools.setCellValue(l,i,_tools.UtilTools.getCellValue(o,e)),r&&_tools.UtilTools.setCellValue(o,e,null)})}),r&&this.clearCopyed(),this.handleChecked(d,f,e)}},handleFocus:function(e,t){var i=e.row,o=e.column,l=e.cell,n=o.editRender;if(n){var r,s=_vXETable.Renderer.get(n.name),a=n.autofocus,c=n.autoselect;if(a&&(r=l.querySelector(a)),!r&&s&&s.autofocus&&(r=l.querySelector(s.autofocus)),r){if(r[c?"select":"focus"](),browse.msie){var u=r.createTextRange();u.collapse(!1),u.select()}}else this.scrollToRow(i,o)}},setActiveRow:function(e){return this.setActiveCell(e,_xeUtils.default.find(this.visibleColumn,function(e){return e.editRender}).property)},setActiveCell:function(i,o){var l=this;return this.scrollToRow(i).then(function(){if(i&&o){var e=_xeUtils.default.find(l.visibleColumn,function(e){return e.property===o});if(e&&e.editRender){var t=_tools.DomTools.getCell(l,{row:i,column:e});t&&(l.handleActived({row:i,rowIndex:l.getRowIndex(i),column:e,columnIndex:l.getColumnIndex(e),cell:t,$table:l}),l.lastCallTime=Date.now())}}return l.$nextTick()})},setSelectCell:function(e,t){var i=this.tableData,o=this.editConfig,l=this.visibleColumn;if(e&&t&&"manual"!==o.trigger){var n=_xeUtils.default.find(l,function(e){return e.property===t}),r=i.indexOf(e);if(-1<r&&n){var s=_tools.DomTools.getCell(this,{row:e,rowIndex:r,column:n}),a={row:e,rowIndex:r,column:n,columnIndex:l.indexOf(n),cell:s};this.handleSelected(a,{})}}return this.$nextTick()},handleDefaultSort:function(){var e=this.sortOpts.defaultSort;if(e){var t=e.field,i=e.order;t&&i&&this.sort(t,i)}},triggerSortEvent:function(e,t,i){var o=t.property;if(t.sortable||t.remoteSort){var l={column:t,property:o,field:o,prop:o,order:i,$table:this};t.order===i?(l.order=null,this.clearSort(t.property)):this.sort(o,i),_tools.UtilTools.emitEvent(this,"sort-change",[l,e])}},sort:function(t,e){var i=this.visibleColumn,o=this.tableFullColumn,l=this.remoteSort,n=this.sortOpts,r=_xeUtils.default.find(i,function(e){return e.property===t});if(r){var s=_xeUtils.default.isBoolean(r.remoteSort)?r.remoteSort:n.remote||l;(r.sortable||r.remoteSort)&&(e||(e="desc"===r.order?"asc":"desc"),r.order!==e&&(o.forEach(function(e){e.order=null}),r.order=e,s||this.handleTableData(!0)))}return this.$nextTick()},clearSort:function(){return this.tableFullColumn.forEach(function(e){e.order=null}),this.handleTableData(!0)},filter:function(e,t){var i=this.getColumnByField(e);if(i){var o=i.filters;if(t){var l=t(o);_xeUtils.default.isArray(l)&&(i.filters=_tools.UtilTools.getFilters(l))}return this.$nextTick().then(function(){return o})}return this.$nextTick()},triggerFilterEvent:function(e,s,t){var i=this.$refs,a=this.filterStore;if(a.column===s&&a.visible)a.visible=!1;else{var c=i.filterWrapper,u=i.tableBody.$el,h=e.target,d=e.pageX,f=_tools.DomTools.getDomNode().visibleWidth;Object.assign(a,{args:t,multiple:s.filterMultiple,options:s.filters,column:s,style:null,visible:!0}),a.isAllSelected=a.options.every(function(e){return e.checked}),a.isIndeterminate=!a.isAllSelected&&a.options.some(function(e){return e.checked}),this.$nextTick(function(){var e,t,i=c.$el.offsetWidth,o=i/2,l={top:"".concat(h.offsetTop+h.offsetParent.offsetTop+h.offsetHeight+8,"px")};if("left"===s.fixed?e=h.offsetLeft+h.offsetParent.offsetLeft-o:"right"===s.fixed?t=h.offsetParent.offsetWidth-h.offsetLeft+(h.offsetParent.offsetParent.offsetWidth-h.offsetParent.offsetLeft)-s.renderWidth-o:e=h.offsetLeft+h.offsetParent.offsetLeft-o-u.scrollLeft,e){var n=d+i-o+32-f;0<n&&(e-=n),l.left="".concat(Math.max(32,e),"px")}else if(t){var r=d+i-o+32-f;0<r&&(t+=r),l.right="".concat(t,"px")}a.style=l})}},confirmFilterEvent:function(e){var t=this.visibleColumn,i=this.filterStore,o=this.remoteFilter,l=this.filterOpts,n=this.scrollXLoad,r=this.scrollYLoad,s=i.column,a=s.property,c=[],u=[];s.filters.forEach(function(e){e.checked&&(c.push(e.value),u.push(e.data))}),i.visible=!1,l.remote||o||this.handleTableData(!0);var h=[];t.filter(function(e){var t=e.property,i=e.filters,o=[],l=[];i&&i.length&&(i.forEach(function(e){e.checked&&(o.push(e.value),l.push(e.data))}),h.push({column:e,property:t,field:t,prop:t,values:o,datas:l}))}),_tools.UtilTools.emitEvent(this,"filter-change",[{column:s,property:a,field:a,prop:a,values:c,datas:u,filters:h,$table:this}]),this.updateFooter(),(n||r)&&this.clearScroll(),this.closeFilter(),this.$nextTick(this.recalculate)},closeFilter:function(e){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},resetFilterEvent:function(e){this.filterStore.options.forEach(function(e){e.checked=!1,e.data=e._data}),this.confirmFilterEvent(e)},clearFilter:function(e){var t=arguments.length?this.getColumnByField(e):null,i=this.filterStore,o=function(e){var t=e.filters;t&&t.length&&t.forEach(function(e){e.checked=!1,e.data=e._data})};return t?o(t):this.visibleColumn.forEach(o),t&&t===i.column||Object.assign(i,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),this.updateData()},isRowExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.expandLoaded},clearRowExpandLoaded:function(t){var e=this.expandOpts,i=this.expandLazyLoadeds,o=this.fullAllDataRowMap,l=e.lazy,n=o.get(t);return l&&n&&(n.expandLoaded=!1,_xeUtils.default.remove(i,function(e){return t===e})),this.$nextTick()},reloadExpandContent:function(e){var t=this,i=this.expandOpts,o=this.expandLazyLoadeds;return i.lazy&&-1===o.indexOf(e)&&this.clearRowExpandLoaded(e).then(function(){return t.handleAsyncRowExpand(e)}),this.$nextTick()},triggerRowExpandEvent:function(e,t){var i=this.expandOpts,o=this.expandLazyLoadeds,l=t.row;i.lazy&&-1!==o.indexOf(l)||(_tools.UtilTools.emitEvent(this,"toggle-expand-change",[{row:l,rowIndex:this.getRowIndex(l),$table:this},e]),this.toggleRowExpansion(t.row))},toggleRowExpansion:function(e){return this.setRowExpansion(e,-1===this.rowExpandeds.indexOf(e))},handleDefaultRowExpand:function(){var e=this.expandOpts,t=this.fullDataRowIdData,i=e.expandAll,o=e.expandRowKeys;if(i)this.setAllRowExpansion(!0);else if(o){var l=[];o.forEach(function(e){t[e]&&l.push(t[e].row)}),this.setRowExpansion(l,!0)}},setAllRowExpansion:function(e){return this.expandOpts.lazy?this.setRowExpansion(this.tableData,!0):(this.rowExpandeds=e?this.tableFullData.slice(0):[],this.$nextTick().then(this.recalculate))},handleAsyncRowExpand:function(t){var i=this,e=this.fullAllDataRowMap,o=this.rowExpandeds,l=this.expandLazyLoadeds,n=this.expandOpts.loadMethod,r=e.get(t);return new Promise(function(e){l.push(t),n({$table:i,row:t}).catch(function(e){return e}).then(function(){r.expandLoaded=!0,_xeUtils.default.remove(l,function(e){return e===t}),o.push(t),e(i.$nextTick().then(i.recalculate))})})},setRowExpansion:function(t,e){var i=this,o=this.fullAllDataRowMap,l=this.rowExpandeds,n=this.expandLazyLoadeds,r=this.expandOpts,s=r.lazy,a=r.accordion,c=[];return t&&(_xeUtils.default.isArray(t)||(t=[t]),a&&(l=[],t=t.slice(t.length-1,t.length)),e?t.forEach(function(e){if(-1===l.indexOf(e)){var t=o.get(e);s&&!t.expandLoaded&&-1===n.indexOf(e)?c.push(i.handleAsyncRowExpand(e)):l.push(e)}}):_xeUtils.default.remove(l,function(e){return-1<t.indexOf(e)})),this.rowExpandeds=l,Promise.all(c).then(this.recalculate)},hasRowExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowExpand","isExpandByRow"]),this.isExpandByRow(e)},isExpandByRow:function(e){return-1<this.rowExpandeds.indexOf(e)},clearRowExpand:function(){var e=this,t=this.rowExpandeds.length;return this.rowExpandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},getRowExpandRecords:function(){return this.rowExpandeds.slice(0)},getTreeExpandRecords:function(){return this.treeExpandeds.slice(0)},getTreeStatus:function(){return this.treeConfig?{config:this.treeOpts,rowExpandeds:this.getTreeExpandRecords()}:null},isTreeExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.treeLoaded},clearTreeExpandLoaded:function(t){var e=this.treeOpts,i=this.treeExpandeds,o=this.fullAllDataRowMap,l=e.lazy,n=o.get(t);return l&&n&&(n.treeLoaded=!1,_xeUtils.default.remove(i,function(e){return t===e})),this.$nextTick()},reloadTreeChilds:function(e){var t=this,i=this.treeOpts,o=this.treeLazyLoadeds,l=i.lazy,n=i.hasChild;return l&&e[n]&&-1===o.indexOf(e)&&this.clearTreeExpandLoaded(e).then(function(){return t.handleAsyncTreeExpandChilds(e)}),this.$nextTick()},triggerTreeExpandEvent:function(e,t){var i=this.treeOpts,o=this.treeLazyLoadeds,l=t.row;i.lazy&&-1!==o.indexOf(l)||(_tools.UtilTools.emitEvent(this,"toggle-tree-change",[{row:l,rowIndex:this.getRowIndex(l),$table:this},e]),this.toggleTreeExpansion(t.row))},toggleTreeExpansion:function(e){return this.setTreeExpansion(e,!this.isTreeExpandByRow(e))},handleDefaultTreeExpand:function(){var e=this.treeConfig,i=this.treeOpts,o=this.tableFullData;if(e){var t=i.expandAll,l=i.expandRowKeys;if(t)this.setAllTreeExpansion(!0);else if(l){var n=[],r=_tools.UtilTools.getRowkey(this);l.forEach(function(t){var e=_xeUtils.default.findTree(o,function(e){return t===_xeUtils.default.get(e,r)},i);e&&n.push(e.item)}),this.setTreeExpansion(n,!0)}}},handleAsyncTreeExpandChilds:function(i){var o=this,e=this.fullAllDataRowMap,l=this.treeExpandeds,t=this.treeOpts,n=this.treeLazyLoadeds,r=t.loadMethod,s=t.children,a=e.get(i);return new Promise(function(t){n.push(i),r({$table:o,row:i}).catch(function(e){return[]}).then(function(e){a.treeLoaded=!0,_xeUtils.default.remove(n,function(e){return e===i}),_xeUtils.default.isArray(e)||(e=[]),e&&(i[s]=e,o.appendTreeCache(i,e),e.length&&-1===l.indexOf(i)&&l.push(i),o.isCheckedByRow(i)&&o.setSelection(e,!0)),t(o.$nextTick().then(o.recalculate))})})},setAllTreeExpansion:function(e){var t=this,i=this.tableFullData,o=this.treeOpts,l=o.lazy,n=o.children;if(e)if(l)_xeUtils.default.eachTree(i,function(e){t.setTreeExpansion(e,!0)},o);else{var r=[];_xeUtils.default.eachTree(i,function(e){var t=e[n];t&&t.length&&r.push(e)},o),this.treeExpandeds=r}else this.treeExpandeds=[];return this.$nextTick().then(this.recalculate)},setTreeExpansion:function(t,e){var i=this,o=this.fullAllDataRowMap,l=this.tableFullData,n=this.treeExpandeds,r=this.treeOpts,s=this.treeLazyLoadeds,a=r.lazy,c=r.hasChild,u=r.children,h=r.accordion,d=[];if(t&&(_xeUtils.default.isArray(t)||(t=[t]),t.length)){if(h){t=t.slice(t.length-1,t.length);var f=_xeUtils.default.findTree(l,function(e){return e===t[0]},r);_xeUtils.default.remove(n,function(e){return-1<f.items.indexOf(e)})}return e?t.forEach(function(e){if(-1===n.indexOf(e)){var t=o.get(e);a&&e[c]&&!t.treeLoaded&&-1===s.indexOf(e)?d.push(i.handleAsyncTreeExpandChilds(e)):e[u]&&e[u].length&&n.push(e)}}):_xeUtils.default.remove(n,function(e){return-1<t.indexOf(e)}),Promise.all(d).then(this.recalculate)}return Promise.resolve()},hasTreeExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasTreeExpand","isTreeExpandByRow"]),this.isTreeExpandByRow(e)},isTreeExpandByRow:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){var e=this,t=this.treeExpandeds.length;return this.treeExpandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},isScrollXLoad:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["isScrollXLoad","getVirtualScroller"]),this.scrollXLoad},isScrollYLoad:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["isScrollYLoad","getVirtualScroller"]),this.scrollYLoad},getVirtualScroller:function(){var e=this.$refs,t=this.scrollXLoad,i=this.scrollYLoad,o=e.tableBody.$el;return{scrollX:t,scrollY:i,scrollTop:o.scrollTop,scrollLeft:o.scrollLeft}},triggerScrollXEvent:function(e){this.updateVirtualScrollX()},updateVirtualScrollX:function(e){for(var t=this.$refs,i=this.visibleColumn,o=this.scrollXStore,l=o.startIndex,n=o.renderSize,r=o.offsetSize,s=o.visibleSize,a=t.tableBody.$el.scrollLeft,c=0,u=0,h=e||!1,d=0;d<i.length;d++)if(a<(u+=i[d].renderWidth)){c=d;break}if(e||o.visibleIndex!==c){var f=Math.min(Math.floor((n-s)/2),s);o.visibleIndex===c?o.startIndex=c:o.visibleIndex>c?(h=c-r<=l)&&(o.startIndex=Math.max(0,Math.max(f,c-f))):(h=l+n<=c+s+r)&&(o.startIndex=Math.max(0,Math.min(i.length-n,c-f))),h&&this.updateScrollXData(),o.visibleIndex=c}this.clostTooltip()},triggerScrollYEvent:_xeUtils.default.debounce(function(e){var t=this.afterFullData,i=this.scrollYStore,o=this.isLoadData,l=i.startIndex,n=i.renderSize,r=i.offsetSize,s=i.visibleSize,a=i.rowHeight,c=e.target.scrollTop,u=Math.ceil(c/a),h=!1;if(o||i.visibleIndex!==u){var d=Math.min(Math.floor((n-s)/2),s);i.visibleIndex>u?(h=u-r<=l)&&(i.startIndex=Math.max(0,u-Math.max(d,n-s))):(h=l+n<=u+s+r)&&(i.startIndex=Math.max(0,Math.min(t.length-n,u-d))),h&&this.updateScrollYData(),i.visibleIndex=u,this.isLoadData=!1}},debounceScrollYDuration,{leading:!1,trailing:!0}),computeRowHeight:function(){var e,t=this.$refs.tableBody,i=t?t.$el:null,o=this.$refs.tableHeader;if(i){var l=i.querySelector("tbody>tr");!l&&o&&(l=o.$el.querySelector("thead>tr")),l&&(e=l.clientHeight)}e||(e=this.rowHeightMaps[this.vSize||"default"]),this.rowHeight=e},computeScrollLoad:function(){var w=this;return this.$nextTick().then(function(){var e=w.vSize,t=w.scrollXLoad,i=w.scrollYLoad,o=w.scrollYStore,l=w.scrollXStore,n=w.visibleColumn,r=w.optimizeOpts,s=w.rowHeightMaps,a=r.scrollX,c=r.scrollY,u=w.$refs.tableBody,h=u?u.$el:null,d=w.$refs.tableHeader;if(h){if(t){var f=n[0],p=f?f.renderWidth:40,v=_xeUtils.default.toNumber(a.vSize||Math.ceil(h.clientWidth/p));l.visibleSize=v,a.oSize||(l.offsetSize=v),a.rSize||(l.renderSize=v+4),w.updateScrollXData()}else w.updateScrollXSpace();if(i){var g;if(c.rHeight)g=c.rHeight;else{var m=h.querySelector("tbody>tr");!m&&d&&(m=d.$el.querySelector("thead>tr")),m&&(g=m.clientHeight)}g||(g=s[e||"default"]);var x=_xeUtils.default.toNumber(c.vSize||Math.ceil(h.clientHeight/g));o.visibleSize=x,o.rowHeight=g,c.oSize||(o.offsetSize=x),c.rSize||(o.renderSize=x*(browse.edge?10:8)),w.updateScrollYData()}else w.updateScrollYSpace()}return w.$nextTick()})},updateScrollXData:function(){var e=this.visibleColumn,t=this.scrollXStore;this.tableColumn=e.slice(t.startIndex,t.startIndex+t.renderSize),this.updateScrollXSpace()},updateScrollXSpace:function(){var e=this.visibleColumn,t=this.scrollXStore;t.leftSpaceWidth=e.slice(0,t.startIndex).reduce(function(e,t){return e+t.renderWidth},0),t.rightSpaceWidth=e.slice(t.startIndex+t.renderSize,e.length).reduce(function(e,t){return e+t.renderWidth},0)},updateScrollYData:function(){this.handleTableData(),this.updateScrollYSpace()},updateScrollYSpace:function(){var e=this.scrollYStore,t=this.afterFullData,i=t.length*e.rowHeight;e.ySpaceHeight=i,e.topSpaceHeight=Math.max(e.startIndex*e.rowHeight,0),e.bottomSpaceHeight=Math.max((t.length-(e.startIndex+e.renderSize))*e.rowHeight,0)},scrollTo:function(e,t){var i=this,o=this.$refs.tableBody.$el;if(_xeUtils.default.isNumber(e)){var l=this.$refs.tableFooter;l?l.$el.scrollLeft=e:o.scrollLeft=e}if(_xeUtils.default.isNumber(t)){var n=this.$refs.rightBody;n&&(n.$el.scrollTop=t),o.scrollTop=t}return this.scrollXLoad||this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(i.$nextTick())},50)}):this.$nextTick()},scrollToRow:function(e,t){var i=[];return e&&(this.treeConfig?i.push(this.scrollToTreeRow(e)):this.fullAllDataRowMap.has(e)&&i.push(_tools.DomTools.rowToVisible(this,e))),i.push(this.scrollToColumn(t)),Promise.all(i)},scrollToColumn:function(e){return e&&this.fullColumnMap.has(e)?_tools.DomTools.colToVisible(this,e):this.$nextTick()},scrollToTreeRow:function(t){var i=this,e=this.tableFullData,o=this.treeConfig,l=this.treeOpts;if(o){var n=_xeUtils.default.findTree(e,function(e){return e===t},l);if(n){var r=n.nodes;r.forEach(function(e,t){t<r.length-1&&!i.hasTreeExpand(e)&&i.setTreeExpansion(e,!0)})}}return this.$nextTick()},clearScroll:function(){var n=this;return this.updateScrollXSpace(),this.updateScrollYSpace(),this.$nextTick().then(function(){var e=n.$refs,t=e.tableBody,i=t?t.$el:null,o=e.tableFooter,l=(o?o.$el:null)||i;return i&&(i.scrollTop=0),l&&(l.scrollLeft=0),new Promise(function(e){return setTimeout(function(){return e(n.$nextTick())})})})},updateFooter:function(){var e=this.showFooter,t=this.tableColumn,i=this.footerMethod;return e&&i&&(this.footerData=t.length?i({columns:t,data:this.afterFullData}):[]),this.$nextTick()},updateStatus:function(a,c){var u=this,h=!_xeUtils.default.isUndefined(c);return this.$nextTick().then(function(){var e=u.$refs,t=u.tableData,i=u.editRules,o=u.validStore;if(a&&e.tableBody&&i){var l=a.row,n=a.column;if(u.hasCellRules("change",l,n)){var r=t.indexOf(l),s=_tools.DomTools.getCell(u,{row:l,rowIndex:r,column:n});if(s)return u.validCellRules("change",l,n,c).then(function(){h&&o.visible&&_tools.UtilTools.setCellValue(l,n,c),u.clearValidate()}).catch(function(e){var t=e.rule;h&&_tools.UtilTools.setCellValue(l,n,c),u.showValidTooltip({rule:t,row:l,column:n,cell:s})})}}})},triggerValidate:function(o){var l=this,e=this.editConfig,t=this.editStore,i=this.editRules,n=this.validStore,r=t.actived;if(r.row&&i){var s=r.args,a=s.row,c=s.column,u=s.cell;if(this.hasCellRules(o,a,c))return this.validCellRules(o,a,c).then(function(){"row"===e.mode&&n.visible&&n.row===a&&n.column===c&&l.clearValidate()}).catch(function(e){var t=e.rule;if(t.trigger&&o!==t.trigger)return Promise.resolve();var i={rule:t,row:a,column:c,cell:u};return l.showValidTooltip(i),Promise.reject(i)})}return Promise.resolve()},fullValidate:function(e,t){return this.beginValidate(e,t,!0)},validate:function(e,t){return this.beginValidate(e,t)},beginValidate:function(e,c,u){var h=this,d={},f=!0,t=this.editRules,p=this.afterFullData,v=this.treeConfig,i=this.treeOpts,o=p;e&&(_xeUtils.default.isFunction(e)?c=e:o=_xeUtils.default.isArray(e)?e:[e]);var l=[];if(this.lastCallTime=Date.now(),this.clearValidate(),t){var n=this.getColumns(),r=function(r){var e=[];n.forEach(function(l,n){_xeUtils.default.has(t,l.property)&&e.push(new Promise(function(i,o){h.validCellRules("all",r,l).then(i).catch(function(e){var t={rule:e.rule,rules:e.rules,rowIndex:h.getRowIndex(r),row:r,columnIndex:n,column:l,$table:h};return u?(d[l.property]||(d[l.property]=[]),d[l.property].push(t),i()):o(t)})}))}),l.push(Promise.all(e))};return v?_xeUtils.default.eachTree(o,r,i):o.forEach(r),Promise.all(l).then(function(){var e=Object.keys(d);if(e.length)return Promise.reject(d[e[0]][0]);c&&c(f)}).catch(function(s){var a=u?d:_defineProperty({},s.column.property,s);return new Promise(function(e,t){var i=function(){f=!1,c?(c(f,a),e()):t(a)},o=function(){s.cell=_tools.DomTools.getCell(h,s),h.handleValidError(s),i()},l=s.row,n=p.indexOf(l),r=0<n?p[n-1]:l;_tools.DomTools.toView(h.$el),!1===h.validOpts.autoPos?i():v?h.scrollToTreeRow(r).then(o):h.scrollToRow(r).then(o)})})}return c&&c(f),Promise.resolve()},hasCellRules:function(t,e,i){var o=this.editRules,l=i.property;if(l&&o){var n=_xeUtils.default.get(o,l);return n&&_xeUtils.default.find(n,function(e){return"all"===t||!e.trigger||t===e.trigger})}return!1},validCellRules:function(s,a,c,e){var u=this,t=this.editRules,i=c.property,h=[],o=[];if(i&&t){var d=_xeUtils.default.get(t,i),f=_xeUtils.default.isUndefined(e)?_xeUtils.default.get(a,i):e;d&&d.forEach(function(r){o.push(new Promise(function(i){var e=!0===r.required;if("all"!==s&&r.trigger&&s!==r.trigger)i();else if(_xeUtils.default.isFunction(r.validator))r.validator(r,f,function(e){if(_xeUtils.default.isError(e)){var t={type:"custom",trigger:r.trigger,message:e.message,rule:r};h.push(new Rule(t))}return i()},{rules:d,row:a,column:c,rowIndex:u.getRowIndex(a),columnIndex:u.getColumnMapIndex(c)});else{var t,o=f,l="number"===r.type,n=null==f||""===f;l?o=_xeUtils.default.toNumber(f):t=_xeUtils.default.getSize(o),e&&n?h.push(new Rule(r)):(l&&isNaN(f)||_xeUtils.default.isRegExp(r.pattern)&&!r.pattern.test(f)||_xeUtils.default.isNumber(r.min)&&(l?o<r.min:t<r.min)||_xeUtils.default.isNumber(r.max)&&(l?o>r.max:t>r.max))&&h.push(new Rule(r)),i()}}))})}return Promise.all(o).then(function(){if(h.length){var e={rules:h,rule:h[0]};return Promise.reject(e)}})},clearValidate:function(){var e=this.$refs.validTip;return Object.assign(this.validStore,{visible:!1,row:null,column:null,content:"",rule:null}),e&&e.visible&&e.close(),this.$nextTick()},handleValidError:function(e){var t=this;!1===this.validOpts.autoPos?_tools.UtilTools.emitEvent(this,"valid-error",[e]):this.handleActived(e,{type:"valid-error",trigger:"call"}).then(function(){return t.showValidTooltip(e)})},showValidTooltip:function(e){var t=this,i=this.$refs,o=this.height,l=this.tableData,n=this.validOpts,r=e.rule,s=e.row,a=e.column,c=e.cell,u=i.validTip,h=r.message;this.$nextTick(function(){Object.assign(t.validStore,{row:s,column:a,rule:r,content:h,visible:!0}),u&&("tooltip"===n.message||"default"===n.message&&!o&&l.length<2)&&u.toVisible(c,h),_tools.UtilTools.emitEvent(t,"valid-error",[e])})},exportCsv:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["exportCsv","exportData"]),this.exportData(e)},openExport:function(e){if(this.$toolbar)return this.$toolbar.openExport(e);throw new Error(_tools.UtilTools.getLog("vxe.error.barUnableLink"))},exportData:function(e){var t=this.visibleColumn,i=this.scrollXLoad,o=this.scrollYLoad,l=this.treeConfig,n=this.treeOpts,r=Object.assign({filename:"",sheetName:"",original:!!l,message:!1,isHeader:!0,isFooter:!0,download:!0,type:"csv",data:null,columns:null,columnFilterMethod:null,dataFilterMethod:null,footerFilterMethod:null},_conf.default.export,e);if(r.filename||(r.filename="export"),r.sheetName||(r.sheetName="Sheet1"),!_xeUtils.default.includes(_vXETable.default.exportTypes,r.type))throw new Error(_tools.UtilTools.getLog("vxe.error.notType",[r.type]));r.original||(i||o)&&(r.original=!0,_tools.UtilTools.warn("vxe.error.scrollOriginal")),e&&e.columns||(r.columnFilterMethod=function(e){return e.property&&-1===["seq","index","checkbox","selection","radio"].indexOf(e.type)});var s=t,a=this.tableFullData;return l&&(a=_xeUtils.default.toTreeArray(a,n)),_tools.ExportTools.handleExport(this,r,s,a)},openImport:function(e){if(this.$toolbar)return this.$toolbar.openImport(e);throw new Error(_tools.UtilTools.getLog("vxe.error.barUnableLink"))},importByFile:function(t,e){var i=this;if(window.FileReader){var o=_tools.UtilTools.parseFile(t),l=o.type,n=o.filename,r=Object.assign({mode:"covering"},e,{type:l,filename:n}),s=r.types||_vXETable.default.importTypes;_xeUtils.default.includes(s,l)?this.preventEvent(null,"event.import",{$table:this,file:t,options:r,columns:this.tableFullColumn},function(){var e=new FileReader;e.onerror=function(e){_tools.UtilTools.error("vxe.error.notType",[l])},e.onload=function(e){_tools.ExportTools.handleImport(i,e.target.result.trim(),r)},e.readAsText(t,"UTF-8")}):_tools.UtilTools.error("vxe.error.notType",[l])}else _tools.UtilTools.error("vxe.error.notExp")},importData:function(e){var i=this,t=Object.assign({},_conf.default.import,e),o=new Promise(function(e,t){i._importResolve=e,i._importReject=t});return this.readFile(t).then(function(e){return i.importByFile(e.target.files[0],t)}).catch(function(e){i._importReject(e),i._importReject=null}),o},readFile:function(){var i=this,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};fileForm.parentNode||document.body.appendChild(fileForm);var l=o.types||_vXETable.default.importTypes;return o.multiple&&(fileInput.multiple="multiple"),fileInput.accept=".".concat(l.join(", .")),fileInput.onchange=function(e){var t=_tools.UtilTools.parseFile(e.target.files[0]).type;_xeUtils.default.includes(l,t)?i._fileResolve(e):(!1!==o.message&&i.$XModal.message({message:_xeUtils.default.template(_conf.default.i18n("vxe.error.notType"),[t]),status:"error"}),i._fileReject(e)),i._fileResolve=null},fileForm.reset(),fileInput.click(),new Promise(function(e,t){i._fileResolve=e,i._fileReject=t})},print:function(e){this.exportData(Object.assign({original:this.scrollXLoad||this.scrollYLoad},e,{type:"html",download:!1})).then(function(e){var t=e.content,i=e.blob;if(_tools.DomTools.browse.msie){if(printFrame){try{printFrame.contentDocument.write(""),printFrame.contentDocument.clear()}catch(e){}document.body.removeChild(printFrame)}printFrame=createFrame(),document.body.appendChild(printFrame),printFrame.contentDocument.write(t),printFrame.contentDocument.execCommand("print")}else printFrame||((printFrame=createFrame()).onload=function(e){e.target.src&&e.target.contentWindow.print()},document.body.appendChild(printFrame)),printFrame.src=URL.createObjectURL(i)})},updateZindex:function(){this.tZindex<_tools.UtilTools.getLastZIndex()&&(this.tZindex=_tools.UtilTools.nextZIndex(this))},connect:function(e){var t=e.toolbar;this.$toolbar=t},getEventTargetNode:_tools.DomTools.getEventTargetNode}};exports.default=_default2;