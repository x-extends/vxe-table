"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_cell=_interopRequireDefault(require("../../cell")),_vXETable=require("../../v-x-e-table"),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var rowUniqueId=1e6,browse=_tools.DomTools.browse,isWebkit=browse["-webkit"]&&!browse["-ms"],debounceScrollYDuration=browse.msie?40:20;function renderFixed(e,t,l){var o=t.tableData,i=t.tableColumn,n=t.visibleColumn,r=t.collectColumn,s=t.isGroup,a=t.vSize,c=t.showHeader,u=t.showFooter,h=t.columnStore,d=t.footerData,f=h["".concat(l,"List")];return e("div",{class:"vxe-table--fixed-".concat(l,"-wrapper"),ref:"".concat(l,"Container")},[c?e("vxe-table-header",{props:{fixedType:l,tableData:o,tableColumn:i,visibleColumn:n,collectColumn:r,size:a,fixedColumn:f,isGroup:s},ref:"".concat(l,"Header")}):null,e("vxe-table-body",{props:{fixedType:l,tableData:o,tableColumn:i,visibleColumn:n,collectColumn:r,fixedColumn:f,size:a,isGroup:s},ref:"".concat(l,"Body")}),u?e("vxe-table-footer",{props:{fixedType:l,footerData:d,tableColumn:i,visibleColumn:n,size:a,fixedColumn:f},ref:"".concat(l,"Footer")}):null])}var headerProps={children:"children"},_default2={name:"VxeTable",props:{data:Array,customs:Array,height:[Number,String],maxHeight:[Number,String],resizable:{type:Boolean,default:function(){return _conf.default.resizable}},stripe:{type:Boolean,default:function(){return _conf.default.stripe}},border:{type:Boolean,default:function(){return _conf.default.border}},size:{type:String,default:function(){return _conf.default.size}},fit:{type:Boolean,default:function(){return _conf.default.fit}},loading:Boolean,align:String,headerAlign:String,showHeader:{type:Boolean,default:function(){return _conf.default.showHeader}},startIndex:{type:Number,default:0},highlightCurrentRow:Boolean,highlightHoverRow:Boolean,highlightCurrentColumn:Boolean,highlightHoverColumn:Boolean,highlightCell:Boolean,showFooter:Boolean,footerMethod:Function,rowClassName:[String,Function],cellClassName:[String,Function],headerRowClassName:[String,Function],headerCellClassName:[String,Function],footerRowClassName:[String,Function],footerCellClassName:[String,Function],spanMethod:Function,showOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},remoteFilter:Boolean,rowKey:[String,Number],rowId:[String,Number],autoResize:Boolean,radioConfig:Object,selectConfig:Object,tooltipConfig:Object,expandConfig:Object,treeConfig:Object,contextMenu:Object,mouseConfig:Object,keyboardConfig:Object,editConfig:Object,validConfig:Object,editRules:Object,optimization:Object},provide:function(){return{$table:this}},data:function(){return{id:_xeUtils.default.uniqueId(),collectColumn:[],tableFullColumn:[],tableColumn:[],tableData:[],scrollXLoad:!1,scrollYLoad:!1,overflowY:!0,overflowX:!1,scrollbarWidth:0,scrollbarHeight:0,isAllSelected:!1,isIndeterminate:!1,selection:[],currentRow:null,selectRow:null,footerData:[],expandeds:[],treeExpandeds:[],treeIndeterminates:[],filterStore:{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1},columnStore:{leftList:[],centerList:[],rightList:[],resizeList:[],pxList:[],pxMinList:[],scaleList:[],scaleMinList:[],autoList:[]},ctxMenuStore:{selected:null,visible:!1,showChild:!1,selectChild:null,list:[],style:null},editStore:{indexs:{columns:[]},titles:{columns:[]},checked:{rows:[],columns:[],tRows:[],tColumns:[]},selected:{row:null,column:null},copyed:{cut:!1,rows:[],columns:[]},actived:{row:null,column:null},insertList:[],removeList:[]},validStore:{visible:!1,row:null,column:null,content:"",rule:null,isArrow:!1}}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},validOpts:function(){return Object.assign({message:"default"},_conf.default.validConfig,this.validConfig)},optimizeOpts:function(){return Object.assign({},_conf.default.optimization,this.optimization)},isGroup:function(){return this.collectColumn.some(function(e){return _tools.UtilTools.hasChildrenList(e)})},hasTip:function(){return _conf.default._tip},visibleColumn:function(){return this.tableFullColumn?this.tableFullColumn.filter(function(e){return e.visible}):[]},isResizable:function(){return this.resizable||this.tableFullColumn.some(function(e){return e.resizable})},hasFilter:function(){return this.tableColumn.some(function(e){return e.filters&&e.filters.length})},headerCtxMenu:function(){return this.ctxMenuConfig.header&&this.ctxMenuConfig.header.options?this.ctxMenuConfig.header.options:[]},bodyCtxMenu:function(){return this.ctxMenuConfig.body&&this.ctxMenuConfig.body.options?this.ctxMenuConfig.body.options:[]},isCtxMenu:function(){return this.headerCtxMenu.length||this.bodyCtxMenu.length},ctxMenuConfig:function(){return Object.assign({},_conf.default.menu,this.contextMenu)},ctxMenuList:function(){var t=[];return this.ctxMenuStore.list.forEach(function(e){e.forEach(function(e){t.push(e)})}),t}},watch:{data:function(e){this._isUpdateData||this.loadData(e,!0).then(this.handleDefault),this._isUpdateData=!1},customs:function(e){this.isUpdateCustoms||this.mergeCustomColumn(e),this.isUpdateCustoms=!1},collectColumn:function(e){var t=_tools.UtilTools.getColumnList(e);if(this.tableFullColumn=t,this.cacheColumnMap(),t.length){var l=Math.floor((t.length-1)/2);t[l].prop&&console.warn("[vxe-table] The property prop is deprecated, please use field"),t[l].label&&console.warn("[vxe-table] The property label is deprecated, please use title")}},tableColumn:function(){this.analyColumnWidth()},height:function(){this.$nextTick(this.recalculate)},loading:function(){this._isLoading||(this._isLoading=!0)}},created:function(){var l=this,e=Object.assign(this,{elemStore:{},scrollXStore:{},scrollYStore:{},tooltipStore:{},parentHeight:0,tableWidth:0,tableHeight:0,headerHeight:0,footerHeight:0,lastScrollLeft:0,lastScrollTop:0,tableFullData:[],afterFullData:[],fullDataIndexMap:new Map,fullDataRowIdMap:new Map,fullColumnIdMap:new Map,fullColumnIndexMap:new Map}),t=e.scrollYStore,o=e.optimizeOpts,i=e.selectConfig,n=e.data,r=e.treeConfig,s=e.editConfig,a=e.loading,c=o.scrollY;this._isLoading=a,c&&Object.assign(t,{startIndex:0,visibleIndex:0,adaptive:!_xeUtils.default.isBoolean(c.adaptive)||c.adaptive,renderSize:c.rSize,offsetSize:c.oSize});var u=_tools.UtilTools.getRowKey(this);if(i&&i.reserve&&!u)throw new Error("[vxe-table] Checkbox status reserve must have a unique primary key (row-id | row-key).");if(r&&!u)throw new Error("[vxe-table] Tree table must have a unique primary key (row-id | row-key).");if(s&&!u)throw new Error("[vxe-table] Editable must have a unique primary key (row-id | row-key).");this.loadData(n,!0).then(function(){var e=l.customs,t=l.collectColumn;l.tableFullColumn=_tools.UtilTools.getColumnList(t),e&&l.mergeCustomColumn(e),l.refreshColumn(),l.handleDefault(),l.updateStyle()}),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent),_tools.GlobalEvent.on(this,"contextmenu",this.handleGlobalContextmenuEvent),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),_tools.GlobalEvent.on(this,"resize",this.handleGlobalResizeEvent)},mounted:function(){this.autoResize&&_tools.ResizeEvent.on(this,this.$el.parentNode,this.recalculate),document.body.appendChild(this.$refs.tableWrapper)},activated:function(){var e=this.$refs.tableBody.$el;if(e){var t=this.lastScrollTop,l=this.lastScrollLeft;t&&(e.scrollTop=t),l&&(e.scrollLeft=l)}},beforeDestroy:function(){var e=this.$refs.tableWrapper;e&&e.parentNode&&e.parentNode.removeChild(e),_tools.ResizeEvent.off&&_tools.ResizeEvent.off(this,this.$el.parentNode),this.afterFullData.length=0,this.fullDataIndexMap.clear(),this.fullColumnIndexMap.clear(),this.closeFilter(),this.closeMenu()},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur"),_tools.GlobalEvent.off(this,"contextmenu"),_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"keydown"),_tools.GlobalEvent.off(this,"resize")},render:function(e){var t,l=this._e,o=this.id,i=this.tableData,n=this.tableColumn,r=this.visibleColumn,s=this.collectColumn,a=this.isGroup,c=this.hasFilter,u=this.isResizable,h=this.isCtxMenu,d=this.loading,f=this._isLoading,g=this.showHeader,v=this.border,m=this.stripe,p=this.height,x=this.highlightHoverRow,b=this.highlightHoverColumn,C=this.highlightCell,w=this.vSize,_=this.editConfig,T=this.validOpts,y=this.mouseConfig,S=void 0===y?{}:y,D=this.editRules,E=this.showFooter,k=this.footerMethod,U=this.overflowX,I=this.overflowY,R=this.scrollbarHeight,M=this.optimizeOpts,$=this.columnStore,O=this.filterStore,N=this.ctxMenuStore,F=this.tooltipConfig,L=this.validStore,A=this.footerData,H=this.hasTip,z=$.leftList,W=$.rightList;return e("div",{class:(t={"vxe-table":1},_defineProperty(t,"size--".concat(w),w),_defineProperty(t,"vxe-editable",_),_defineProperty(t,"show--head",g),_defineProperty(t,"show--foot",E),_defineProperty(t,"scroll--y",I),_defineProperty(t,"scroll--x",U),_defineProperty(t,"fixed--left",z.length),_defineProperty(t,"fixed--right",W.length),_defineProperty(t,"c--highlight",C),_defineProperty(t,"t--animat",M.animat),_defineProperty(t,"t--stripe",m),_defineProperty(t,"t--border",v),_defineProperty(t,"t--checked",S.checked),_defineProperty(t,"is--loading",d),_defineProperty(t,"row--highlight",x),_defineProperty(t,"column--highlight",b),t)},[e("div",{class:"vxe-table-hidden-column",ref:"hideColumn"},this.$slots.default),g?e("vxe-table-header",{ref:"tableHeader",props:{tableData:i,tableColumn:n,visibleColumn:r,collectColumn:s,size:w,isGroup:a}}):l(),e("vxe-table-body",{ref:"tableBody",props:{tableData:i,tableColumn:n,visibleColumn:r,collectColumn:s,size:w,isGroup:a}}),E?e("vxe-table-footer",{props:{footerData:A,footerMethod:k,tableColumn:n,visibleColumn:r,size:w},ref:"tableFooter"}):l(),z&&z.length&&U?renderFixed(e,this,"left"):l(),W&&W.length&&U?renderFixed(e,this,"right"):l(),u?e("div",{class:"vxe-table--resizable-bar",style:U?{"padding-bottom":"".concat(R,"px")}:null,ref:"resizeBar"}):l(),f?e("vxe-table-loading",{props:{visible:d}}):l(),e("div",{class:"vxe-table".concat(o,"-wrapper"),ref:"tableWrapper"},[c?e("vxe-table-filter",{props:{optimizeOpts:M,filterStore:O},ref:"filterWrapper"}):l(),h?e("vxe-table-context-menu",{props:{ctxMenuStore:N},ref:"ctxWrapper"}):l(),H?e("vxe-tooltip",{ref:"tooltip"}):l(),H&&D&&("default"===T.message?!p:"tooltip"===T.message)?e("vxe-tooltip",{class:"vxe-table--valid-error",props:"tooltip"===T.message||1===i.length?Object.assign({},L,F):null,ref:"validTip"}):l()])])},methods:{clearAll:function(){return this.clearScroll(),this.clearSort(),this.clearFilter(),this.clearCurrentRow(),this.clearCurrentColumn(),this.clearSelection(),this.clearRowExpand(),this.clearTreeExpand(),this.clearIndexChecked(),this.clearHeaderChecked(),this.clearChecked(),this.clearSelected(),this.clearCopyed(),this.clearActived()},refreshData:function(){var e=this;return this.$nextTick(function(){return e.tableData=[],e.$nextTick(function(){return e.loadData(e.tableFullData)})})},loadData:function(e,t){var l=this.height,o=this.maxHeight,i=this.editStore,n=this.optimizeOpts,r=this.recalculate,s=n.scrollY,a=e||[],c=s&&s.gt&&s.gt<a.length;if(i.insertList=[],i.removeList=[],this.tableFullData=a,this.cacheDataMap(),this.tableSourceData=_xeUtils.default.clone(a,!0),(this.scrollYLoad=c)&&!l&&!o)throw new Error("[vxe-table] The height/max-height must be set for the scroll load.");this.tableData=this.getTableData(!0).tableData,this.reserveCheckSelection(),this.checkSelectionStatus();var u=this.$nextTick();return t||(u=u.then(r)),u},reloadData:function(e){return this.clearAll(),this.loadData(e).then(this.handleDefault)},loadColumn:function(e){var t=this,l=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)},headerProps);return this.collectColumn=l,this.tableFullColumn=_tools.UtilTools.getColumnList(l),this.customs&&this.mergeCustomColumn(this.customs),this.cacheColumnMap(),this.refreshColumn(),this.$nextTick()},reloadColumn:function(e){return this.clearAll(),this.loadColumn(e)},cacheDataMap:function(){var e=this.treeConfig,t=this.tableFullData,i=this.fullDataIndexMap,n=this.fullDataRowIdMap,r=_tools.UtilTools.getRowKey(this),l=function(e,t){var l=t;r&&((l=_xeUtils.default.get(e,r))||(l=++rowUniqueId,_xeUtils.default.set(e,r,l)));var o={rowKey:r,row:e,rowPrimaryKey:l,index:t};n.set("".concat(l),o),i.set(e,o)};i.clear(),n.clear(),e?_xeUtils.default.eachTree(t,l,e):t.forEach(l)},cacheColumnMap:function(){var e=this.tableFullColumn,l=this.fullColumnIdMap,o=this.fullColumnIndexMap;l.clear(),o.clear(),e.forEach(function(e,t){l.set(e.id,e),o.set(e,{column:e,index:t})})},getRowNode:function(e){var l=this;if(e){var t=this.treeConfig,o=this.tableFullData,i=this.fullDataRowIdMap,n=e.getAttribute("data-rowid");if(t){var r=_xeUtils.default.findTree(o,function(e,t){return _tools.UtilTools.getRowPrimaryKey(l,e,t)===n},t);if(r)return r}else if(i.has(n)){var s=i.get(n);return{item:s.row,index:s.index,items:o}}}return null},getColumnNode:function(e){if(e){var t=this.isGroup,l=this.fullColumnIdMap,o=this.tableFullColumn,i=e.getAttribute("data-colid");if(!t){var n=l.get(i);return{item:n,index:this.getColumnMapIndex(n),items:o}}var r=_xeUtils.default.findTree(o,function(e){return e.id===i},headerProps);if(r)return r}return null},getRowMapIndex:function(e){return this.fullDataIndexMap.has(e)?this.fullDataIndexMap.get(e).index:-1},getRowIndex:function(t){var e=this.tableFullData,l=this.treeConfig;return l?_xeUtils.default.findTree(e,function(e){return e===t},l):this.getRowMapIndex(t)},getColumnMapIndex:function(e){return this.fullColumnIndexMap.has(e)?this.fullColumnIndexMap.get(e).index:-1},getColumnIndex:function(e){return this.getColumnMapIndex(e)},insert:function(e){return this.insertAt(e)},insertAt:function(e,l){var o=this,i=arguments,n=this.tableData,r=this.editStore,t=this.defineProperty,s=this.scrollYLoad,a=this.tableFullData;_xeUtils.default.isArray(e)||(e=[e]);var c=e.map(function(e){return t(e)});return new Promise(function(e){if(1===i.length)n.unshift.apply(n,c),s&&(a.unshift.apply(a,c),o.updateAfterFullData());else{if(s)throw new Error("[vxe-table] Virtual scroller does not support this operation.");if(-1===l)n.push.apply(n,c);else{var t=n.indexOf(l);n.splice.apply(n,[t,0].concat(c))}}[].unshift.apply(r.insertList,c),o.checkSelectionStatus(),o.$nextTick(function(){o.recalculate(),e({row:c.length?c[c.length-1]:null,rows:c})})})},defineProperty:function(e){var t=Object.assign({},e),l=_tools.UtilTools.getRowKey(this);return this.visibleColumn.forEach(function(e){e.property&&!_xeUtils.default.has(t,e.property)&&_xeUtils.default.set(t,e.property,null)}),l&&!_xeUtils.default.get(t,l)&&_xeUtils.default.set(t,l,++rowUniqueId),t},remove:function(r){var e=this,t=this.tableData,s=this.tableFullData,l=this.editStore,a=this.treeConfig,o=this.selectConfig,i=void 0===o?{}:o,c=this.selection,u=this.hasRowInsert,h=l.removeList,n=l.insertList,d=i.checkField,f=[];return this._isUpdateData=!0,r&&(_xeUtils.default.isArray(r)||(r=[r]),a?r.forEach(function(t){var e=_xeUtils.default.findTree(s,function(e){return e===t},a);if(e){var l=e.item,o=e.items,i=e.index;u(l)||h.push(l);var n=o.splice(i,1)[0];d||_xeUtils.default.remove(c,function(e){return-1<r.indexOf(e)}),f.push(n)}}):(r.forEach(function(e){u(e)||h.push(e)}),f=_xeUtils.default.remove(s,function(e){return-1<r.indexOf(e)}),d||_xeUtils.default.remove(c,function(e){return-1<r.indexOf(e)}),_xeUtils.default.remove(t,function(e){return-1<r.indexOf(e)})),_xeUtils.default.remove(n,function(e){return-1<r.indexOf(e)})),this.checkSelectionStatus(),this.$nextTick().then(function(){return e.recalculate(),{row:r&&r.length?r[r.length-1]:null,rows:f}})},removeSelecteds:function(){var t=this;return this.remove(this.getSelectRecords()).then(function(e){return t.clearSelection(),e})},revert:function(e,o){var i=this.tableSourceData,n=this.tableFullData;return arguments.length?(e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){var t=n.indexOf(e),l=i[t];l&&e&&(o?_xeUtils.default.set(e,o,_xeUtils.default.get(l,o)):_xeUtils.default.destructuring(e,l))}),this.$nextTick()):this.reloadData(i)},clearData:function(e,t){var l=this.tableSourceData,o=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=l,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){o.forEach(function(e){e.property&&_tools.UtilTools.setCellValue(t,e,null)})}),this.$nextTick()},hasRowInsert:function(t){var e=this.treeConfig;return e?_xeUtils.default.findTree(this.tableSourceData,function(e){return e===t},e):-1===this.getRowMapIndex(t)},hasRowChange:function(e,t){var l,o=this.tableSourceData;if(!this.fullDataIndexMap.has(e))return!1;var i=_tools.UtilTools.getRowKey(this);if(i){var n=_xeUtils.default.get(e,i),r=this.treeConfig;if(r){var s=r.children,a=_xeUtils.default.findTree(o,function(e){return n===_xeUtils.default.get(e,i)},r);e=Object.assign({},e,_defineProperty({},s,null)),a&&(l=Object.assign({},a.item,_defineProperty({},s,null)))}else{l=o[this.fullDataRowIdMap.get("".concat(n)).index]}}else{l=o[this.getRowMapIndex(e)]}return 1<arguments.length?l&&!_xeUtils.default.isEqual(_xeUtils.default.get(l,t),_xeUtils.default.get(e,t)):l&&!_xeUtils.default.isEqual(l,e)},getColumns:function(e){var t=this.visibleColumn;return arguments.length?t[e]:t.slice(0)},getTableColumn:function(){return this.tableColumn},getRecords:function(e){var t=this.tableFullData;return arguments.length?t[e]:t.slice(0)},getAllRecords:function(){return{insertRecords:this.getInsertRecords(),removeRecords:this.getRemoveRecords(),updateRecords:this.getUpdateRecords()}},getInsertRecords:function(){return this.editStore.insertList},getRemoveRecords:function(){return this.editStore.removeList},getSelectRecords:function(){var e=this.tableFullData,t=this.editStore,l=this.treeConfig,o=this.selectConfig,i=(void 0===o?{}:o).checkField,n=[],r=[];if(i)n=l?_xeUtils.default.filterTree(e,function(e){return _xeUtils.default.get(e,i)},l):e.filter(function(e){return _xeUtils.default.get(e,i)}),r=t.insertList.filter(function(e){return _xeUtils.default.get(e,i)});else{var s=this.selection;n=l?_xeUtils.default.filterTree(e,function(e){return-1<s.indexOf(e)},l):e.filter(function(e){return-1<s.indexOf(e)}),r=t.insertList.filter(function(e){return-1<s.indexOf(e)})}return n.concat(r)},getUpdateRecords:function(){var e=this.tableFullData,t=this.hasRowChange,l=this.treeConfig;return l?_xeUtils.default.filterTree(e,function(e){return t(e)},l):e.filter(function(e){return t(e)})},updateAfterFullData:function(){var e=this.visibleColumn,t=this.tableFullData,c=this.remoteFilter,l=e.find(function(e){return e.order}),o=t,i=e.filter(function(e){var t=e.filters;return t&&t.length});if(o=o.filter(function(a){return i.every(function(t){var e=t.filters,l=t.filterRender,o=l?_vXETable.Renderer.get(l.name):null,i=[],n=[];if(e&&e.length&&(e.forEach(function(e){e.checked&&(n.push(e),i.push(e.value))}),i.length&&!c)){var r=t.property,s=t.filterMethod;return!s&&o&&o.renderFilter&&(s=o.filterMethod),s?n.some(function(e){return s({value:e.value,option:e,row:a,column:t})}):-1<i.indexOf(_xeUtils.default.get(a,r))}return!0})}),l&&l.order){var n=_xeUtils.default.sortBy(o,l.property);o="desc"===l.order?n.reverse():n}return this.afterFullData=o},getTableData:function(e){var t=this.scrollYLoad,l=this.scrollYStore,o=e?this.updateAfterFullData():this.afterFullData;return{fullData:o,tableData:t?o.slice(l.startIndex,l.startIndex+l.renderSize):o.slice(0)}},handleDefault:function(){this.selectConfig&&this.handleDefaultRowChecked(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.updateFooter(),this.$nextTick(this.recalculate)},mergeCustomColumn:function(l){var e=this.tableFullColumn;this.isUpdateCustoms=!0,e.forEach(function(t){var e=l.find(function(e){return t.property&&(e.field||e.prop)===t.property});t.visible=!e||!!e.visible}),this.$emit("update:customs",e)},reloadCustoms:function(e){var t=this;return this.$nextTick().then(function(){return t.mergeCustomColumn(e),t.refreshColumn().then(function(){return t.tableFullColumn})})},refreshColumn:function(){var l,e=this,o=0,i=[],n=0,r=[],s=[],t=this.tableFullColumn,a=this.isGroup,c=this.columnStore,u=this.scrollXStore,h=this.optimizeOpts.scrollX;a&&_xeUtils.default.eachTree(this.collectColumn,function(e){e.children&&e.children.length&&(e.visible=!!_xeUtils.default.findTree(e.children,function(e){return e.children&&e.children.length?0:e.visible},headerProps))},headerProps),t.filter(function(e){return e.visible}).forEach(function(e,t){"left"===e.fixed?(l||(t-o!=0?l=!0:o++),i.push(e)):"right"===e.fixed?(l||(n||(n=t),t-n!=0?l=!0:n++),s.push(e)):r.push(e)});var d=i.concat(r).concat(s),f=h&&h.gt&&h.gt<t.length;if(Object.assign(c,{leftList:i,centerList:r,rightList:s}),l&&a||n&&n!==d.length)throw new Error("[vxe-table] Fixed column must to the left and right sides.");return f&&(Object.assign(u,{startIndex:0,visibleIndex:0,adaptive:!_xeUtils.default.isBoolean(h.adaptive)||h.adaptive,renderSize:h.rSize,offsetSize:h.oSize}),d=d.slice(u.startIndex,u.startIndex+u.renderSize)),this.scrollXLoad=f,this.tableColumn=d,this.$nextTick().then(function(){return e.recalculate(!0)})},analyColumnWidth:function(){var t=[],l=[],o=[],i=[],n=[],r=[];this.tableFullColumn.forEach(function(e){e.visible&&(e.resizeWidth?t.push(e):_tools.DomTools.isPx(e.width)?l.push(e):_tools.DomTools.isScale(e.width)?i.push(e):_tools.DomTools.isPx(e.minWidth)?o.push(e):_tools.DomTools.isScale(e.minWidth)?n.push(e):r.push(e))}),Object.assign(this.columnStore,{resizeList:t,pxList:l,pxMinList:o,scaleList:i,scaleMinList:n,autoList:r})},recalculate:function(e){var t=this,l=this.$refs,o=l.tableBody,i=l.tableHeader,n=l.tableFooter,r=o?o.$el:null,s=i?i.$el:null,a=n?n.$el:null;if(r){var c=r.clientWidth;if(this.autoCellWidth(s,r,a,c),!0===e)return this.computeScrollLoad().then(function(){c=r.clientWidth,t.autoCellWidth(s,r,a,c),t.computeScrollLoad()})}return this.computeScrollLoad()},autoCellWidth:function(e,t,l,o){var i,n=0,r=o,s=this.$el,a=this.fit,c=this.columnStore,u=c.resizeList,h=c.pxMinList,d=c.pxList,f=c.scaleList,g=c.scaleMinList,v=c.autoList;h.forEach(function(e){var t=parseInt(e.minWidth);n+=t,e.renderWidth=t}),i=r/100,g.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*i);n+=t,e.renderWidth=t}),f.forEach(function(e){var t=Math.floor(parseInt(e.width)*i);n+=t,e.renderWidth=t}),d.forEach(function(e){var t=parseInt(e.width);n+=t,e.renderWidth=t}),u.forEach(function(e){var t=parseInt(e.resizeWidth);n+=t,e.renderWidth=t}),i=0<(r-=n)?Math.max(Math.floor(r/(g.length+h.length+v.length)),40):40,a?0<r&&g.concat(h).forEach(function(e){n+=i,e.renderWidth+=i}):i=40,v.forEach(function(e,t){if(e.renderWidth=i,n+=i,a&&t===v.length-1){var l=o-n;0<l&&(e.renderWidth+=l,n=o)}});var m=t.offsetHeight,p=t.scrollHeight>t.clientHeight;if(this.scrollbarWidth=p?t.offsetWidth-o:0,this.overflowY=p,this.tableWidth=n,this.tableHeight=m,this.parentHeight=s.parentNode.clientHeight,e&&(this.headerHeight=e.offsetHeight),l){var x=l.offsetHeight;this.scrollbarHeight=Math.max(x-l.clientHeight,0),this.overflowX=n>l.clientWidth,this.footerHeight=x}else this.scrollbarHeight=Math.max(m-t.clientHeight,0),this.overflowX=o<n;this.overflowX&&this.checkScrolling()},updateStyle:function(){var t=this.$refs,m=this.fullColumnIdMap,p=this.maxHeight,e=this.height,l=this.parentHeight,x=this.border,b=this.tableColumn,C=this.headerHeight,w=this.showHeaderOverflow,_=this.showFooter,T=this.showOverflow,y=this.footerHeight,S=this.tableHeight,D=this.tableWidth,E=this.overflowY,k=this.scrollbarHeight,U=this.scrollbarWidth,I=this.scrollXLoad,R=this.columnStore,M=this.elemStore,o=this.currentRow,$="auto"===e?l:_xeUtils.default.toNumber(e);return["main","left","right"].forEach(function(g,e){var h=0<e?g:"",d=R["".concat(h,"List")],v=t["".concat(h,"Container")];["header","body","footer"].forEach(function(f){var e=M["".concat(g,"-").concat(f,"-wrapper")],t=M["".concat(g,"-").concat(f,"-table")];if("header"===f){var l=D;I&&(h&&(b=d),l=b.reduce(function(e,t){return e+t.renderWidth},0)),t&&(t.style.width=null===l?l:"".concat(l+U,"px"));var o=M["".concat(g,"-").concat(f,"-repair")];o&&(o.style.width="".concat(D,"px"));var i=M["".concat(g,"-").concat(f,"-list")];i&&_xeUtils.default.arrayEach(i.querySelectorAll(".col--gutter"),function(e){e.style.width="".concat(U,"px")})}else if("body"===f){var n=M["".concat(g,"-").concat(f,"-emptyBlock")];if(e&&(0<$?e.style.height="".concat(h?(0<$?$-C-y:S)-(_?0:k):$-C-y,"px"):p&&(p=_xeUtils.default.toNumber(p),e.style.maxHeight="".concat(h?p-C-(_?0:k):p-C,"px"))),v){var r="right"===h,s=R["".concat(h,"List")];e.style.top="".concat(C,"px"),v.style.height="".concat((0<$?$-C-y:S)+C+y-k*(_?2:1),"px"),v.style.width="".concat(s.reduce(function(e,t){return e+t.renderWidth},r?U:0),"px")}var a=D;h&&T?a=(b=d).reduce(function(e,t){return e+t.renderWidth},0):I&&(h&&(b=d),a=b.reduce(function(e,t){return e+t.renderWidth},0)),t&&(t.style.width=a?"".concat(a,"px"):a,E&&h&&(browse["-moz"]||browse.safari)&&(t.style.paddingRight="".concat(U,"px"))),n&&(n.style.width=a?"".concat(a,"px"):a)}else if("footer"===f){var c=D;h&&T?c=(b=d).reduce(function(e,t){return e+t.renderWidth},0):I&&(h&&(b=d),c=b.reduce(function(e,t){return e+t.renderWidth},0)),e&&(v&&(e.style.top="".concat($?$-y:S,"px")),e.style.marginTop="".concat(-k-1,"px")),t&&(t.style.width=null===c?c:"".concat(c+U,"px"))}var u=M["".concat(g,"-").concat(f,"-colgroup")];u&&_xeUtils.default.arrayEach(u.children,function(e){var t=e.getAttribute("name"),l=m.get(t);if("col-gutter"===t&&(e.width="".concat(U||"")),l)if(e.width="".concat(l.renderWidth||""),"header"===f){var o=l.showHeaderOverflow,i=l.renderWidth,n=_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?w:o,r="title"===n||(!0===n||"tooltip"===n)||"ellipsis"===n,s=M["".concat(g,"-").concat(f,"-list")];s&&r&&_xeUtils.default.arrayEach(s.querySelectorAll(".".concat(l.id)),function(e){var t=e.querySelector(".vxe-cell");t&&(t.style.width="".concat(x?i-1:i,"px"))})}else if("body"===f){var a=l.showOverflow,c=l.renderWidth,u=_xeUtils.default.isUndefined(a)||_xeUtils.default.isNull(a)?T:a,h="title"===u||(!0===u||"tooltip"===u)||"ellipsis"===u,d=M["".concat(g,"-").concat(f,"-list")];d&&h&&_xeUtils.default.arrayEach(d.querySelectorAll(".".concat(l.id)),function(e){var t=e.querySelector(".vxe-cell");t&&(t.style.width="".concat(x?c-1:c,"px"))})}})})}),o&&this.setCurrentRow(o),this.$nextTick()},checkScrolling:function(){var e=this.$refs,t=e.tableBody,l=e.leftContainer,o=e.rightContainer,i=t?t.$el:null;i&&(l&&_tools.DomTools[0<i.scrollLeft?"addClass":"removeClass"](l,"scrolling--middle"),o&&_tools.DomTools[i.clientWidth<i.scrollWidth-i.scrollLeft?"addClass":"removeClass"](o,"scrolling--middle"))},preventEvent:function(t,e,l,o){var i=this;_vXETable.Interceptor.get(e).some(function(e){return!1===e(l,t,i)})||o()},handleGlobalMousedownEvent:function(i){var n=this,e=this.$refs,t=this.editStore,l=this.ctxMenuStore,o=this.editConfig,r=void 0===o?{}:o,s=this.filterStore,a=t.actived,c=e.filterWrapper,u=e.validTip;c&&(this.getEventTargetNode(i,this.$el,"vxe-filter-wrapper").flag||this.getEventTargetNode(i,c.$el).flag||this.preventEvent(i,"event.clear_filter",s.args,this.closeFilter)),a.row&&!1!==r.autoClear&&(u&&this.getEventTargetNode(i,u.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&this.preventEvent(i,"event.clear_actived",a.args,function(){var e,t=!n.getEventTargetNode(i,n.$el,"col--edit").flag;if("row"===r.mode){var l=n.getEventTargetNode(i,n.$el,"vxe-body--row"),o=l.flag?l.targetElem!==a.args.cell.parentNode:0;e="manual"===r.trigger?o:o&&t}else e=t;!e&&n.getEventTargetNode(i,n.$el).flag||setTimeout(n.clearActived)})),l.visible&&this.$refs.ctxWrapper&&!this.getEventTargetNode(i,this.$refs.ctxWrapper.$el).flag&&this.closeMenu()},handleGlobalBlurEvent:function(e){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(e){this.clostTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(e){var t,l=this.isCtxMenu,o=this.ctxMenuStore,i=this.editStore,n=this.mouseConfig,r=void 0===n?{}:n,s=this.keyboardConfig,a=void 0===s?{}:s,c=i.selected,u=i.actived,h=e.keyCode,d=8===h,f=9===h,g=13===h,v=27===h,m=32===h,p=37===h,x=38===h,b=39===h,C=40===h,w=46===h,_=67===h,T=86===h,y=88===h,S=113===h,D=e.ctrlKey,E=p||x||b||C,k=l&&o.visible&&(g||m||E);v?(this.closeMenu(),this.closeFilter(),u.row&&(t=u.args,this.clearActived(e),r.selected&&this.handleSelected(t,e))):g&&(a.isArrow||a.isTab)&&(c.row||u.row)?this.moveSelected(c.row?c.args:u.args,p,x,b,!0,e):k?(e.preventDefault(),o.showChild&&_tools.UtilTools.hasChildrenList(o.selected)?this.moveCtxMenu(e,h,o,"selectChild",37,!1,o.selected.children):this.moveCtxMenu(e,h,o,"selected",39,!0,this.ctxMenuList)):S?c.row&&c.column&&this.handleActived(c.args,e):E&&a.isArrow?c.row&&c.column&&(e.preventDefault(),this.moveSelected(c.args,p,x,b,C,e)):f&&a.isTab?c.row||c.column?(e.preventDefault(),this.moveTabSelected(c.args,e)):(u.row||u.column)&&(e.preventDefault(),this.moveTabSelected(u.args,e)):w||d?a.isDel&&(c.row||c.column)&&(_tools.UtilTools.setCellValue(c.row,c.column,null),d&&this.handleActived(c.args,e)):a.isCut&&D&&(y||_||T)?y||_?this.handleCopyed(y,e):this.handlePaste(e):a.isEdit&&!D&&(48<=h&&h<=57||65<=h&&h<=90||96<=h&&h<=111||186<=h&&h<=192||219<=h&&h<=222||32===h)&&c.column&&c.row&&c.column.editRender&&(a.editMethod&&!1===a.editMethod(c.args,e)||(_tools.UtilTools.setCellValue(c.row,c.column,null),this.handleActived(c.args,e)))},moveTabSelected:function(e,t){for(var l,o,i,n,r=this.tableData,s=this.visibleColumn,a=this.editConfig,c=Object.assign({},e),u=r.indexOf(c.row),h=s.indexOf(c.column)+1;h<s.length;h++)if(s[h]){i=s[n=h];break}if(!i&&u<r.length-1){l=r[o=u+1];for(var d=0;d<s.length;d++)if(s[d]){i=s[n=d];break}}i&&(l?(c.rowIndex=o,c.row=l):c.rowIndex=u,c.columnIndex=n,c.column=i,c.cell=_tools.DomTools.getCell(this,c),a&&("click"!==a.trigger&&"dblclick"!==a.trigger||("row"===a.mode?this.handleActived(c,t):(this.handleSelected(c,t),this.scrollToColumn(c.column)))))},moveSelected:function(e,t,l,o,i,n){var r=this.tableData,s=this.visibleColumn,a=Object.assign({},e);if(l&&a.rowIndex)a.rowIndex-=1,a.row=r[a.rowIndex];else if(i&&a.rowIndex<r.length-1)a.rowIndex+=1,a.row=r[a.rowIndex];else if(t&&a.columnIndex){for(var c=a.columnIndex-1;0<=c;c--)if(s[c]){a.columnIndex=c,a.column=s[c];break}}else if(o)for(var u=a.columnIndex+1;u<s.length;u++)if(s[u]){a.columnIndex=u,a.column=s[u];break}a.cell=_tools.DomTools.getCell(this,a),this.handleSelected(a,n),this.scrollToColumn(a.column)},moveCtxMenu:function(e,t,l,o,i,n,r){var s=_xeUtils.default.findIndexOf(r,function(e){return l[o]===e});t===i?n&&_tools.UtilTools.hasChildrenList(l.selected)?l.showChild=!0:(l.showChild=!1,l.selectChild=null):38===t?l[o]=r[s-1]||r[r.length-1]:40===t?l[o]=r[s+1]||r[0]:!l[o]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,l[o])},handleGlobalResizeEvent:function(){this.recalculate()},handleGlobalContextmenuEvent:function(e){var t=this.isCtxMenu,l=this.ctxMenuStore;if(t){if(l.visible&&l.visible&&this.$refs.ctxWrapper&&this.getEventTargetNode(e,this.$refs.ctxWrapper.$el).flag)return void e.preventDefault();if(this.getEventTargetNode(e,this.$el,"vxe-table--header-wrapper").flag)return void this.openContextMenu(e,"header",{});if(this.getEventTargetNode(e,this.$el,"vxe-table--body-wrapper").flag)return void this.openContextMenu(e,"body",{});if(this.getEventTargetNode(e,this.$el,"vxe-table--footer-wrapper").flag)return void this.openContextMenu(e,"footer",{})}this.closeMenu(),this.closeFilter()},openContextMenu:function(n,e,t){var r=this,l=this.tableData,o=this.visibleColumn,s=this.ctxMenuStore,i=this.ctxMenuConfig,a=this.fullDataRowIdMap,c=this.tableFullColumn,u=i[e];if(u){var h=u.options,d=u.visibleMethod;if(u.disabled)n.preventDefault();else if(h&&h.length)if(!d||d(t,n)){n.preventDefault();var f=_tools.DomTools.getDomNode(),g=f.scrollTop,v=f.scrollLeft,m=f.visibleHeight,p=f.visibleWidth,x=this.getEventTargetNode(n,this.$el,"vxe-".concat(e,"--column")),b=x.targetElem,C={type:e,$table:this};if(x.flag){var w=_tools.DomTools.getCellIndexs(b),_=w.rowPrimaryKey,T=w.rowIndex,y=w.colIndex,S=w.columnIndex,D=y?c[y]:o[S];if("body"===e){var E=(_?a.get(_):l[T]).row;C.row=E,C.rowIndex=T}Object.assign(C,{column:D,columnIndex:S,cell:b})}var k=n.clientY+g,U=n.clientX+v;Object.assign(s,{args:C,visible:!0,list:h,selected:null,selectChild:null,showChild:!1,style:{top:"".concat(k,"px"),left:"".concat(U,"px")}}),this.$nextTick(function(){var e=r.$refs.ctxWrapper.$el,t=e.clientHeight,l=e.clientWidth,o=n.clientY+t-m,i=n.clientX+l-p;-10<o&&(s.style.top="".concat(k-t,"px")),-10<i&&(s.style.left="".concat(U-l,"px"))})}else this.closeMenu()}this.closeFilter()},closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,selectChild:null,showChild:!1}),this.$nextTick()},ctxMenuMouseoverEvent:function(e,t,l){var o=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),o.selected=t,(o.selectChild=l)||(o.showChild=_tools.UtilTools.hasChildrenList(t))},ctxMenuMouseoutEvent:function(e,t,l){var o=this.ctxMenuStore;t.children||(o.selected=null),o.selectChild=null},ctxMenuLinkEvent:function(e,t){t.disabled||t.children&&t.children.length||(_tools.UtilTools.emitEvent(this,"context-menu-click",[Object.assign({menu:t},this.ctxMenuStore.args),e]),this.closeMenu())},triggerHeaderTooltipEvent:function(e,t){var l=t.column,o=this.tooltipStore,i=l.own;o.column===l&&o.visible||this.showTooltip(e,i.title||i.label,l)},triggerTooltipEvent:function(e,t){var l=this.editConfig,o=this.editStore,i=this.tooltipStore,n=o.actived,r=t.row,s=t.column;l&&("row"===l.mode&&n.row===r||n.row===r&&n.column===s)||i.column===s&&i.row===r&&i.visible||this.showTooltip(e,_tools.UtilTools.getCellLabel(r,s,t),s,r)},showTooltip:function(e,t,l,o){var i=e.currentTarget,n=this.$refs.tooltip,r=i.children[0];return t&&r.scrollWidth>r.clientWidth&&(Object.assign(this.tooltipStore,{row:o,column:l,visible:!0}),n&&n.toVisible(i,_tools.UtilTools.formatText(t))),this.$nextTick()},clostTooltip:function(){var e=this.$refs.tooltip;return Object.assign(this.tooltipStore,{row:null,column:null,content:null,visible:!1}),e&&e.close(),this.$nextTick()},handleDefaultRowChecked:function(){var e=this.selectConfig,t=void 0===e?{}:e,l=this.tableFullData,o=t.checkAll,i=t.checkRowKeys,n=_tools.UtilTools.getRowKey(this);if(o)this.setAllSelection(!0);else if(i){var r=n;if(!r)throw new Error("[vxe-table] Checked rows must have a unique primary key (row-id | row-key).");this.setSelection(i.map(function(t){return l.find(function(e){return t===e[r]})}),!0)}},setSelection:function(e,t){var l=this;return e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){return l.handleSelectRow({row:e},!!t)}),this.$nextTick()},handleSelectRow:function(e,l){var t=e.row,o=this.selection,i=this.tableFullData,n=this.selectConfig,r=void 0===n?{}:n,s=this.treeConfig,a=this.treeIndeterminates,c=r.checkField,u=r.checkMethod;if(!u||u({row:t,rowIndex:i.indexOf(t)})){if(c)if(s){-1===l?(a.push(t),_xeUtils.default.set(t,c,!1)):(_xeUtils.default.eachTree([t],function(e){return _xeUtils.default.set(e,c,l)},s),_xeUtils.default.remove(a,function(e){return e===t}));var h=_xeUtils.default.findTree(i,function(e){return e===t},s);if(h&&h.parent){var d=h.items.filter(function(e){return _xeUtils.default.get(e,c)});return this.handleSelectRow({row:h.parent},d.length===h.items.length||!(!d.length&&-1!==l)&&-1)}}else _xeUtils.default.set(t,c,l);else if(s){-1===l?(a.push(t),_xeUtils.default.remove(o,function(e){return e===t})):(_xeUtils.default.eachTree([t],function(t){l?-1===o.indexOf(t)&&o.push(t):_xeUtils.default.remove(o,function(e){return e===t})},s),_xeUtils.default.remove(a,function(e){return e===t}));var f=_xeUtils.default.findTree(i,function(e){return e===t},s);if(f&&f.parent){var g=f.items.filter(function(e){return-1<o.indexOf(e)});return this.handleSelectRow({row:f.parent},g.length===f.items.length||!(!g.length&&-1!==l)&&-1)}}else l?-1===o.indexOf(t)&&o.push(t):_xeUtils.default.remove(o,function(e){return e===t});this.checkSelectionStatus()}},handleToggleCheckRowEvent:function(e,t){var l=this.selectConfig,o=void 0===l?{}:l,i=this.selection,n=o.checkField,r=e.row,s=n?!_xeUtils.default.get(r,n):-1===i.indexOf(r);t?this.triggerCheckRowEvent(t,e,s):this.handleSelectRow(e,s)},triggerCheckRowEvent:function(e,t,l){this.handleSelectRow(t,l),_tools.UtilTools.emitEvent(this,"select-change",[Object.assign({selection:this.getSelectRecords(),checked:l},t),e])},toggleRowSelection:function(e){return this.handleToggleCheckRowEvent({row:e}),this.$nextTick()},setAllSelection:function(l){var e=this.tableFullData,t=this.editStore,o=this.selectConfig,i=void 0===o?{}:o,n=this.treeConfig,r=this.selection,s=i.checkField,a=i.reserve,c=i.checkMethod,u=t.insertList,h=[];if(u.length&&(e=e.concat(u)),s){var d=function(e,t){c&&!c({row:e,rowIndex:t})||_xeUtils.default.set(e,s,l)};n?_xeUtils.default.eachTree(e,d,n):e.forEach(d)}else l&&(n?_xeUtils.default.eachTree(e,function(e,t){c&&!c({row:e,rowIndex:t})||h.push(e)},n):h=c?e.filter(function(e,t){return c({row:e,rowIndex:t})}):e.slice(0));this.selection=l&&a?r.concat(h.filter(function(e){return-1===r.indexOf(e)})):h,this.isAllSelected=l,this.isIndeterminate=!1,this.treeIndeterminates=[]},checkSelectionStatus:function(){var e=this.tableFullData,t=this.editStore,l=this.selectConfig,o=void 0===l?{}:l,i=this.selection,n=this.treeIndeterminates,r=o.checkField,s=o.checkMethod,a=t.insertList;a.length&&(e=e.concat(a)),r?(this.isAllSelected=e.length&&e.every(s?function(e,t){return!s({row:e,rowIndex:t})||_xeUtils.default.get(e,r)}:function(e){return _xeUtils.default.get(e,r)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return _xeUtils.default.get(e,r)||-1<n.indexOf(e)})):(this.isAllSelected=e.length&&e.every(s?function(e,t){return!s({row:e,rowIndex:t})||-1<i.indexOf(e)}:function(e){return-1<i.indexOf(e)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return-1<n.indexOf(e)||-1<i.indexOf(e)}))},reserveCheckSelection:function(){var e=this.selectConfig,t=void 0===e?{}:e,l=this.selection,o=this.fullDataRowIdMap,i=t.reserve,n=_tools.UtilTools.getRowKey(this);i&&l.length&&(this.selection=l.map(function(e){var t=""+_xeUtils.default.get(e,n);return o.has(t)?o.get(t).row:e}))},triggerCheckAllEvent:function(e,t){this.setAllSelection(t),_tools.UtilTools.emitEvent(this,"select-all",[{selection:this.getSelectRecords(),checked:t},e])},toggleAllSelection:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearSelection:function(){var e=this.tableFullData,t=this.selectConfig,l=void 0===t?{}:t,o=this.treeConfig,i=l.checkField;return i&&(o?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,i,!1)},o):e.forEach(function(e){return _xeUtils.default.set(e,i,!1)})),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},triggerRadioRowEvent:function(e,t){this.setRadioRow(t.row),_tools.UtilTools.emitEvent(this,"radio-change",[t,e])},triggerCurrentRowEvent:function(e,t){this.setCurrentRow(t.row),_tools.UtilTools.emitEvent(this,"current-change",[t,e])},setCurrentRow:function(e){var t=_tools.UtilTools.getRowPrimaryKey(this,e,this.getRowMapIndex(e));return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentRow=e,this.highlightCurrentRow&&_xeUtils.default.arrayEach(this.$el.querySelectorAll('[data-rowid="'.concat(t,'"]')),function(e){return _tools.DomTools.addClass(e,"row--current")}),this.$nextTick()},setRadioRow:function(e){return this.selectRow!==e&&this.clearRadioRow(),this.selectRow=e,this.$nextTick()},clearCurrentRow:function(){return this.currentRow=null,this.hoverRow=null,_xeUtils.default.arrayEach(this.$el.querySelectorAll(".row--current"),function(e){return _tools.DomTools.removeClass(e,"row--current")}),this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRow:function(){return this.currentRow},getRadioRow:function(){return this.selectRow},triggerHoverEvent:function(e,t){var l=t.row,o=t.rowIndex,i=this.$el,n=_tools.UtilTools.getRowPrimaryKey(this,l,o);this.clearHoverRow(),_xeUtils.default.arrayEach(i.querySelectorAll('[data-rowid="'.concat(n,'"]')),function(e){return _tools.DomTools.addClass(e,"row--hover")}),this.hoverRow=l},clearHoverRow:function(){_xeUtils.default.arrayEach(this.$el.querySelectorAll(".row--hover"),function(e){return _tools.DomTools.removeClass(e,"row--hover")})},triggerHeaderCellMousedownEvent:function(e,t){var a=this.$el,l=this.tableData,o=this.mouseConfig,i=void 0===o?{}:o,n=this.elemStore,c=this.handleChecked,u=this.handleHeaderChecked,r=this.handleIndexChecked,s=e.button,h=t.column,d=t.cell,f=0===s,g="index"===h.type;if(f&&i.checked){var v=n["main-header-list"].children,m=n["main-body-list"].children;if(g){var p=m[0],x=m[m.length-1],b=p.querySelector(".".concat(h.id));this.clearSelected(),u(_tools.DomTools.getRowNodes(v,_tools.DomTools.getCellNodeIndex(d.nextElementSibling),_tools.DomTools.getCellNodeIndex(d.parentNode.lastElementChild))),r(_tools.DomTools.getRowNodes(m,_tools.DomTools.getCellNodeIndex(b),_tools.DomTools.getCellNodeIndex(x.querySelector(".".concat(h.id))))),c(_tools.DomTools.getRowNodes(m,_tools.DomTools.getCellNodeIndex(b.nextElementSibling),_tools.DomTools.getCellNodeIndex(x.lastElementChild)))}else{e.preventDefault(),e.stopPropagation(),this.clearSelected(),this.clearHeaderChecked(),this.clearIndexChecked();var C=document.onmousemove,w=document.onmouseup,_=m[0].querySelector(".".concat(h.id)),T=_xeUtils.default.throttle(function(e){e.preventDefault();var t=_tools.DomTools.getEventTargetNode(e,a,"vxe-header--column"),l=t.flag,o=t.targetElem;if(!l){var i=_tools.DomTools.getEventTargetNode(e,a,"vxe-body--column");l=i.flag,o=i.targetElem}if(l&&!_tools.DomTools.hasClass(o,"col--index")){var n=[].indexOf.call(o.parentNode.children,o),r=m[m.length-1].children[n],s=v[0].children[n];u(_tools.DomTools.getRowNodes(v,_tools.DomTools.getCellNodeIndex(s),_tools.DomTools.getCellNodeIndex(d))),c(_tools.DomTools.getRowNodes(m,_tools.DomTools.getCellNodeIndex(_),_tools.DomTools.getCellNodeIndex(r)))}},80,{leading:!0,trailing:!0});if(_tools.DomTools.addClass(a,"c--checked"),document.onmousemove=T,document.onmouseup=function(){_tools.DomTools.removeClass(a,"c--checked"),document.onmousemove=C,document.onmouseup=w},u([[d]]),m.length){var y=m[m.length-1].querySelector(".".concat(h.id)),S=m[0],D=m[m.length-1],E=S.querySelector(".col--index");t.rowIndex=0,t.row=l[0],t.cell=_tools.DomTools.getCell(this,t),this.handleSelected(t,e),this.handleIndexChecked(_tools.DomTools.getRowNodes(m,_tools.DomTools.getCellNodeIndex(E),_tools.DomTools.getCellNodeIndex(D.querySelector(".col--index")))),this.handleChecked(_tools.DomTools.getRowNodes(m,_tools.DomTools.getCellNodeIndex(_),_tools.DomTools.getCellNodeIndex(y)))}}this.closeMenu()}},triggerCellMousedownEvent:function(e,t){var a=this.$el,l=this.tableData,o=this.visibleColumn,i=this.editStore,n=this.editConfig,r=this.handleSelected,s=this.mouseConfig,c=void 0===s?{}:s,u=this.handleChecked,h=this.handleIndexChecked,d=this.handleHeaderChecked,f=this.elemStore,g=i.checked,v=i.actived,m=t.row,p=t.column,x=t.cell,b=0===e.button;if(n&&("row"===n.mode?v.row!==m:v.column!==p))if(b&&c.checked){e.preventDefault(),e.stopPropagation(),this.clearHeaderChecked(),this.clearIndexChecked();var C=document.onmousemove,w=document.onmouseup,_=_tools.DomTools.getCellNodeIndex(x),T="index"===p.type,y=f["main-body-list"].children,S=f["main-header-list"].children,D=x.parentNode.lastElementChild,E=x.parentNode.firstElementChild,k=[].indexOf.call(x.parentNode.children,x),U=S[0].children[k],I=_xeUtils.default.throttle(function(e){e.preventDefault();var t=_tools.DomTools.getEventTargetNode(e,a,"vxe-body--column"),l=t.flag,o=t.targetElem;if(l)if(T){var i=o.parentNode.firstElementChild;u(_tools.DomTools.getRowNodes(y,_tools.DomTools.getCellNodeIndex(i.nextElementSibling),_tools.DomTools.getCellNodeIndex(D))),h(_tools.DomTools.getRowNodes(y,_tools.DomTools.getCellNodeIndex(i),_tools.DomTools.getCellNodeIndex(x)))}else if(!_tools.DomTools.hasClass(o,"col--index")){var n=o.parentNode.firstElementChild,r=[].indexOf.call(o.parentNode.children,o),s=S[0].children[r];d(_tools.DomTools.getRowNodes(S,_tools.DomTools.getCellNodeIndex(s),_tools.DomTools.getCellNodeIndex(U))),h(_tools.DomTools.getRowNodes(y,_tools.DomTools.getCellNodeIndex(n),_tools.DomTools.getCellNodeIndex(E))),u(_tools.DomTools.getRowNodes(y,_,_tools.DomTools.getCellNodeIndex(o)))}},80,{leading:!0,trailing:!0});if(document.onmousemove=I,document.onmouseup=function(e){document.onmousemove=C,document.onmouseup=w},T){var R=x.parentNode.firstElementChild;t.columnIndex++,t.column=o[t.columnIndex],t.cell=x.nextElementSibling,this.handleSelected(t,e),u(_tools.DomTools.getRowNodes(y,_tools.DomTools.getCellNodeIndex(R.nextElementSibling),_tools.DomTools.getCellNodeIndex(D))),d([S[0].querySelectorAll(".vxe-header--column:not(.col--index)")]),h(_tools.DomTools.getRowNodes(y,_tools.DomTools.getCellNodeIndex(R),_tools.DomTools.getCellNodeIndex(x)))}else this.handleSelected(t,e);this.closeFilter(),this.closeMenu()}else{var M=_tools.DomTools.getCellIndexs(x);-1!==g.rows.indexOf(l[M.rowIndex])&&-1!==g.columns.indexOf(o[M.columnIndex])||r(t,e)}},triggerHeaderCellClickEvent:function(e,t){var l=t.column,o=t.cell;return _tools.UtilTools.emitEvent(this,"header-cell-click",[Object.assign({triggerSort:this.getEventTargetNode(e,o,"vxe-sort-wrapper").flag,triggerFilter:this.getEventTargetNode(e,o,"vxe-filter-wrapper").flag},t),e]),this.highlightCurrentColumn?this.setCurrentColumn(l,!0):this.$nextTick()},setCurrentColumn:function(e){return this.clearCurrentRow(),this.clearCurrentColumn(),this.selectColumn=e,_xeUtils.default.arrayEach(this.$el.querySelectorAll(".".concat(e.id)),function(e){return _tools.DomTools.addClass(e,"col--current")}),this.$nextTick()},clearCurrentColumn:function(){return this.selectColumn=null,_xeUtils.default.arrayEach(this.$el.querySelectorAll(".col--current"),function(e){return _tools.DomTools.removeClass(e,"col--current")}),this.$nextTick()},triggerCellClickEvent:function(e,t){var l=this,o=this.$el,i=this.highlightCurrentRow,n=this.editStore,r=this.radioConfig,s=void 0===r?{}:r,a=this.selectConfig,c=void 0===a?{}:a,u=this.treeConfig,h=void 0===u?{}:u,d=this.editConfig,f=this.mouseConfig,g=void 0===f?{}:f,v=n.actived,m=t.row,p=t.column,x=t.columnIndex,b=t.cell;i&&("row"!==s.trigger&&(this.getEventTargetNode(e,o,"vxe-tree-wrapper").flag||this.getEventTargetNode(e,o,"vxe-checkbox").flag||this.getEventTargetNode(e,o,"vxe-radio").flag)||this.triggerCurrentRowEvent(e,t)),"row"!==s.trigger&&("radio"!==p.type||"cell"!==s.trigger)||this.getEventTargetNode(e,o,"vxe-radio").flag||this.triggerRadioRowEvent(e,t),"row"!==c.trigger&&("selection"!==p.type||"cell"!==c.trigger)||this.getEventTargetNode(e,t.cell,"vxe-checkbox").flag||this.handleToggleCheckRowEvent(t,e),("row"===h.trigger||p.treeNode&&"cell"===h.trigger)&&this.triggerTreeExpandEvent(e,t),g.checked||d&&("click"===d.trigger?v.args&&b===v.args.cell||("row"===d.mode?m===v.row?(v.args.columnIndex=x,v.column=v.args.column=p):this.triggerValidate("blur").catch(function(e){return e}).then(function(){l.handleActived(t,e).then(function(){return l.triggerValidate("change")}).catch(function(e){return e})}):"cell"===d.mode&&this.handleActived(t,e).then(function(){return l.triggerValidate("change")}).catch(function(e){return e})):"dblclick"===d.trigger&&(v.args&&b===v.args.cell||("row"===d.mode?m===v.row?(v.args.columnIndex=x,v.column=v.args.column=p):this.handleSelected(t,e):"cell"===d.mode&&this.handleSelected(t,e)))),_tools.UtilTools.emitEvent(this,"cell-click",[t,e])},triggerCellDBLClickEvent:function(e,t){var l=this,o=this.editStore,i=this.editConfig,n=o.actived;i&&"dblclick"===i.trigger&&(n.args&&e.currentTarget===n.args.cell||("row"===i.mode?this.triggerValidate("blur").catch(function(e){return e}).then(function(){l.handleActived(t,e).then(function(){return l.triggerValidate("change")}).catch(function(e){return e})}):"cell"===i.mode&&this.handleActived(t,e).then(function(){return l.triggerValidate("change")}).catch(function(e){return e}))),_tools.UtilTools.emitEvent(this,"cell-dblclick",[t,e])},handleActived:function(e,t){var l=this,o=this.editStore,i=this.editConfig,n=this.tableColumn,r=i.activeMethod,s=o.actived,a=e.row,c=e.column,u=e.cell,h=c.model;if(c.editRender){var d="row"===i.mode;if(d?s.row!==a:s.row!==a||s.column!==c){var f="edit-disabled";r&&!r(e)||(this.clostTooltip(),this.clearCopyed(t),this.clearChecked(),this.clearSelected(t),this.clearActived(t),f="edit-actived",c.renderHeight=u.offsetHeight,s.args=e,s.row=a,s.column=c,d?n.forEach(function(e){e.editRender&&(e.model.value=_tools.UtilTools.getCellValue(a,e),e.model.update=!1)}):(h.value=_tools.UtilTools.getCellValue(a,c),h.update=!1),this.$nextTick(function(){l.handleFocus(e,t)})),_tools.UtilTools.emitEvent(this,f,[e,t])}else{var g=s.column;if(g!==c){var v=g.model;v.update&&_tools.UtilTools.setCellValue(a,g,v.value),this.clearValidate()}c.renderHeight=u.offsetHeight,s.args=e,s.column=c,setTimeout(function(){l.handleFocus(e,t)})}}return this.$nextTick()},clearActived:function(e){var t=this.editStore.actived,l=t.args,o=t.row,i=t.column;if(o||i){var n=i.model;n.update&&(_tools.UtilTools.setCellValue(o,i,n.value),n.update=!1,n.value=null,this.updateFooter()),_tools.UtilTools.emitEvent(this,"edit-closed",[l,e])}return t.args=null,t.row=null,t.column=null,this.clearValidate().then(this.recalculate)},getActiveRow:function(){var e=this.$el,t=this.editStore,l=this.tableData,o=t.actived,i=o.args,n=o.row;return i&&-1<l.indexOf(n)&&e.querySelectorAll(".vxe-body--column.col--actived").length?Object.assign({},i):null},hasActiveRow:function(e){return this.editStore.actived.row===e},clearSelected:function(e){var t=this.editStore,l=this.elemStore,o=t.selected;o.row=null,o.column=null;var i=l["main-header-list"],n=l["main-body-list"];return _xeUtils.default.arrayEach(i.querySelectorAll(".col--title-selected"),function(e){return _tools.DomTools.removeClass(e,"col--title-selected")}),_xeUtils.default.arrayEach([n.querySelector(".col--selected")],function(e){return _tools.DomTools.removeClass(e,"col--selected")}),this.$nextTick()},handleSelected:function(i,n){var r=this,e=this.mouseConfig,s=void 0===e?{}:e,t=this.editStore,a=this.elemStore,c=t.selected,u=i.row,h=i.column,d=i.cell;return function(){if((c.row!==u||c.column!==h)&&(r.clearChecked(n),r.clearIndexChecked(),r.clearHeaderChecked(),r.clearSelected(),r.clearActived(n),c.args=i,c.row=u,c.column=h,s.selected)){var e=a["main-body-list"],t=_tools.UtilTools.getRowPrimaryKey(r,u,r.getRowMapIndex(u)),l=e.querySelector('[data-rowid="'.concat(t,'"]')).querySelector(".".concat(h.id));_tools.DomTools.addClass(l,"col--selected")}if(s.checked){var o=a["main-header-list"];r.handleChecked([[d]]),r.handleHeaderChecked([[o.querySelector(".".concat(h.id))]]),r.handleIndexChecked([[d.parentNode.querySelector(".col--index")]])}return r.$nextTick()}()},clearChecked:function(e){var t=this.$refs,l=this.editStore,o=this.mouseConfig,i=l.checked;if(o&&o.checked){var n=t.tableBody;i.rows=[],i.columns=[],i.tRows=[],i.tColumns=[],n.$refs.checkBorders.style.display="none",_xeUtils.default.arrayEach(n.$el.querySelectorAll(".col--checked"),function(e){return _tools.DomTools.removeClass(e,"col--checked")})}return this.$nextTick()},handleChecked:function(e){var t=this.editStore.checked;this.clearChecked();var i=-2,n=-2,r=0,s=0;_xeUtils.default.arrayEach(e,function(e,t){var o=0===t;_xeUtils.default.arrayEach(e,function(e,t){var l=0===t;l&&o&&(r=e.offsetTop,s=e.offsetLeft),o&&(i+=e.offsetWidth),l&&(n+=e.offsetHeight),_tools.DomTools.addClass(e,"col--checked")})});var l=this.$refs.tableBody.$refs,o=l.checkBorders,a=l.checkTop,c=l.checkRight,u=l.checkBottom,h=l.checkLeft;o.style.display="block",Object.assign(a.style,{top:"".concat(r,"px"),left:"".concat(s,"px"),width:"".concat(i,"px")}),Object.assign(c.style,{top:"".concat(r,"px"),left:"".concat(s+i,"px"),height:"".concat(n,"px")}),Object.assign(u.style,{top:"".concat(r+n,"px"),left:"".concat(s,"px"),width:"".concat(i,"px")}),Object.assign(h.style,{top:"".concat(r,"px"),left:"".concat(s,"px"),height:"".concat(n,"px")}),t.rowNodes=e},handleIndexChecked:function(e){var t=this.editStore.indexs;this.clearIndexChecked(),_xeUtils.default.arrayEach(e,function(e){_xeUtils.default.arrayEach(e,function(e){_tools.DomTools.addClass(e,"col--index-checked")})}),t.rowNodes=e},clearIndexChecked:function(){var e=this.elemStore["main-body-list"];return _xeUtils.default.arrayEach(e.querySelectorAll(".col--index-checked"),function(e){return _tools.DomTools.removeClass(e,"col--index-checked")}),this.$nextTick()},handleHeaderChecked:function(e){var t=this.editStore.titles;this.clearHeaderChecked(),_xeUtils.default.arrayEach(e,function(e){_xeUtils.default.arrayEach(e,function(e){_tools.DomTools.addClass(e,"col--title-checked")})}),t.rowNodes=e},clearHeaderChecked:function(){var e=this.elemStore["main-header-list"];return _xeUtils.default.arrayEach(e.querySelectorAll(".col--title-checked"),function(e){return _tools.DomTools.removeClass(e,"col--title-checked")}),this.$nextTick()},clearCopyed:function(){var e=this.$refs,t=this.editStore,l=this.keyboardConfig,o=t.copyed;if(l&&l.isCut){var i=e.tableBody,n=e.tableBody.$refs.copyBorders;o.cut=!1,o.rows=[],o.columns=[],n.style.display="none",_xeUtils.default.arrayEach(i.$el.querySelectorAll(".col--copyed"),function(e){return _tools.DomTools.removeClass(e,"col--copyed")})}return this.$nextTick()},handleCopyed:function(e,t){var l=this.tableData,o=this.tableColumn,i=this.editStore,n=i.copyed,r=i.checked.rowNodes;this.clearCopyed();var s=-3,a=-3,c=0,u=0,h=[],d=[];if(r.length){var f=r[0],g=_tools.DomTools.getCellNodeIndex(f[0]),v=g.rowIndex,m=g.columnIndex;h=o.slice(m,m+f.length),d=l.slice(v,v+r.length)}_xeUtils.default.arrayEach(r,function(e,t){var o=0===t;_xeUtils.default.arrayEach(e,function(e,t){var l=0===t;l&&o&&(c=e.offsetTop,u=e.offsetLeft),o&&(s+=e.offsetWidth),l&&(a+=e.offsetHeight),_tools.DomTools.addClass(e,"col--copyed")})});var p=this.$refs.tableBody.$refs,x=p.copyBorders,b=p.copyTop,C=p.copyRight,w=p.copyBottom,_=p.copyLeft;x.style.display="block",Object.assign(b.style,{top:"".concat(c,"px"),left:"".concat(u,"px"),width:"".concat(s,"px")}),Object.assign(C.style,{top:"".concat(c,"px"),left:"".concat(u+s,"px"),height:"".concat(a,"px")}),Object.assign(w.style,{top:"".concat(c+a,"px"),left:"".concat(u,"px"),width:"".concat(s,"px")}),Object.assign(_.style,{top:"".concat(c,"px"),left:"".concat(u,"px"),height:"".concat(a,"px")}),n.cut=e,n.rows=d,n.columns=h,n.rowNodes=r},handlePaste:function(e){var t=this.tableData,n=this.visibleColumn,l=this.editStore,o=this.elemStore,i=l.copyed,r=l.selected,s=i.cut,a=i.rows,c=i.columns;if(a.length&&c.length&&r.row&&r.column){var u=r.args,h=u.rowIndex,d=u.columnIndex;_xeUtils.default.arrayEach(a,function(o,e){var i=t[h+e];i&&_xeUtils.default.arrayEach(c,function(e,t){var l=n[d+t];l&&_tools.UtilTools.setCellValue(i,l,_tools.UtilTools.getCellValue(o,e)),s&&_tools.UtilTools.setCellValue(o,e,null)})}),s&&this.clearCopyed();var f=o["main-body-list"].children,g=r.args.cell,v=g.parentNode,m=_xeUtils.default.arrayIndexOf(v.children,g),p=f[_xeUtils.default.arrayIndexOf(f,v)+a.length-1].children[m+c.length-1];this.handleChecked(_tools.DomTools.getRowNodes(f,_tools.DomTools.getCellNodeIndex(g),_tools.DomTools.getCellNodeIndex(p)))}},handleFocus:function(e,t){var l=e.column,o=e.cell,i=l.editRender;if(i){var n,r=_vXETable.Renderer.get(i.name),s=i.autofocus,a=i.autoselect;if(s&&(n=o.querySelector(s)),!n&&r&&r.autofocus&&(n=o.querySelector(r.autofocus)),n&&(n[a?"select":"focus"](),browse.msie)){var c=n.createTextRange();c.collapse(!1),c.select()}}},setActiveRow:function(e){return this.setActiveCell(e,this.visibleColumn.find(function(e){return e.editRender}).property)},setActiveCell:function(s,a){var c=this;return new Promise(function(r){setTimeout(function(){var e=c.tableData,t=c.visibleColumn,l=c.handleActived;if(s&&a){var o=e.indexOf(s);if(-1<o){var i=t.find(function(e){return e.property===a}),n=_tools.DomTools.getCell(c,{row:s,rowIndex:o,column:i});l({row:s,column:i,cell:n}),c.lastCallTime=Date.now()}}r(c.$nextTick())})})},setSelectCell:function(e,t){var l=this.tableData,o=this.editConfig,i=this.visibleColumn;if(e&&t&&"manual"!==o.trigger){var n=i.find(function(e){return e.property===t}),r=l.indexOf(e);if(-1<r&&n){var s=_tools.DomTools.getCell(this,{row:e,rowIndex:r,column:n}),a={row:e,rowIndex:r,column:n,columnIndex:i.indexOf(n),cell:s};this.handleSelected(a,{})}}return this.$nextTick()},triggerSortEvent:function(e,t,l,o){this.sort(t.property,o)},sort:function(t,e){var l=this.visibleColumn,o=this.tableFullColumn,i=this.remoteSort,n=l.find(function(e){return e.property===t}),r=_xeUtils.default.isBoolean(n.remoteSort)?n.remoteSort:i;return n.sortable?(e||(e="desc"===n.order?"asc":"desc"),n.order!==e&&(o.forEach(function(e){e.order=null}),n.order=e,r||(this.tableData=this.getTableData(!0).tableData),_tools.UtilTools.emitEvent(this,"sort-change",[{column:n,prop:t,field:t,order:e}])),this.$nextTick().then(this.updateStyle)):this.$nextTick()},clearSort:function(){return this.tableFullColumn.forEach(function(e){e.order=null}),this.tableFullData=this.data||[],this.tableData=this.getTableData(!0).tableData,this.$nextTick()},triggerFilterEvent:function(e,t,l){var o=this.$refs,i=this.filterStore,n=this.overflowX;if(i.column===t&&i.visible)i.visible=!1;else{var r=e.target,s=o.tableBody.$el,a=o.filterWrapper,c=_tools.DomTools.getOffsetPos(r),u=c.top,h=c.left;n&&(h-=s.scrollLeft),Object.assign(i,{args:l,multiple:t.filterMultiple,options:t.filters,column:t,style:{zIndex:_conf.default.tooltip.zIndex,top:"".concat(u+r.clientHeight+6,"px"),left:"".concat(h,"px")},visible:!0}),i.isAllSelected=i.options.every(function(e){return e.checked}),i.isIndeterminate=!this.isAllSelected&&i.options.some(function(e){return e.checked}),this.$nextTick(function(){var e=a.$el;i.style.top="".concat(u+r.clientHeight+6,"px"),i.style.left="".concat(h-e.clientWidth/2+10,"px")})}},confirmFilterEvent:function(e){var t=this.visibleColumn,l=this.filterStore,o=this.remoteFilter,i=this.scrollXLoad,n=this.scrollYLoad,r=l.column,s=[];r.filters.forEach(function(e){e.checked&&s.push(e.value)}),l.visible=!1,o||(this.tableData=this.getTableData(!0).tableData);var a=[];t.filter(function(e){var t=e.property,l=e.filters,o=[];l&&l.length&&(l.forEach(function(e){e.checked&&o.push(e.value)}),a.push({column:e,field:t,prop:t,values:o}))}),_tools.UtilTools.emitEvent(this,"filter-change",[{column:r,field:r.property,prop:r.property,values:s,filters:a}]),(i||n)&&this.clearScroll(),this.closeFilter(),this.$nextTick(this.recalculate)},closeFilter:function(e){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},resetFilterEvent:function(e){this.filterStore.options.forEach(function(e){e.checked=!1,e.data=e._data}),this.confirmFilterEvent(e)},clearFilter:function(){return this.visibleColumn.forEach(function(e){var t=e.filters;t&&t.length&&t.forEach(function(e){e.checked=!1})}),Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),this.tableData=this.getTableData(!0).tableData,this.$nextTick()},triggerRowExpandEvent:function(e,t){var l=t.row,o=this.toggleRowExpansion(l);return _tools.UtilTools.emitEvent(this,"toggle-expand-change",[{row:l,rowIndex:this.getRowMapIndex(l),$table:this},e]),o},toggleRowExpansion:function(e){return this.setRowExpansion(e)},handleDefaultRowExpand:function(){var e=this.expandConfig,t=void 0===e?{}:e,l=this.tableFullData,o=t.expandAll,i=t.expandRowKeys,n=_tools.UtilTools.getRowKey(this);if(o)this.expandeds=l.slice(0);else if(i){var r=n;if(!r)throw new Error("[vxe-table] Expand rows must have a unique primary key (row-id | row-key).");this.expandeds=i.map(function(t){return l.find(function(e){return t===e[r]})})}},setAllRowExpansion:function(e){return this.expandeds=e?this.tableFullData.slice(0):[],this.$nextTick()},setRowExpansion:function(e,l){var o=this.expandeds,t=this.expandConfig,i=void 0===t?{}:t,n=1===arguments.length;return e&&(_xeUtils.default.isArray(e)||(e=[e]),i.accordion&&(o.length=0,e=e.slice(e.length-1,e.length)),e.forEach(function(e){var t=o.indexOf(e);-1<t?!n&&l||o.splice(t,1):(n||l)&&o.push(e)})),this.$nextTick()},hasRowExpand:function(e){return-1<this.expandeds.indexOf(e)},clearRowExpand:function(){return this.expandeds=[],this.$nextTick()},triggerTreeExpandEvent:function(e,t){var l=this,o=t.row,i=this.selectColumn,n=this.toggleTreeExpansion(o);return _tools.UtilTools.emitEvent(this,"toggle-tree-change",[{row:o,rowIndex:this.getRowMapIndex(o),$table:this},e]),i&&this.$nextTick(function(){return l.setCurrentColumn(i)}),n},toggleTreeExpansion:function(e){return this.setTreeExpansion(e)},handleDefaultTreeExpand:function(){var o=this.treeConfig,i=this.tableFullData;if(o){var e=o.expandAll,t=o.expandRowKeys,n=o.children,r=_tools.UtilTools.getRowKey(this),s=[];e?(_xeUtils.default.filterTree(i,function(e){var t=e[n];t&&t.length&&s.push(e)},o),this.treeExpandeds=s):t&&(t.forEach(function(t){var e=_xeUtils.default.findTree(i,function(e){return t===_xeUtils.default.get(e,r)},o),l=e?e.item[n]:0;l&&l.length&&s.push(e.item)}),this.treeExpandeds=s)}},setAllTreeExpansion:function(e){var t=this.tableFullData,l=this.treeConfig,o=l.children,i=[];return e&&_xeUtils.default.eachTree(t,function(e){var t=e[o];t&&t.length&&i.push(e)},l),this.treeExpandeds=i,this.$nextTick()},setTreeExpansion:function(e,i){var n=this.tableFullData,r=this.treeExpandeds,s=this.treeConfig,a=s.children,c=1===arguments.length;return e&&(_xeUtils.default.isArray(e)||(e=[e]),s.accordion&&(e=e.slice(e.length-1,e.length)),e.forEach(function(t){var e=t[a];if(e&&e.length){var l=r.indexOf(t);if(s.accordion){var o=_xeUtils.default.findTree(n,function(e){return e===t},s);_xeUtils.default.remove(r,function(e){return-1<o.items.indexOf(e)})}-1<l?!c&&i||r.splice(l,1):(c||i)&&r.push(t)}})),this.$nextTick()},hasTreeExpand:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){return this.treeExpandeds=[],this.$nextTick()},getVirtualScroller:function(){var e=this.$refs,t=this.scrollXLoad,l=this.scrollYLoad,o=e.tableBody.$el;return{scrollX:t,scrollY:l,scrollTop:o.scrollTop,scrollLeft:o.scrollLeft}},triggerScrollXEvent:function(e){for(var t=this,l=this.$refs,o=this.visibleColumn,i=this.scrollXStore,n=i.startIndex,r=i.renderSize,s=i.offsetSize,a=i.visibleSize,c=l.tableBody.$el.scrollLeft,u=0,h=0,d=0;d<o.length;d++)if(c<(h+=o[d].renderWidth)){u=d;break}if(i.visibleIndex!==u){var f=0,g=r<3*a,v=r-a;(i.visibleIndex>u?(f=v-(g?Math.floor(v/2):Math.floor(6*a<r?3*a:1.5*a)),u-s<=n):(f=g?Math.floor(v/2):Math.floor(6*a<r?3*a:1.5*a),n+r<=u+a+s))&&(i.visibleIndex=u,i.startIndex=Math.min(Math.max(u-f,0),o.length-r),this.updateScrollXData(),this.$nextTick(function(){t.updateStyle()}))}this.clostTooltip()},triggerScrollYEvent:function(e){var t=this.scrollYStore;isWebkit&&t.adaptive?this.loadScrollYData(e):this.debounceScrollY(e)},debounceScrollY:_xeUtils.default.debounce(function(e){this.loadScrollYData(e)},debounceScrollYDuration,{leading:!1,trailing:!0}),loadScrollYData:function(e){var t=this,l=this.tableFullData,o=this.scrollYStore,i=o.startIndex,n=o.renderSize,r=o.offsetSize,s=o.visibleSize,a=o.rowHeight,c=e.target.scrollTop,u=Math.ceil(c/a);if(o.visibleIndex!==u){var h=0,d=n<3*s,f=n-s;(o.visibleIndex>u?(h=f-(d?Math.floor(f/2):Math.floor(6*s<n?3*s:1.5*s)),u-r<=i):(h=d?Math.floor(f/2):Math.floor(6*s<n?3*s:1.5*s),i+n<=u+s+r))&&(o.visibleIndex=u,o.startIndex=Math.min(Math.max(u-h,0),l.length-n),this.updateScrollYData(),this.$nextTick(function(){t.updateStyle()}))}},computeScrollLoad:function(){var g=this;return this.$nextTick().then(function(){var e=g.scrollXLoad,t=g.scrollYLoad,l=g.scrollYStore,o=g.scrollXStore,i=g.visibleColumn,n=g.optimizeOpts,r=n.scrollX,s=n.scrollY,a=g.$refs.tableBody,c=a?a.$el:null,u=g.$refs.tableHeader;if(c){if(e){var h=r.vSize||Math.ceil(c.clientWidth/(i.slice(0,10).reduce(function(e,t){return e+t.renderWidth},0)/10));o.visibleSize=h,o.adaptive&&(o.offsetSize=h,o.renderSize=h+2),g.updateScrollXData()}else g.updateScrollXSpace();if(t){if(s.rHeight)l.rowHeight=s.rHeight;else{var d=c.querySelector("tbody>tr");!d&&u&&(d=u.$el.querySelector("thead>tr")),d&&(l.rowHeight=d.clientHeight)}var f=s.vSize||Math.ceil(c.clientHeight/l.rowHeight);l.visibleSize=f,isWebkit&&l.adaptive&&(l.offsetSize=f,l.renderSize=f+2),g.updateScrollYData()}else g.updateScrollYSpace()}g.$nextTick(g.updateStyle)})},updateScrollXData:function(){var e=this.visibleColumn,t=this.scrollXStore;this.tableColumn=e.slice(t.startIndex,t.startIndex+t.renderSize),this.updateScrollXSpace()},updateScrollXSpace:function(){var e=this.$refs,o=this.elemStore,t=this.visibleColumn,l=this.scrollXStore,i=this.scrollXLoad,n=this.tableWidth,r=this.scrollbarWidth,s=e.tableHeader,a=e.tableBody,c=e.tableFooter,u=s?s.$el.querySelector(".vxe-table--header"):null,h=a.$el.querySelector(".vxe-table--body"),d=c?c.$el.querySelector(".vxe-table--footer"):null,f=t.slice(0,l.startIndex).reduce(function(e,t){return e+t.renderWidth},0),g="";i&&(g="".concat(f,"px")),u&&(u.style.marginLeft=g),h.style.marginLeft=g,d&&(d.style.marginLeft=g);["main"].forEach(function(l){["header","body","footer"].forEach(function(e){var t=o["".concat(l,"-").concat(e,"-xSpace")];t&&(t.style.width=i?"".concat(n+("header"===e?r:0),"px"):"")})})},updateScrollYData:function(){var e=this.getTableData().tableData;this.tableData=e,this.updateScrollYSpace()},updateScrollYSpace:function(){var o=this.elemStore,e=this.scrollYStore,t=this.scrollYLoad,l=this.getTableData().fullData.length*e.rowHeight,i=Math.max(e.startIndex*e.rowHeight,0),n="",r="";t&&(n="".concat(i,"px"),r="".concat(l,"px")),["main","left","right"].forEach(function(l){var e=o["".concat(l,"-body-table")];e&&(e.style.marginTop=n),["header","body","footer"].forEach(function(e){var t=o["".concat(l,"-").concat(e,"-ySpace")];t&&(t.style.height=r)})})},scrollTo:function(e,t){var l=this.$refs.tableBody.$el;_xeUtils.default.isNumber(e)&&(l.scrollLeft=e),_xeUtils.default.isNumber(t)&&(l.scrollTop=t)},scrollToRow:function(e){var t=this.scrollYLoad,l=this.scrollYStore,o=this.afterFullData,i=this.fullDataIndexMap,n=this.elemStore,r=_tools.UtilTools.getRowPrimaryKey(this,e,this.getRowMapIndex(e));if(t){if(-1===e&&o.length&&(e=o[o.length-1]),i.has(e)){var s=l.rowHeight,a=o.indexOf(e);this.scrollTo(null,(a-1)*s)}}else{var c=n["main-body-list"];_tools.DomTools.scrollIntoElem(c.querySelector('[data-rowid="'.concat(r,'"]')))}},scrollToColumn:function(e){var t=this.scrollXLoad,l=this.elemStore,o=this.visibleColumn,i=this.fullColumnIndexMap;if(t){if(-1===e||i.has(e)){for(var n=0,r=0;r<o.length&&o[r]!==e;r++)n+=o[r].renderWidth;this.scrollTo(n)}}else{var s=l["main-body-list"];_tools.DomTools.scrollIntoElem(s.querySelector(".".concat(e.id)))}},clearScroll:function(){var i=this;return Object.assign(this.scrollXStore,{startIndex:0}),Object.assign(this.scrollYStore,{startIndex:0}),this.$nextTick(function(){var e=i.$refs.tableBody,t=e?e.$el:null,l=i.$refs.tableFooter,o=l?l.$el:null;t&&(t.scrollTop=0,t.scrollLeft=0),o&&(o.scrollLeft=0)}),this.$nextTick()},updateFooter:function(){var e=this.showFooter,t=this.visibleColumn,l=this.afterFullData,o=this.footerMethod;return e&&o&&(this.footerData=t.length?o({columns:t,data:this.editStore.insertList.concat(l)}):[]),this.$nextTick()},updateStatus:function(a,c){var u=this,h=!_xeUtils.default.isUndefined(c);return this.$nextTick().then(function(){var e=u.$refs,t=u.tableData,l=u.editRules,o=u.validStore;if(a&&e.tableBody&&l){var i=a.row,n=a.column;if(u.hasCellRules("change",i,n)){var r=t.indexOf(i),s=_tools.DomTools.getCell(u,{row:i,rowIndex:r,column:n});if(s)return u.validCellRules("change",i,n,c).then(function(){h&&o.visible&&_tools.UtilTools.setCellValue(i,n,c),u.clearValidate()}).catch(function(e){var t=e.rule;h&&_tools.UtilTools.setCellValue(i,n,c),u.showValidTooltip({rule:t,row:i,column:n,cell:s})})}}})},triggerValidate:function(o){var i=this,e=this.editConfig,t=this.editStore,l=this.editRules,n=this.validStore,r=t.actived;if(r.row&&l){var s=r.args,a=s.row,c=s.column,u=s.cell;if(this.hasCellRules(o,a,c))return this.validCellRules(o,a,c).then(function(){"row"===e.mode&&n.visible&&n.row===a&&n.column===c&&i.clearValidate()}).catch(function(e){var t=e.rule;if(t.trigger&&o!==t.trigger)return Promise.resolve();var l={rule:t,row:a,column:c,cell:u};return i.showValidTooltip(l),Promise.reject(l)})}return Promise.resolve()},fullValidate:function(e,t){return this.beginValidate(e,t,!0)},validate:function(e,t){return this.beginValidate(e,t)},beginValidate:function(e,u,h){var d=this,f={},g=!0,t=this.editRules,l=this.tableData,v=this.tableFullData,m=this.scrollYLoad,p=this.scrollYStore,o=m?v:l;e&&(_xeUtils.default.isFunction(e)?u=e:o=_xeUtils.default.isArray(e)?e:[e]);var i=[];if(this.lastCallTime=Date.now(),this.clearValidate(),t){var n=this.getColumns();return o.forEach(function(r){var s=l.indexOf(r),e=[];n.forEach(function(i,n){_xeUtils.default.has(t,i.property)&&e.push(new Promise(function(l,o){d.validCellRules("all",r,i).then(l).catch(function(e){var t={rule:e.rule,rules:e.rules,rowIndex:s,row:r,columnIndex:n,column:i};return h?(f[i.property]||(f[i.property]=[]),f[i.property].push(t),l()):o(t)})}))}),i.push(Promise.all(e))}),Promise.all(i).then(function(){var e=Object.keys(f);if(e.length)return Promise.reject(f[e[0]][0]);u&&u(g)}).catch(function(a){var c=h?f:_defineProperty({},a.column.property,a);return new Promise(function(e,t){var l=a.row,o=function(){a.cell=_tools.DomTools.getCell(d,a),d.handleValidError(a),u?e(u(g=!1,c)):t(c)};if(m){var i=p.startIndex,n=p.renderSize,r=p.rowHeight,s=d.getRowMapIndex(l);if(-1===s&&(s=v.indexOf(l)),s<i||i+n<s)return d.$refs.tableBody.$el.scrollTop=(s-1)*r,setTimeout(o,2*debounceScrollYDuration)}o()})})}return u&&u(g),Promise.resolve(!0)},hasCellRules:function(t,e,l){var o=this.editRules,i=l.property;if(i&&o){var n=_xeUtils.default.get(o,i);return n&&n.find(function(e){return"all"===t||!e.trigger||t===e.trigger})}return!1},validCellRules:function(s,a,c,e){var u=this,t=this.editRules,l=c.property,h=[],o=[];if(l&&t){var d=_xeUtils.default.get(t,l),f=_xeUtils.default.isUndefined(e)?_xeUtils.default.get(a,l):e;d&&d.forEach(function(r){o.push(new Promise(function(l){var e=!0===r.required;if("all"!==s&&r.trigger&&s!==r.trigger)l();else if(_xeUtils.default.isFunction(r.validator))r.validator(r,f,function(e){if(_xeUtils.default.isError(e)){var t={type:"custom",trigger:r.trigger,message:e.message,rule:r};h.push(t)}return l()},{rules:d,row:a,column:c,rowIndex:u.getRowMapIndex(a),columnIndex:u.getColumnMapIndex(c)});else{var t,o=f,i="number"===r.type,n=null==f||""===f;i?o=_xeUtils.default.toNumber(f):t=_xeUtils.default.getSize(o),e&&n?h.push(r):(i&&isNaN(f)||_xeUtils.default.isRegExp(r.pattern)&&!r.pattern.test(f)||_xeUtils.default.isNumber(r.min)&&(i?o<r.min:t<r.min)||_xeUtils.default.isNumber(r.max)&&(i?o>r.max:t>r.max))&&h.push(r),l()}}))})}return Promise.all(o).then(function(){if(h.length){var e={rules:h,rule:h[0]};return Promise.reject(e)}})},clearValidate:function(){var e=this.$refs.validTip;return Object.assign(this.validStore,{visible:!1,row:null,column:null,content:"",rule:null}),e&&e.visible&&e.close(),this.$nextTick()},handleValidError:function(e){var t=this;this.handleActived(e,{type:"valid-error",trigger:"call"}).then(function(){return t.showValidTooltip(e)})},showValidTooltip:function(e){var t=this,l=this.$refs,o=this.height,i=this.tableData,n=this.validOpts,r=l.validTip,s=e.rule,a=e.row,c=e.column,u=e.cell,h=_tools.UtilTools.formatText(s.message);this.$nextTick(function(){Object.assign(t.validStore,{row:a,column:c,rule:s,content:h,visible:!0}),r&&("tooltip"===n.message||"default"===n.message&&!o&&i.length<2)&&r.toVisible(u,h),_tools.UtilTools.emitEvent(t,"valid-error",[e])})},exportCsv:function(e){var t=this.visibleColumn,l=this.scrollXLoad,o=this.scrollYLoad,i=this.treeConfig,n=Object.assign({filename:"table.csv",original:!!i,isHeader:!0,download:!0,data:null,columns:null,columnFilterMethod:function(e){return-1===["index","selection","radio"].indexOf(e.type)&&e.property},dataFilterMethod:null},e);-1===n.filename.indexOf(".csv")&&(n.filename+=".csv"),(l||o)&&(n.original=!0);var r=t,s=this.getTableData().fullData;return i&&(s=_xeUtils.default.toTreeArray(s,i)),_tools.ExportTools.downloadCsc(n,_tools.ExportTools.getCsvContent(n,s,r,this.$el))},getEventTargetNode:_tools.DomTools.getEventTargetNode}};exports.default=_default2;