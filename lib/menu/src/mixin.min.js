"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools"),_vXETable=require("../../v-x-e-table");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={methods:{_closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,selectChild:null,showChild:!1}),this.$nextTick()},moveCtxMenu:function(e,t,l,i,n,s,o){var r,c=_xeUtils.default.findIndexOf(o,function(e){return l[i]===e});if(t===n)s&&_tools.UtilTools.hasChildrenList(l.selected)?l.showChild=!0:(l.showChild=!1,l.selectChild=null);else if(38===t){for(var u=c-1;0<=u;u--)if(!1!==o[u].visible){r=o[u];break}l[i]=r||o[o.length-1]}else if(40===t){for(var a=c+1;a<o.length;a++)if(!1!==o[a].visible){r=o[a];break}l[i]=r||o[0]}else!l[i]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,l[i])},handleGlobalContextmenuEvent:function(e){var t=this.isCtxMenu,l=this.ctxMenuStore,i=this.ctxMenuOpts,n=["header","body","footer"];if(t){if(l.visible&&l.visible&&this.$refs.ctxWrapper&&this.getEventTargetNode(e,this.$refs.ctxWrapper.$el).flag)return void e.preventDefault();for(var s=0;s<n.length;s++){var o=n[s],r=this.getEventTargetNode(e,this.$el,"vxe-".concat(o,"--column")),c={type:o,$table:this,columns:this.visibleColumn.slice(0)};if(r.flag){var u=r.targetElem,a=this.getColumnNode(u).item,h="".concat(o,"-");if(Object.assign(c,{column:a,columnIndex:this.getColumnIndex(a),cell:u}),"body"===o){var d=this.getRowNode(u.parentNode).item;h="",c.row=d,c.rowIndex=this.getRowIndex(d)}return this.openContextMenu(e,o,c),void _tools.UtilTools.emitEvent(this,"".concat(h,"cell-context-menu"),[c,e])}if(this.getEventTargetNode(e,this.$el,"vxe-table--".concat(o,"-wrapper")).flag)return void("cell"===i.trigger?e.preventDefault():this.openContextMenu(e,o,c))}}this.closeMenu(),this.closeFilter()},openContextMenu:function(u,e,i){var a=this,h=this.ctxMenuStore,t=this.ctxMenuOpts,l=t[e],n=t.visibleMethod;if(l){var d=l.options;l.disabled?u.preventDefault():d&&d.length&&(i.options=d,this.preventEvent(u,"event.show_menu",i,null,function(){if(!n||n(i,u)){u.preventDefault(),a.updateZindex();var e=_tools.DomTools.getDomNode(),t=e.scrollTop,l=e.scrollLeft,s=e.visibleHeight,o=e.visibleWidth,r=u.clientY+t,c=u.clientX+l;Object.assign(h,{args:i,visible:!0,list:d,selected:null,selectChild:null,showChild:!1,style:{zIndex:a.tZindex,top:"".concat(r,"px"),left:"".concat(c,"px")}}),a.$nextTick(function(){var e=a.$refs.ctxWrapper.$el,t=e.clientHeight,l=e.clientWidth,i=u.clientY+t-s,n=u.clientX+l-o;-10<i&&(h.style.top="".concat(r-t,"px")),-10<n&&(h.style.left="".concat(c-l,"px"))})}else a.closeMenu()}))}this.closeFilter()},ctxMenuMouseoverEvent:function(e,t,l){var i=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),i.selected=t,(i.selectChild=l)||(i.showChild=_tools.UtilTools.hasChildrenList(t))},ctxMenuMouseoutEvent:function(e,t){var l=this.ctxMenuStore;t.children||(l.selected=null),l.selectChild=null},ctxMenuLinkEvent:function(e,t){if(!(t.disabled||t.children&&t.children.length)){var l=_vXETable.Menus.get(t.code),i=Object.assign({menu:t,$table:this},this.ctxMenuStore.args);l&&l.call(this,i,e),_tools.UtilTools.emitEvent(this,"context-menu-click",[i,e]),this.closeMenu()}}}};exports.default=_default;