"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_tools=require("../../tools"),_vXETable=_interopRequireDefault(require("../../v-x-e-table"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={methods:{_closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,selectChild:null,showChild:!1}),this.$nextTick()},moveCtxMenu:function(e,t,o,i,n,l,s){var r,u=_ctor.default.findIndexOf(s,function(e){return o[i]===e});if(t===n)l&&_tools.UtilTools.hasChildrenList(o.selected)?o.showChild=!0:(o.showChild=!1,o.selectChild=null);else if(38===t){for(var c=u-1;0<=c;c--)if(!1!==s[c].visible){r=s[c];break}o[i]=r||s[s.length-1]}else if(40===t){for(var a=u+1;a<s.length;a++)if(!1!==s[a].visible){r=s[a];break}o[i]=r||s[0]}else!o[i]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,o[i])},handleGlobalContextmenuEvent:function(e){var t=this.$refs,o=this.tId,i=this.editStore,n=this.contextMenu,l=this.ctxMenuStore,s=this.ctxMenuOpts,r=this.mouseConfig,u=this.mouseOpts,c=i.selected,a=["header","body","footer"];if(n){if(l.visible&&t.ctxWrapper&&_tools.DomTools.getEventTargetNode(e,t.ctxWrapper.$el).flag)return void e.preventDefault();if(this._keyCtx){var d="body",h={type:d,$grid:this.$xegrid,$table:this,keyboard:!0,columns:this.visibleColumn.slice(0),$event:e};if(r&&u.area){var f=this.getActiveCellArea();if(f&&f.row&&f.column)return h.row=f.row,h.column=f.column,void this.openContextMenu(e,d,h)}else if(r&&u.selected&&c.row&&c.column)return h.row=c.row,h.column=c.column,void this.openContextMenu(e,d,h)}for(var v=0;v<a.length;v++){var g=a[v],p=_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-".concat(g,"--column"),function(e){return e.parentNode.parentNode.parentNode.getAttribute("data-tid")===o}),x={type:g,$grid:this.$xegrid,$table:this,columns:this.visibleColumn.slice(0),$event:e};if(p.flag){var b=p.targetElem,m=this.getColumnNode(b).item,M="".concat(g,"-");if(Object.assign(x,{column:m,columnIndex:this.getColumnIndex(m),cell:b}),"body"===g){var C=this.getRowNode(b.parentNode).item;M="",x.row=C,x.rowIndex=this.getRowIndex(C)}return this.openContextMenu(e,g,x),void this.emitEvent("".concat(M,"cell-context-menu"),x,e)}if(_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-table--".concat(g,"-wrapper"),function(e){return e.getAttribute("data-tid")===o}).flag)return void("cell"===s.trigger?e.preventDefault():this.openContextMenu(e,g,x))}}t.filterWrapper&&!_tools.DomTools.getEventTargetNode(e,t.filterWrapper.$el).flag&&this.closeFilter(),this.closeMenu()},openContextMenu:function(o,e,i){var f=this,v=this.ctxMenuStore,t=this.ctxMenuOpts,n=t[e],g=t.visibleMethod;if(n){var p=n.options;n.disabled?o.preventDefault():p&&p.length&&(i.options=p,this.preventEvent(o,"event.showMenu",i,null,function(){if(!g||g(i)){o.preventDefault(),f.updateZindex();var e=_tools.DomTools.getDomNode(),s=e.scrollTop,r=e.scrollLeft,u=e.visibleHeight,c=e.visibleWidth,a=o.clientY+s,d=o.clientX+r,n=function(){Object.assign(v,{args:i,visible:!0,list:p,selected:null,selectChild:null,showChild:!1,style:{zIndex:f.tZindex,top:"".concat(a,"px"),left:"".concat(d,"px")}}),f.$nextTick(function(){var e=f.$refs.ctxWrapper.$el,t=e.clientHeight,o=e.clientWidth,i=_tools.DomTools.getAbsolutePos(e),n=i.boundingTop,l=i.boundingLeft+o-c;-10<n+t-u&&(v.style.top="".concat(Math.max(s+2,a-t-2),"px")),-10<l&&(v.style.left="".concat(Math.max(r+2,d-o-2),"px"))})},t=i.keyboard,l=i.row,h=i.column;t&&l&&h?f.scrollToRow(l,h).then(function(){var e=f.getCell(l,h),t=_tools.DomTools.getAbsolutePos(e),o=t.boundingTop,i=t.boundingLeft;a=o+s+Math.floor(e.offsetHeight/2),d=i+r+Math.floor(e.offsetWidth/2),n()}):n()}else f.closeMenu()}))}this.closeFilter()},ctxMenuMouseoverEvent:function(e,t,o){var d=e.currentTarget,i=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),i.selected=t,(i.selectChild=o)||(i.showChild=_tools.UtilTools.hasChildrenList(t),i.showChild&&this.$nextTick(function(){var e=d.nextElementSibling;if(e){var t=_tools.DomTools.getAbsolutePos(d),o=t.boundingTop,i=t.boundingLeft,n=t.visibleHeight,l=t.visibleWidth,s=o+d.offsetHeight,r="",u="";i+d.offsetWidth+e.offsetWidth>l-10&&(r="auto",u="".concat(d.offsetWidth,"px"));var c="",a="";s+e.offsetHeight>n-10&&(c="auto",a="0"),e.style.left=r,e.style.right=u,e.style.top=c,e.style.bottom=a}}))},ctxMenuMouseoutEvent:function(e,t){var o=this.ctxMenuStore;t.children||(o.selected=null),o.selectChild=null},ctxMenuLinkEvent:function(e,t){if(!(t.disabled||t.children&&t.children.length)){var o=_vXETable.default.menus.get(t.code),i=Object.assign({menu:t,$grid:this.$xegrid,$table:this,$event:e},this.ctxMenuStore.args);o&&o.call(this,i,e),this.emitEvent("context-menu-click",i,e),this.closeMenu()}}}};exports.default=_default;