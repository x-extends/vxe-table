"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools"),_vXETable=require("../../v-x-e-table");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={methods:{_closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,childPos:null,selectChild:null,showChild:!1}),this.$nextTick()},moveCtxMenu:function(e,t,l,i,n,o,s){var r,c=_xeUtils.default.findIndexOf(s,function(e){return l[i]===e});if(t===n)o&&_tools.UtilTools.hasChildrenList(l.selected)?l.showChild=!0:(l.showChild=!1,l.selectChild=null);else if(38===t){for(var u=c-1;0<=u;u--)if(!1!==s[u].visible){r=s[u];break}l[i]=r||s[s.length-1]}else if(40===t){for(var a=c+1;a<s.length;a++)if(!1!==s[a].visible){r=s[a];break}l[i]=r||s[0]}else!l[i]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,l[i])},handleGlobalContextmenuEvent:function(e){var t=this.id,l=this.isCtxMenu,i=this.ctxMenuStore,n=this.ctxMenuOpts,o=["header","body","footer"];if(l){if(i.visible&&i.visible&&this.$refs.ctxWrapper&&_tools.DomTools.getEventTargetNode(e,this.$refs.ctxWrapper.$el).flag)return void e.preventDefault();for(var s=0;s<o.length;s++){var r=o[s],c=_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-".concat(r,"--column"),function(e){return e.parentNode.parentNode.parentNode.getAttribute("data-tid")===t}),u={type:r,$table:this,columns:this.visibleColumn.slice(0)};if(c.flag){var a=c.targetElem,h=this.getColumnNode(a).item,d="".concat(r,"-");if(Object.assign(u,{column:h,columnIndex:this.getColumnIndex(h),cell:a}),"body"===r){var v=this.getRowNode(a.parentNode).item;d="",u.row=v,u.rowIndex=this.getRowIndex(v)}return this.openContextMenu(e,r,u),void _tools.UtilTools.emitEvent(this,"".concat(d,"cell-context-menu"),[u,e])}if(_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-table--".concat(r,"-wrapper"),function(e){return e.getAttribute("data-tid")===t}).flag)return void("cell"===n.trigger?e.preventDefault():this.openContextMenu(e,r,u))}}this.closeMenu(),this.closeFilter()},openContextMenu:function(h,e,t){var d=this,v=this.ctxMenuStore,l=this.ctxMenuOpts,i=l[e],n=l.visibleMethod;if(i){var f=i.options;i.disabled?h.preventDefault():f&&f.length&&(t.options=f,this.preventEvent(h,"event.showMenu",t,null,function(){if(!n||n(t,h)){h.preventDefault(),d.updateZindex();var e=_tools.DomTools.getDomNode(),o=e.scrollTop,s=e.scrollLeft,r=e.visibleHeight,c=e.visibleWidth,u=h.clientY+o,a=h.clientX+s;Object.assign(v,{args:t,visible:!0,list:f,selected:null,selectChild:null,showChild:!1,childPos:null,style:{zIndex:d.tZindex,top:"".concat(u,"px"),left:"".concat(a,"px")}}),d.$nextTick(function(){var e=d.$refs.ctxWrapper.$el,t=e.clientHeight,l=e.clientWidth,i=h.clientY+t-r,n=h.clientX+l-c;-10<i&&(v.style.top="".concat(Math.max(o+2,u-t-2),"px")),-10<n&&(v.style.left="".concat(Math.max(s+2,a-l-2),"px")),-220<n&&(v.childPos="left")})}else d.closeMenu()}))}this.closeFilter()},ctxMenuMouseoverEvent:function(e,t,l){var i=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),i.selected=t,(i.selectChild=l)||(i.showChild=_tools.UtilTools.hasChildrenList(t))},ctxMenuMouseoutEvent:function(e,t){var l=this.ctxMenuStore;t.children||(l.selected=null),l.selectChild=null},ctxMenuLinkEvent:function(e,t){if(!(t.disabled||t.children&&t.children.length)){var l=_vXETable.Menus.get(t.code),i=Object.assign({menu:t,$table:this},this.ctxMenuStore.args);l&&l.call(this,i,e),_tools.UtilTools.emitEvent(this,"context-menu-click",[i,e]),this.closeMenu()}}}};exports.default=_default;