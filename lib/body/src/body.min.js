"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var scrollProcessTimeout,updateLeftScrollingTimeput,_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,o,l){return o in e?Object.defineProperty(e,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[o]=l,e}function handleLocation(e,o,l,t,r){var n=o.indexOf(t),c=l.indexOf(r);e.active=-1<n&&-1<c,e.top=0===n&&-1<c,e.bottom=n===o.length-1&&-1<c,e.left=-1<n&&0===c,e.right=-1<n&&c===l.length-1}function renderColumn(e,o,l,t,r,n,c,i,d,s,a,u,p){var f,x,h=l._e,m=l.$listeners,v=l.tableData,y=l.overflowX,g=l.scrollXLoad,w=l.scrollYLoad,b=l.border,_=l.highlightCurrentRow,$=l.showOverflow,T=l.showAllOverflow,I=l.selectColumn,P=l.cellClassName,C=l.spanMethod,k=l.keyboardConfig,S=l.selectConfig,L=void 0===S?{}:S,R=l.treeConfig,E=void 0===R?{}:R,q=l.mouseConfig,U=l.editConfig,B=l.editRules,H=l.validConfig,O=void 0===H?{}:H,D=l.editStore,Y=l.validStore,X=_xeUtils.default.isBoolean(T)?T:$,W=a.editRender,A=a.align,M=a.showOverflow,N=a.renderWidth,F=a.columnKey,j=D.checked,z=D.selected,G=D.actived,K=D.copyed,V=q&&q.selected,J=q&&q.checked,Q=k&&k.isCut,Z=n?a.fixed!==n:a.fixed&&y,ee=_xeUtils.default.isUndefined(M)||_xeUtils.default.isNull(M)?X:M,oe="ellipsis"===ee,le="title"===ee,te=!0===ee||"tooltip"===ee,re=le||te||oe,ne={},ce={},ie={},de={},se=Y.row===i&&Y.column===a,ae=B&&(!O.message||"default"===O.message),ue={"data-index":u},pe=W&&U&&"dblclick"===U.trigger,fe={$table:l,$seq:t,seq:r,row:i,rowIndex:d,$rowIndex:s,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:c,isHidden:Z,data:v};if(!g&&!w||re||(oe=re=!0),(te||m["cell-mouseenter"])&&(ne.mouseenter=function(e){var o={$table:l,seq:r,row:i,rowIndex:d,$rowIndex:s,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:c,cell:e.currentTarget};te&&l.triggerTooltipEvent(e,o),_tools.UtilTools.emitEvent(l,"cell-mouseenter",[o,e])}),(te||m["cell-mouseleave"])&&(ne.mouseleave=function(e){l.clostTooltip(),_tools.UtilTools.emitEvent(l,"cell-mouseleave",[{$table:l,seq:r,row:i,rowIndex:d,$rowIndex:s,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:c,cell:e.currentTarget},e])}),ne.mousedown=function(e){l.triggerCellMousedownEvent(e,{$table:l,seq:r,row:i,rowIndex:d,$rowIndex:s,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:c,cell:e.currentTarget})},(_||m["cell-click"]||W&&U||"row"===L.trigger||"selection"===a.type&&"cell"===L.trigger||"row"===E.trigger||a.treeNode&&"cell"===E.trigger)&&(ne.click=function(e){l.triggerCellClickEvent(e,{$table:l,row:i,rowIndex:d,$rowIndex:s,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:c,cell:e.currentTarget})}),(pe||m["cell-dblclick"])&&(ne.dblclick=function(e){l.triggerCellDBLClickEvent(e,{$table:l,seq:r,row:i,rowIndex:d,$rowIndex:s,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:c,cell:e.currentTarget})}),C){var xe=C(fe)||{},he=xe.rowspan,me=void 0===he?1:he,ve=xe.colspan,ye=void 0===ve?1:ve;if(!me||!ye)return null;ue.rowspan=me,ue.colspan=ye}return!Z&&U&&U.showStatus&&(x=l.hasRowChange(i,a.property)),Z||n||(J&&(handleLocation(ce,j.rows,j.columns,i,a),handleLocation(ie,j.tRows,j.tColumns,i,a)),Q&&handleLocation(de,K.rows,K.columns,i,a)),e("td",{class:["vxe-body--column",a.id,(f={},_defineProperty(f,"col--".concat(A),A),_defineProperty(f,"col--edit",W),_defineProperty(f,"col--checked",ce.active),_defineProperty(f,"col--checked-top",ce.top),_defineProperty(f,"col--checked-bottom",ce.bottom),_defineProperty(f,"col--checked-left",ce.left),_defineProperty(f,"col--checked-right",ce.right),_defineProperty(f,"col--checked-temp",ie.active),_defineProperty(f,"col--checked-temp-top",ie.top),_defineProperty(f,"col--checked-temp-bottom",ie.bottom),_defineProperty(f,"col--checked-temp-left",ie.left),_defineProperty(f,"col--checked-temp-right",ie.right),_defineProperty(f,"col--selected",V&&W&&z.row===i&&z.column===a),_defineProperty(f,"col--copyed",de.active),_defineProperty(f,"col--copyed-top",de.top),_defineProperty(f,"col--copyed-bottom",de.bottom),_defineProperty(f,"col--copyed-left",de.left),_defineProperty(f,"col--copyed-right",de.right),_defineProperty(f,"col--ellipsis",re),_defineProperty(f,"col--actived",U&&W&&G.row===i&&(G.column===a||"row"===U.mode)),_defineProperty(f,"col--dirty",x),_defineProperty(f,"col--valid-error",se),_defineProperty(f,"col--current",I===a),_defineProperty(f,"edit--visible",W&&"visible"===W.type),_defineProperty(f,"fixed--hidden",Z),f),P?_xeUtils.default.isFunction(P)?P(fe):P:""],key:F||u,attrs:ue,on:ne},X&&Z?[]:[e("div",{class:["vxe-cell",{"c--title":le,"c--tooltip":te,"c--ellipsis":oe}],attrs:{title:le?_tools.UtilTools.getCellLabel(i,a,fe):null},style:{width:re?"".concat(b?N-1:N,"px"):null}},a.renderCell(e,fe)),ae?se&&2<=v.length?e("div",{class:"vxe-cell--valid",style:Y.rule&&Y.rule.width?{width:"".concat(Y.rule.width,"px")}:null},[e("span",{class:"vxe-cell--valid-msg"},Y.content)]):h():null,J&&!n?e("span",{class:"vxe-body--column-checked-lt"}):null,J&&!n?e("span",{class:"vxe-body--column-checked-rb"}):null,Q&&!n?e("span",{class:"vxe-body--column-copyed-lt"}):null,Q&&!n?e("span",{class:"vxe-body--column-copyed-rb"}):null,ce.bottom&&ce.right?e("span",{class:"vxe-body--column-checked-corner",on:{mousedown:function(e){l.triggerCornerMousedownEvent({$table:l,seq:r,row:i,rowIndex:d,$rowIndex:s,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:c,cell:e.target.parentNode},e)}}}):null])}function renderRows(a,u,p,f,x,h,e,m){var v=p.highlightHoverRow,y=p.rowClassName,g=p.selectRow,w=p.hoverRow,b=p.treeConfig,_=p.treeExpandeds,$=p.scrollYLoad,T=p.overflowX,o=p.columnStore,I=p.scrollYStore,P=p.editStore,C=p.expandeds,k=p.getRowMapIndex,S=p.getColumnMapIndex,L=o.leftList,R=o.rightList,E=[];return e.forEach(function(t,r){var e,o={},n=r,c=n+1;$&&(c+=I.startIndex),n=k(t),v&&(L.length||R.length)&&T&&(o.mouseenter=function(e){t!==w&&p.triggerHoverEvent(e,{row:t,rowIndex:n})},o.mouseleave=function(e){p.hoverRow=null});var l=_tools.UtilTools.getRowId(p,t,n);if(E.push(a("tr",{class:["vxe-body--row",(e={},_defineProperty(e,"row--level-".concat(x),b),_defineProperty(e,"row--current",t===g),_defineProperty(e,"row--hover",t===w),_defineProperty(e,"row--new",-1<P.insertList.indexOf(t)),e),y?_xeUtils.default.isFunction(y)?y({$table:p,seq:c,row:t,rowIndex:n}):y:""],attrs:{"data-rowid":l},key:l,on:o},m.map(function(e,o){var l=S(e);return renderColumn(a,u,p,f,c,h,x,t,n,r,e,l,o)}))),b&&_.length){var i=t[b.children];i&&i.length&&-1<_.indexOf(t)&&E.push.apply(E,renderRows(a,u,p,f?"".concat(f,".").concat(c):"".concat(c),x+1,h,i,m))}else if(C.length&&-1<C.indexOf(t)){var d=m.find(function(e){return"expand"===e.type}),s=S(d);d&&E.push(a("tr",{class:["vxe-body--expanded-row"],key:"expand_".concat(n),on:o},[a("td",{class:["vxe-body--expanded-column"],attrs:{colspan:m.length}},[a("div",{class:["vxe-body--expanded-cell"]},[d.renderData(a,{$table:p,seq:c,row:t,rowIndex:n,column:d,columnIndex:s,fixed:h,level:x})])])]))}}),E}function syncBodyScroll(e,o,l){(o||l)&&(o&&(o.onscroll=null,o.scrollTop=e),l&&(l.onscroll=null,l.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){o&&(o.onscroll=o._onscroll),l&&(l.onscroll=l._onscroll)},100))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(l){var e=this.$parent,o=this.fixedColumn,t=this.fixedType,r=e.maxHeight,n=e.height,c=e.containerHeight,i=e.loading,d=e.tableData,s=e.tableColumn,a=e.headerHeight,u=e.showFooter,p=e.showOverflow,f=e.showAllOverflow,x=e.footerHeight,h=e.tableHeight,m=e.tableWidth,v=e.overflowY,y=e.scrollXHeight,g=e.scrollYWidth,w=e.scrollXStore,b=e.scrollXLoad,_=e.scrollYStore,$=e.scrollYLoad,T=_xeUtils.default.isBoolean(f)?f:p,I="auto"===n?c:_xeUtils.default.toNumber(n),P={};0<I?P.height="".concat(t?(0<I?I-a-x:h)-(u?0:y):I-a-x,"px"):r&&(r=_xeUtils.default.toNumber(r),P["max-height"]="".concat(t?r-a-(u?0:y):r-a,"px")),t&&T?m=(s=o).reduce(function(e,o){return e+o.renderWidth},0):b&&(t&&(s=o),m=s.reduce(function(e,o){return e+o.renderWidth},0));var C={width:m?"".concat(m,"px"):m,marginLeft:t?null:"".concat(w.leftSpaceWidth,"px")};return v&&t&&_tools.DomTools.browse["-moz"]&&(C.paddingRight="".concat(g,"px")),l("div",{class:["vxe-table--body-wrapper",t?"fixed--".concat(t,"-wrapper"):"body--wrapper"],attrs:{fixed:t},style:P},[$?l("div",{class:["vxe-body--top-space"],style:{height:"".concat(_.topSpaceHeight,"px")}}):null,!t&&b?l("div",{class:["vxe-body--x-space"],style:{width:"".concat(e.tableWidth,"px")}}):null,l("table",{class:["vxe-table--body"],attrs:{cellspacing:0,cellpadding:0,border:0},style:C},[l("colgroup",s.map(function(e,o){return l("col",{attrs:{name:e.id,width:e.renderWidth},key:o})})),l("tbody",renderRows(l,this,e,"",0,t,d,s))]),t||i||d.length?null:l("div",{class:"vxe-table--empty-block"},[l("span",{class:"vxe-table--empty-text"},e.$slots.empty||_conf.default.i18n("vxe.table.emptyText"))]),$?l("div",{class:["vxe-body--bottom-space"],style:{height:"".concat(_.bottomSpaceHeight,"px")}}):null])},methods:{scrollEvent:function(e){var o=this.$parent,l=this.fixedType,t=this.lastScrollTop,r=this.lastScrollLeft,n=o.$refs,c=o.scrollXLoad,i=o.scrollYLoad,d=o.triggerScrollXEvent,s=o.triggerScrollYEvent,a=n.tableHeader,u=n.tableBody,p=n.leftBody,f=n.rightBody,x=a?a.$el:null,h=u.$el,m=p?p.$el:null,v=f?f.$el:null,y=h.scrollTop,g=h.scrollLeft,w=r!==g,b=t!==y;m&&"left"===l?syncBodyScroll(y=m.scrollTop,h,v):v&&"right"===l?syncBodyScroll(y=v.scrollTop,h,m):(x&&(x.scrollLeft=h.scrollLeft),(m||v)&&(clearTimeout(updateLeftScrollingTimeput),updateLeftScrollingTimeput=setTimeout(o.checkScrolling,_tools.DomTools.browse.msie?200:20),syncBodyScroll(y,m,v))),c&&d(e),i&&s(e),o.lastScrollTop=y,o.lastScrollLeft=g,_tools.UtilTools.emitEvent(o,"scroll",[{type:"body",fixed:l,scrollTop:y,scrollLeft:g,isX:w,isY:b,$table:o},e])}}};exports.default=_default;