"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Cell=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_vXETable=require("../../v-x-e-table"),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var Cell={createColumn:function(e,r){var t=r.type,n=r.sortable,l=r.remoteSort,o=r.filters,d=r.editRender,i=r.treeNode,a=e.checkboxOpts,c={renderHeader:this.renderHeader,renderCell:i?this.renderTreeCell:this.renderCell};switch(t){case"seq":case"index":c.renderHeader=this.renderIndexHeader,c.renderCell=i?this.renderTreeIndexCell:this.renderIndexCell;break;case"radio":c.renderHeader=this.renderRadioHeader,c.renderCell=i?this.renderTreeRadioCell:this.renderRadioCell;break;case"checkbox":case"selection":c.renderHeader=this.renderSelectionHeader,c.renderCell=a.checkField||a.checkProp?i?this.renderTreeSelectionCellByProp:this.renderSelectionCellByProp:i?this.renderTreeSelectionCell:this.renderSelectionCell;break;case"expand":c.renderCell=this.renderExpandCell,c.renderData=this.renderExpandData;break;default:d?(c.renderHeader=this.renderEditHeader,c.renderCell=e.editConfig&&"cell"===e.editConfig.mode?i?this.renderTreeCellEdit:this.renderCellEdit:i?this.renderTreeRadioCell:this.renderRowEdit):o&&o.length&&(n||l)?c.renderHeader=this.renderSortAndFilterHeader:n||l?c.renderHeader=this.renderSortHeader:o&&o.length&&(c.renderHeader=this.renderFilterHeader)}return _tools.UtilTools.getColumnConfig(e,r,c)},renderHeader:function(e,r){var t=r.column,n=t.slots,l=t.own;return n&&n.header?n.header(r,e):[_tools.UtilTools.formatText(_tools.UtilTools.getFuncText(l.title||l.label),1)]},renderCell:function(e,r){var t=r.$table,n=r.row,l=r.column,o=l.slots,d=l.own,i=d.editRender||d.cellRender;if(o&&o.default)return o.default(r,e);if(i){var a=d.editRender?"renderCell":"renderDefault",c=_vXETable.Renderer.get(i.name);if(c&&c[a])return c[a].call(t,e,i,r,{$type:d.editRender?"edit":"cell",$excel:t.$parent,$table:t,$column:l})}var s=_tools.UtilTools.getCellLabel(n,l,r);return[_tools.UtilTools.formatText(s,1)]},renderTreeCell:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderCell.call(this,e,r))},renderTreeIcon:function(e,r){var t=r.$table,n=r.isHidden,l=t.treeOpts,o=t.treeExpandeds,d=t.treeLazyLoadeds,i=r.row,a=r.column,c=r.level,s=a.slots,u=l.children,f=l.hasChild,x=l.indent,p=l.lazy,h=l.trigger,b=l.iconLoaded,C=l.iconOpen,v=l.iconClose,_=i[u],g=!1,T=!1,m=!1,k={};return s&&s.icon?s.icon(r,e):(n||(T=-1<o.indexOf(i),p&&(m=-1<d.indexOf(i),g=i[f])),h&&"default"!==h||(k.click=function(e){return t.triggerTreeExpandEvent(e,r)}),[e("span",{class:"vxe-tree--indent",style:{width:"".concat(c*(x||20),"px")}}),e("span",{class:["vxe-tree-wrapper",{"is--active":T}],on:k},_&&_.length||g?[e("span",{class:"vxe-tree--btn-wrapper"},[e("i",{class:["vxe-tree--node-btn",m?b||_conf.default.icon.treeLoaded:T?C||_conf.default.icon.treeOpen:v||_conf.default.icon.treeClose]})])]:[])])},renderIndexHeader:function(e,r){var t=r.column,n=t.slots;return n&&n.header?n.header(r,e):[_tools.UtilTools.formatText(t.getTitle(),1)]},renderIndexCell:function(e,r){var t=r.$table,n=r.column,l=t.seqOpts,o=t.startIndex,d=n.slots,i=n.indexMethod;if(d&&d.default)return d.default(r,e);var a=r.$seq,c=r.seq,s=r.level,u=l.seqMethod||i;return[_tools.UtilTools.formatText(u?u(r):s?"".concat(a,".").concat(c):(l.startIndex||o)+c,1)]},renderTreeIndexCell:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderIndexCell(e,r))},renderRadioHeader:function(e,r){var t=r.column,n=t.slots,l=t.own;return n&&n.header?n.header(r,e):[_tools.UtilTools.formatText(_tools.UtilTools.getFuncText(l.title||l.label),1)]},renderRadioCell:function(e,r){var t,n=r.$table,l=r.column,o=n.vSize,d=n.radioOpts,i=l.slots,a=d.checkMethod,c=!!a,s=d.labelField||d.labelProp,u=n.selectRow,f=r.row,x={attrs:{type:"radio",name:"vxe-radio--".concat(n.id)}};return r.isHidden||(a&&(c=!a(r),x.attrs.disabled=c),x.domProps={checked:f===u},x.on={change:function(e){n.triggerRadioRowEvent(e,r)}}),[e("label",{class:["vxe-radio",(_defineProperty(t={},"size--".concat(o),o),_defineProperty(t,"is--disabled",c),t)]},[e("input",x),e("span",{class:"vxe-radio--icon"}),s?e("span",{class:"vxe-radio--label"},i&&i.default?i.default(r,e):_xeUtils.default.get(f,s)):null])]},renderTreeRadioCell:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderRadioCell(e,r))},renderSelectionHeader:function(e,r){var t,n=r.$table,l=r.column,o=r.isHidden,d=n.vSize,i=n.isIndeterminate,a=n.isAllCheckboxDisabled,c=n.checkboxOpts,s=l.slots,u=l.own,f=u.title||u.label,x={attrs:{type:"checkbox",disabled:a}};return(c.checkStrictly?c.showHeader:!1!==c.showHeader)?(o||(x.domProps={checked:!a&&n.isAllSelected},x.on={change:function(e){n.triggerCheckAllEvent(e,e.target.checked)}}),[e("label",{class:["vxe-checkbox",(_defineProperty(t={},"size--".concat(d),d),_defineProperty(t,"is--disabled",x.attrs.disabled),_defineProperty(t,"is--indeterminate",i),t)],attrs:{title:_conf.default.i18n("vxe.table.allTitle")}},[e("input",x),e("span",{class:"vxe-checkbox--icon"}),f?e("span",{class:"vxe-checkbox--label"},s&&s.header?s.header(r,e):_tools.UtilTools.getFuncText(f)):null])]):s&&s.header?s.header(r,e):[_tools.UtilTools.getFuncText(f)]},renderSelectionCell:function(e,r){var t,n=r.$table,l=r.row,o=r.column,d=r.isHidden,i=n.vSize,a=n.treeConfig,c=n.treeIndeterminates,s=n.checkboxOpts,u=s.checkMethod,f=o.slots,x=s.labelField||s.labelProp,p=!1,h=!!u,b={attrs:{type:"checkbox"}};return d||(u&&(h=!u(r),b.attrs.disabled=h),a&&(p=-1<c.indexOf(l)),b.domProps={checked:-1<n.selection.indexOf(l)},b.on={change:function(e){n.triggerCheckRowEvent(e,r,e.target.checked)}}),[e("label",{class:["vxe-checkbox",(_defineProperty(t={},"size--".concat(i),i),_defineProperty(t,"is--indeterminate",p),_defineProperty(t,"is--disabled",h),t)]},[e("input",b),e("span",{class:"vxe-checkbox--icon"}),x?e("span",{class:"vxe-checkbox--label"},f&&f.default?f.default(r,e):_xeUtils.default.get(l,x)):null])]},renderTreeSelectionCell:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderSelectionCell(e,r))},renderSelectionCellByProp:function(e,r){var t,n=r.$table,l=r.row,o=r.column,d=r.isHidden,i=n.vSize,a=n.treeConfig,c=n.treeIndeterminates,s=n.checkboxOpts,u=s.checkMethod,f=o.slots,x=s.labelField||s.labelProp,p=!1,h=!!u,b=s.checkField||s.checkProp,C={attrs:{type:"checkbox"}};return d||(u&&(h=!u(r),C.attrs.disabled=h),a&&(p=-1<c.indexOf(l)),C.domProps={checked:_xeUtils.default.get(l,b)},C.on={change:function(e){n.triggerCheckRowEvent(e,r,e.target.checked)}}),[e("label",{class:["vxe-checkbox",(_defineProperty(t={},"size--".concat(i),i),_defineProperty(t,"is--indeterminate",p),_defineProperty(t,"is--disabled",h),t)]},[e("input",C),e("span",{class:"vxe-checkbox--icon"}),x?e("span",{class:"vxe-checkbox--label"},f&&f.default?f.default(r,e):_xeUtils.default.get(l,x)):null])]},renderTreeSelectionCellByProp:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderSelectionCellByProp(e,r))},renderExpandCell:function(e,r){var t=r.$table,n=r.isHidden,l=r.row,o=r.column,d=t.expandOpts,i=t.rowExpandeds,a=t.expandLazyLoadeds,c=d.lazy,s=d.labelField,u=d.iconLoaded,f=d.iconOpen,x=d.iconClose,p=o.slots,h=!1,b=!1;return p&&p.icon?p.icon(r,e):(n||(h=-1<i.indexOf(r.row),c&&(b=-1<a.indexOf(l))),[e("span",{class:["vxe-table--expanded",{"is--active":h}],on:{click:function(e){t.triggerRowExpandEvent(e,r)}}},[e("i",{class:["vxe-table--expand-btn",b?u||_conf.default.icon.treeLoaded:h?f||_conf.default.icon.expandOpen:x||_conf.default.icon.expandClose]})]),p.content&&p.default?p.default(r,e):s?_xeUtils.default.get(l,s):null])},renderExpandData:function(e,r){var t=r.column.slots;if(t){if(t.content)return t.content(r,e);if(t.default)return t.default(r,e)}return[]},renderSortAndFilterHeader:function(e,r){return Cell.renderHeader(e,r).concat(Cell.renderSortIcon(e,r)).concat(Cell.renderFilterIcon(e,r))},renderSortHeader:function(e,r){return Cell.renderHeader(e,r).concat(Cell.renderSortIcon(e,r))},renderSortIcon:function(e,r){var t=r.$table,n=r.column,l=t.sortOpts,o=l.iconAsc,d=l.iconDesc;return[e("span",{class:"vxe-sort-wrapper"},[e("i",{class:["vxe-sort--asc-btn",o||_conf.default.icon.sortAsc,{"sort--active":"asc"===n.order}],attrs:{title:_conf.default.i18n("vxe.table.sortAsc")},on:{click:function(e){t.triggerSortEvent(e,n,"asc")}}}),e("i",{class:["vxe-sort--desc-btn",d||_conf.default.icon.sortDesc,{"sort--active":"desc"===n.order}],attrs:{title:_conf.default.i18n("vxe.table.sortDesc")},on:{click:function(e){t.triggerSortEvent(e,n,"desc")}}})])]},renderFilterHeader:function(e,r){return Cell.renderHeader(e,r).concat(Cell.renderFilterIcon(e,r))},renderFilterIcon:function(e,r){var t=r.$table,n=r.column,l=r.hasFilter,o=t.filterStore,d=t.filterOpts,i=d.iconNone,a=d.iconMatch;return[e("span",{class:["vxe-filter-wrapper",{"is--active":o.visible&&o.column===n}]},[e("i",{class:["vxe-filter--btn",l?a||_conf.default.icon.filterMatch:i||_conf.default.icon.filterNone],attrs:{title:_conf.default.i18n("vxe.table.filter")},on:{click:function(e){t.triggerFilterEvent(e,r.column,r)}}})])]},renderEditHeader:function(e,r){var t,n=r.$table,l=r.column,o=n.editRules,d=n.editConfig,i=l.sortable,a=l.remoteSort,c=l.filters;if(o){var s=_xeUtils.default.get(o,r.column.property);s&&(t=s.some(function(e){return e.required}))}return[t?e("i",{class:"vxe-required-icon"}):null,d&&!1===d.showIcon?null:e("i",{class:["vxe-edit-icon",d.icon||_conf.default.icon.edit]})].concat(Cell.renderHeader(e,r)).concat(i||a?Cell.renderSortIcon(e,r):[]).concat(c&&c.length?Cell.renderFilterIcon(e,r):[])},renderRowEdit:function(e,r){var t=r.$table.editStore.actived;return Cell.runRenderer(e,r,this,t&&t.row===r.row)},renderTreeRowEdit:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderRowEdit(e,r))},renderCellEdit:function(e,r){var t=r.$table.editStore.actived;return Cell.runRenderer(e,r,this,t&&t.row===r.row&&t.column===r.column)},renderTreeCellEdit:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderCellEdit(e,r))},runRenderer:function(e,r,t,n){var l=r.$table,o=r.row,d=r.column,i=d.slots,a=d.own,c=d.formatter,s=a.editRender,u=_vXETable.Renderer.get(s.name);return"visible"===s.type||n?i&&i.edit?i.edit(r,e):u&&u.renderEdit?u.renderEdit.call(l,e,s,r,{$type:"edit",$excel:l.$parent,$table:l,$column:d}):[]:i&&i.default?i.default(r,e):c?[_tools.UtilTools.formatText(_tools.UtilTools.getCellLabel(o,d,r),1)]:Cell.renderCell.call(t,e,r)}},_default=exports.Cell=Cell;exports.default=_default;