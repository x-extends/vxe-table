"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={moveTabSelected:function(e,o){var t,l,s,n,d=this.tableData,i=this.visibleColumn,c=this.editConfig,r=this.hasIndexColumn,a=o.shiftKey,h=Object.assign({},e),u=d.indexOf(h.row),m=i.indexOf(h.column);if(o.preventDefault(),a){for(var f=m-1;0<=f;f--)if(!r(i[f])){s=i[n=f];break}if(!s&&0<u){t=d[l=u-1];for(var x=i.length-1;0<=x;x--)if(!r(i[x])){s=i[n=x];break}}}else{for(var g=m+1;g<i.length;g++)if(!r(i[g])){s=i[n=g];break}if(!s&&u<d.length-1){t=d[l=u+1];for(var C=0;C<i.length;C++)if(!r(i[C])){s=i[n=C];break}}}s&&(t?(h.rowIndex=l,h.row=t):h.rowIndex=u,h.columnIndex=n,h.column=s,h.cell=_tools.DomTools.getCell(this,h),c&&("click"!==c.trigger&&"dblclick"!==c.trigger||("row"===c.mode?this.handleActived(h,o):(this.handleSelected(h,o),this.scrollToRow(h.row,h.column)))))},moveCurrentRow:function(e,o,t){var l,s=this,n=this.currentRow,d=this.treeConfig,i=this.afterFullData;if(t.preventDefault(),d){var c=_xeUtils.default.findTree(i,function(e){return e===n},d),r=c.index,a=c.items;e&&0<r?l=a[r-1]:o&&r<a.length-1&&(l=a[r+1])}else{var h=i.indexOf(n);e&&0<h?l=i[h-1]:o&&h<i.length-1&&(l=i[h+1])}if(l){var u={$table:this,row:l};this.scrollToRow(l).then(function(){return s.triggerCurrentRowEvent(t,u)})}},moveSelected:function(e,o,t,l,s,n){var d=this.tableData,i=this.visibleColumn,c=this.hasIndexColumn,r=Object.assign({},e);if(n.preventDefault(),t&&r.rowIndex)r.rowIndex-=1,r.row=d[r.rowIndex];else if(s&&r.rowIndex<d.length-1)r.rowIndex+=1,r.row=d[r.rowIndex];else if(o&&r.columnIndex){for(var a=r.columnIndex-1;0<=a;a--)if(!c(i[a])){r.columnIndex=a,r.column=i[a];break}}else if(l)for(var h=r.columnIndex+1;h<i.length;h++)if(!c(i[h])){r.columnIndex=h,r.column=i[h];break}r.cell=_tools.DomTools.getCell(this,r),this.handleSelected(r,n),this.scrollToRow(r.row,r.column)},triggerHeaderCellMousedownEvent:function(e,o){var c=this.$el,t=this.tableData,l=this.mouseConfig,s=void 0===l?{}:l,n=this.elemStore,r=this.handleChecked,a=this.handleHeaderChecked,d=e.button,i=o.column,h=o.cell,u=0===d,m="index"===i.type;if(u&&s.checked){var f=n["main-header-list"].children,x=n["main-body-list"].children;if(m)this.handleAllChecked(e);else{e.preventDefault(),e.stopPropagation(),this.clearSelected(e),this.clearHeaderChecked(),this.clearIndexChecked();var g=document.onmousemove,C=document.onmouseup,v=x[0].querySelector(".".concat(i.id)),_=_xeUtils.default.throttle(function(e){e.preventDefault();var o=_tools.DomTools.getEventTargetNode(e,c,"vxe-header--column"),t=o.flag,l=o.targetElem;if(!t){var s=_tools.DomTools.getEventTargetNode(e,c,"vxe-body--column");t=s.flag,l=s.targetElem}if(t&&!_tools.DomTools.hasClass(l,"col--index")){var n=[].indexOf.call(l.parentNode.children,l),d=x[x.length-1].children[n],i=f[0].children[n];a(_tools.DomTools.getRowNodes(f,_tools.DomTools.getCellNodeIndex(i),_tools.DomTools.getCellNodeIndex(h))),r(_tools.DomTools.getRowNodes(x,_tools.DomTools.getCellNodeIndex(v),_tools.DomTools.getCellNodeIndex(d)))}},80,{leading:!0,trailing:!0});if(_tools.DomTools.addClass(c,"c--checked"),document.onmousemove=_,document.onmouseup=function(){_tools.DomTools.removeClass(c,"c--checked"),document.onmousemove=g,document.onmouseup=C},a([[h]]),x.length){var p=x[x.length-1].querySelector(".".concat(i.id)),T=x[0],y=x[x.length-1],D=T.querySelector(".col--index");o.rowIndex=0,o.row=t[0],o.cell=_tools.DomTools.getCell(this,o),this.handleSelected(o,e),this.handleIndexChecked(_tools.DomTools.getRowNodes(x,_tools.DomTools.getCellNodeIndex(D),_tools.DomTools.getCellNodeIndex(y.querySelector(".col--index")))),this.handleChecked(_tools.DomTools.getRowNodes(x,_tools.DomTools.getCellNodeIndex(v),_tools.DomTools.getCellNodeIndex(p)))}}this.closeMenu()}},triggerCellMousedownEvent:function(e,o){var c=this.$el,t=this.visibleColumn,l=this.editStore,s=this.editConfig,n=this.handleSelected,d=this.mouseConfig,i=void 0===d?{}:d,r=this.handleChecked,a=this.handleIndexChecked,h=this.handleHeaderChecked,u=this.elemStore,m=l.checked,f=l.actived,x=o.row,g=o.column,C=o.cell,v=0===e.button;if(s){if(f.row!==x||"cell"!==s.mode||f.column!==g)if(v&&i.checked){e.preventDefault(),e.stopPropagation(),this.clearHeaderChecked(),this.clearIndexChecked();var _=document.onmousemove,p=document.onmouseup,T=_tools.DomTools.getCellNodeIndex(C),y="index"===g.type,D=u["main-body-list"].children,N=u["main-header-list"].children,k=C.parentNode.lastElementChild,w=C.parentNode.firstElementChild,I=[].indexOf.call(C.parentNode.children,C),b=N[0].children[I],S=_xeUtils.default.throttle(function(e){e.preventDefault();var o=_tools.DomTools.getEventTargetNode(e,c,"vxe-body--column"),t=o.flag,l=o.targetElem;if(t)if(y){var s=l.parentNode.firstElementChild;r(_tools.DomTools.getRowNodes(D,_tools.DomTools.getCellNodeIndex(s.nextElementSibling),_tools.DomTools.getCellNodeIndex(k))),a(_tools.DomTools.getRowNodes(D,_tools.DomTools.getCellNodeIndex(s),_tools.DomTools.getCellNodeIndex(C)))}else if(!_tools.DomTools.hasClass(l,"col--index")){var n=l.parentNode.firstElementChild,d=[].indexOf.call(l.parentNode.children,l),i=N[0].children[d];h(_tools.DomTools.getRowNodes(N,_tools.DomTools.getCellNodeIndex(i),_tools.DomTools.getCellNodeIndex(b))),a(_tools.DomTools.getRowNodes(D,_tools.DomTools.getCellNodeIndex(n),_tools.DomTools.getCellNodeIndex(w))),r(_tools.DomTools.getRowNodes(D,T,_tools.DomTools.getCellNodeIndex(l)))}},80,{leading:!0,trailing:!0});if(document.onmousemove=S,document.onmouseup=function(e){document.onmousemove=_,document.onmouseup=p},y){var E=C.parentNode.firstElementChild;o.columnIndex++,o.column=t[o.columnIndex],o.cell=C.nextElementSibling,n(o,e),r(_tools.DomTools.getRowNodes(D,_tools.DomTools.getCellNodeIndex(E.nextElementSibling),_tools.DomTools.getCellNodeIndex(k))),h([N[0].querySelectorAll(".vxe-header--column:not(.col--index)")]),a(_tools.DomTools.getRowNodes(D,_tools.DomTools.getCellNodeIndex(E),_tools.DomTools.getCellNodeIndex(C)))}else n(o,e);this.closeFilter(),this.closeMenu()}else i.selected&&"dblclick"===s.trigger&&(m.rowNodes&&m.rowNodes.some(function(e){return e.includes(C)})||n(o,e))}else i.selected&&n(o,e)},clearSelected:function(e){var o=this.editStore,t=this.elemStore,l=o.selected;l.row=null,l.column=null;var s=t["main-header-list"],n=t["main-body-list"];return _xeUtils.default.arrayEach(s.querySelectorAll(".col--title-selected"),function(e){return _tools.DomTools.removeClass(e,"col--title-selected")}),_xeUtils.default.arrayEach([n.querySelector(".col--selected")],function(e){return _tools.DomTools.removeClass(e,"col--selected")}),this.$nextTick()},clearChecked:function(e){var o=this.$refs,t=this.editStore,l=this.mouseConfig,s=t.checked;if(l&&l.checked){var n=o.tableBody;s.rows=[],s.columns=[],s.tRows=[],s.tColumns=[],n.$refs.checkBorders.style.display="none",_xeUtils.default.arrayEach(n.$el.querySelectorAll(".col--checked"),function(e){return _tools.DomTools.removeClass(e,"col--checked")})}return this.$nextTick()},getMouseCheckeds:function(){var o=this,e=this.editStore.checked.rowNodes,t=void 0===e?[]:e,l=[],s=[];return t&&t.length&&(s=t.map(function(e){return o.getRowNode(e[0].parentNode).item}),l=t[0].map(function(e){return o.getColumnNode(e).item})),{columns:l,rows:s,rowNodes:t}},handleChecked:function(e){var o=this.editStore.checked;this.clearChecked();var s=-2,n=-2,d=0,i=0;_xeUtils.default.arrayEach(e,function(e,o){var l=0===o;_xeUtils.default.arrayEach(e,function(e,o){var t=0===o;t&&l&&(d=e.offsetTop,i=e.offsetLeft),l&&(s+=e.offsetWidth),t&&(n+=e.offsetHeight),_tools.DomTools.addClass(e,"col--checked")})});var t=this.$refs.tableBody.$refs,l=t.checkBorders,c=t.checkTop,r=t.checkRight,a=t.checkBottom,h=t.checkLeft;l.style.display="block",Object.assign(c.style,{top:"".concat(d,"px"),left:"".concat(i,"px"),width:"".concat(s,"px")}),Object.assign(r.style,{top:"".concat(d,"px"),left:"".concat(i+s,"px"),height:"".concat(n,"px")}),Object.assign(a.style,{top:"".concat(d+n,"px"),left:"".concat(i,"px"),width:"".concat(s,"px")}),Object.assign(h.style,{top:"".concat(d,"px"),left:"".concat(i,"px"),height:"".concat(n,"px")}),o.rowNodes=e},handleAllChecked:function(e){var o=this.tableData,t=this.visibleColumn,l=this.mouseConfig,s=void 0===l?{}:l,n=this.elemStore;if(s.checked){e.preventDefault();var d=n["main-header-list"],i=d.children,c=n["main-body-list"].children,r=t.find(function(e){return"index"===e.type})||t[0],a=d.querySelector(".".concat(r.id)),h=c[0],u=c[c.length-1],m=h.querySelector(".".concat(r.id)),f={$table:this,rowIndex:0,row:o[0],column:t.find(function(e){return e.property})};f.columnIndex=this.getColumnIndex(f.column),f.cell=_tools.DomTools.getCell(this,f),this.handleSelected(f,e),this.handleHeaderChecked(_tools.DomTools.getRowNodes(i,_tools.DomTools.getCellNodeIndex(a.nextElementSibling),_tools.DomTools.getCellNodeIndex(a.parentNode.lastElementChild))),this.handleIndexChecked(_tools.DomTools.getRowNodes(c,_tools.DomTools.getCellNodeIndex(m),_tools.DomTools.getCellNodeIndex(u.querySelector(".".concat(r.id))))),this.handleChecked(_tools.DomTools.getRowNodes(c,_tools.DomTools.getCellNodeIndex(m.nextElementSibling),_tools.DomTools.getCellNodeIndex(u.lastElementChild)))}},handleIndexChecked:function(e){var o=this.editStore.indexs;this.clearIndexChecked(),_xeUtils.default.arrayEach(e,function(e){_xeUtils.default.arrayEach(e,function(e){_tools.DomTools.addClass(e,"col--index-checked")})}),o.rowNodes=e},clearIndexChecked:function(){var e=this.elemStore["main-body-list"];return _xeUtils.default.arrayEach(e.querySelectorAll(".col--index-checked"),function(e){return _tools.DomTools.removeClass(e,"col--index-checked")}),this.$nextTick()},handleHeaderChecked:function(e){var o=this.editStore.titles;this.clearHeaderChecked(),_xeUtils.default.arrayEach(e,function(e){_xeUtils.default.arrayEach(e,function(e){_tools.DomTools.addClass(e,"col--title-checked")})}),o.rowNodes=e},clearHeaderChecked:function(){var e=this.elemStore["main-header-list"];return _xeUtils.default.arrayEach(e.querySelectorAll(".col--title-checked"),function(e){return _tools.DomTools.removeClass(e,"col--title-checked")}),this.$nextTick()},clearCopyed:function(){var e=this.$refs,o=this.editStore,t=this.keyboardConfig,l=o.copyed;if(t&&t.isCut){var s=e.tableBody,n=e.tableBody.$refs.copyBorders;l.cut=!1,l.rows=[],l.columns=[],n.style.display="none",_xeUtils.default.arrayEach(s.$el.querySelectorAll(".col--copyed"),function(e){return _tools.DomTools.removeClass(e,"col--copyed")})}return this.$nextTick()},handleCopyed:function(e,o){var t=this.tableData,l=this.tableColumn,s=this.editStore,n=s.copyed,d=s.checked.rowNodes;this.clearCopyed();var i=-3,c=-3,r=0,a=0,h=[],u=[];if(d.length){var m=d[0],f=_tools.DomTools.getCellNodeIndex(m[0]),x=f.rowIndex,g=f.columnIndex;h=l.slice(g,g+m.length),u=t.slice(x,x+d.length)}_xeUtils.default.arrayEach(d,function(e,o){var l=0===o;_xeUtils.default.arrayEach(e,function(e,o){var t=0===o;t&&l&&(r=e.offsetTop,a=e.offsetLeft),l&&(i+=e.offsetWidth),t&&(c+=e.offsetHeight),_tools.DomTools.addClass(e,"col--copyed")})});var C=this.$refs.tableBody.$refs,v=C.copyBorders,_=C.copyTop,p=C.copyRight,T=C.copyBottom,y=C.copyLeft;v.style.display="block",Object.assign(_.style,{top:"".concat(r,"px"),left:"".concat(a,"px"),width:"".concat(i,"px")}),Object.assign(p.style,{top:"".concat(r,"px"),left:"".concat(a+i,"px"),height:"".concat(c,"px")}),Object.assign(T.style,{top:"".concat(r+c,"px"),left:"".concat(a,"px"),width:"".concat(i,"px")}),Object.assign(y.style,{top:"".concat(r,"px"),left:"".concat(a,"px"),height:"".concat(c,"px")}),n.cut=e,n.rows=u,n.columns=h,n.rowNodes=d},handlePaste:function(e){var o=this.tableData,n=this.visibleColumn,t=this.editStore,l=this.elemStore,s=t.copyed,d=t.selected,i=s.cut,c=s.rows,r=s.columns;if(c.length&&r.length&&d.row&&d.column){var a=d.args,h=a.rowIndex,u=a.columnIndex;_xeUtils.default.arrayEach(c,function(l,e){var s=o[h+e];s&&_xeUtils.default.arrayEach(r,function(e,o){var t=n[u+o];t&&_tools.UtilTools.setCellValue(s,t,_tools.UtilTools.getCellValue(l,e)),i&&_tools.UtilTools.setCellValue(l,e,null)})}),i&&this.clearCopyed();var m=l["main-body-list"].children,f=d.args.cell,x=f.parentNode,g=_xeUtils.default.arrayIndexOf(x.children,f),C=m[_xeUtils.default.arrayIndexOf(m,x)+c.length-1].children[g+r.length-1];this.handleChecked(_tools.DomTools.getRowNodes(m,_tools.DomTools.getCellNodeIndex(f),_tools.DomTools.getCellNodeIndex(C)))}}};exports.default=_default;